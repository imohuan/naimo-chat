import{$t as e,Dn as t,Jt as n,Kt as r,Lt as i,Qn as a,Qt as o,Vn as s,Vt as c,Xt as l,Yn as u,Yt as d,en as f,gn as p,i as m,jn as h,qn as g,qt as _,vn as v}from"./index-urHyhAmF.js";import{u as y}from"./floating-ui.vue-C1NloyW1.js";import{t as b}from"./chevron-down-ByDMAM3t.js";import{t as ee}from"./copy-RphYhh8Z.js";import{t as x}from"./trash-2-l40C5gd0.js";import{t as S}from"./BaseSelect-B1tsUc23.js";var C=y(`plus`,[[`path`,{d:`M5 12h14`,key:`1ays0h`}],[`path`,{d:`M12 5v14`,key:`s699le`}]]),te=y(`triangle-alert`,[[`path`,{d:`m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3`,key:`wmoenq`}],[`path`,{d:`M12 9v4`,key:`juzpu7`}],[`path`,{d:`M12 17h.01`,key:`p32p05`}]]),w={class:`rounded bg-white px-1.5`},T={class:`flex items-center gap-1`},E={class:`w-28 flex items-end gap-1 font-mono`},D={key:0,class:`text-[10px] text-slate-700 whitespace-nowrap font-bold`},O=[`value`,`disabled`],k={key:2,class:`text-[6px] uppercase tracking-wide text-slate-400 whitespace-nowrap truncate`},A=[`type`,`placeholder`,`value`,`disabled`],j=[`disabled`],M={key:0,class:`text-[9px] text-slate-400 mt-0.5`},N=m(f({__name:`ParamItem`,props:{modelValue:{},keyReadonly:{type:Boolean,default:!1},field:{default:void 0},disabled:{type:Boolean,default:!1}},emits:[`update:modelValue`,`delete`],setup(t,{emit:n}){let i=t,o=n,s=r(()=>i.field||i.modelValue.field),c=r(()=>s.value?.type||`string`),u=r({get:()=>i.modelValue.key,set:e=>{i.keyReadonly||o(`update:modelValue`,{...i.modelValue,field:s.value,key:e})}}),f=r({get:()=>m(i.modelValue.value),set:e=>{let t=h(e);o(`update:modelValue`,{...i.modelValue,field:s.value,value:t})}});function m(e){if(typeof e==`object`&&e)try{return JSON.stringify(e)}catch{return String(e)}return String(e??``)}function h(e){let t=e.trim();if(t.startsWith(`{`)&&t.endsWith(`}`)||t.startsWith(`[`)&&t.endsWith(`]`))try{return JSON.parse(t)}catch{return e}if(t.toLowerCase()===`true`)return!0;if(t.toLowerCase()===`false`)return!1;let n=Number(t);return!Number.isNaN(n)&&t!==``?n:e}return(n,r)=>(p(),l(`div`,w,[_(`div`,T,[_(`div`,E,[t.keyReadonly?(p(),l(`div`,D,a(s.value?.label||u.value),1)):(p(),l(`input`,{key:1,class:`param-input text-[11px] font-mono`,value:u.value,onInput:r[0]||=e=>u.value=e.target.value,placeholder:`key`,disabled:t.disabled},null,40,O)),t.keyReadonly&&s.value?(p(),l(`span`,k,a(c.value),1)):d(``,!0)]),_(`input`,{type:c.value===`number`?`number`:`text`,class:`param-input text-[11px] flex-1 font-mono`,placeholder:s.value?.placeholder||`值 (JSON / number / boolean / string)`,value:f.value,onInput:r[1]||=e=>f.value=e.target.value,disabled:t.disabled},null,40,A),t.keyReadonly?d(``,!0):(p(),l(`button`,{key:0,class:`text-slate-400 hover:text-red-500 transition px-0.5 h-5 w-5 flex items-center justify-center rounded shrink-0`,type:`button`,onClick:r[2]||=e=>o(`delete`),disabled:t.disabled,title:`移除参数`},[e(g(x),{class:`w-3 h-3`})],8,j))]),s.value?.helper?(p(),l(`p`,M,a(s.value.helper),1)):d(``,!0)]))}}),[[`__scopeId`,`data-v-282e02a1`]]),P={class:`space-y-1 relative`},F={key:0,class:`text-[10px] text-slate-400 px-1.5 py-0.5 rounded bg-slate-50`},I=[`disabled`],ne=f({__name:`ParamList`,props:{modelValue:{},readonlyKeys:{default:()=>[]},fields:{default:()=>[]},transformerType:{default:``},disabled:{type:Boolean,default:!1}},emits:[`update:modelValue`],setup(t,{emit:n}){let i=t,a=r(()=>i.transformerType===`CustomParamsTransformer`),s=n,u=r(()=>{let e=new Map;return i.fields?.forEach(t=>{e.set(t.key,t)}),e}),f=r({get:()=>Object.entries(i.modelValue||{}).map(([e,t])=>({key:e,value:t,field:u.value.get(e)})),set:e=>{let t={};e.forEach(e=>{e.key&&e.key.trim()&&(t[e.key]=e.value)}),s(`update:modelValue`,t)}});function m(){let e=Object.keys(i.modelValue||{}),t=`param`,n=1;for(;e.includes(t);)t=`param_${n++}`;f.value=[...f.value,{key:t,value:``,field:void 0}]}function h(e,t){let n=[...f.value];n[e]=t,f.value=n}function y(e){f.value=f.value.filter((t,n)=>n!==e)}let b=r(()=>f.value.length>0);return(n,r)=>(p(),l(`div`,P,[r[1]||=_(`div`,{class:`absolute top-0 left-0 w-[4px] h-full bg-gray-300`},null,-1),(p(!0),l(c,null,v(f.value,(n,r)=>(p(),l(`div`,{key:`${n.key}-${r}`,class:`param-item-wrapper`},[e(N,{"model-value":n,"key-readonly":t.readonlyKeys.includes(n.key),field:n.field,disabled:t.disabled,"onUpdate:modelValue":e=>h(r,e),onDelete:e=>y(r)},null,8,[`model-value`,`key-readonly`,`field`,`disabled`,`onUpdate:modelValue`,`onDelete`])]))),128)),b.value?d(``,!0):(p(),l(`div`,F,` 暂无参数，可点击添加 `)),!t.disabled&&a.value?(p(),l(`button`,{key:1,class:`text-[10px] text-sky-600 hover:text-sky-800 font-medium flex items-center gap-0.5 px-1.5 py-0.5 rounded transition`,type:`button`,onClick:m,disabled:t.disabled},[e(g(C),{class:`w-2.5 h-2.5`}),r[0]||=o(` 添加参数 `,-1)],8,I)):d(``,!0)]))}}),re={class:`w-full space-y-1`},ie={key:0,class:`space-y-1`},ae={class:`p-1.5 flex flex-col gap-1.5`},oe={class:`flex items-center gap-0.5`},se={class:`w-48 max-w-48`},ce={key:0,class:`flex items-center gap-0.5 px-1 py-0.5 bg-amber-50 border border-amber-200 rounded text-amber-700 shrink-0`,title:`此作用域存在重复`},le={class:`flex items-center gap-0.5 flex-1 justify-end`},L=[`onClick`,`disabled`],R=[`disabled`],z=[`onClick`,`disabled`],B={key:0,class:`space-y-0.5`},V={class:`flex items-center gap-0.5`},H=[`onClick`,`disabled`],U={class:`w-3 h-3`},W=[`onClick`],ue={class:`w-64 max-w-64`},de={class:`flex items-center gap-0.5 flex-1 justify-end`},fe=[`onClick`,`disabled`],pe=[`onClick`,`disabled`],me={key:0,class:`p-1.5 pl-0! space-y-1 mt-0.5`},he={key:0,class:`text-[10px] text-slate-400 px-1.5 py-1 rounded bg-slate-50`},ge={key:1,class:`text-xs text-slate-400 text-center py-4 rounded-md bg-white/60`},G=m(f({__name:`TransformerConfigList`,props:{modelValue:{},models:{},options:{},disabled:{type:Boolean},loading:{type:Boolean},placeholder:{}},emits:[`update:modelValue`],setup(a,{emit:o}){let f=[`AnthropicTransformer`,`OpenAITransformer`,`OpenrouterTransformer`,`GeminiTransformer`,`VertexGeminiTransformer`,`VertexClaudeTransformer`,`VercelTransformer`,`GroqTransformer`,`DeepseekTransformer`,`CerebrasTransformer`,`OpenAIResponsesTransformer`,`StreamOptionsTransformer`,`TooluseTransformer`,`MaxTokenTransformer`,`MaxCompletionTokens`,`SamplingTransformer`,`ReasoningTransformer`,`ForceReasoningTransformer`,`EnhanceToolTransformer`,`CleancacheTransformer`,`CustomParamsTransformer`],m={AnthropicTransformer:`Anthropic`,OpenAITransformer:`OpenAI`,OpenrouterTransformer:`openrouter`,GeminiTransformer:`gemini`,VertexGeminiTransformer:`vertex-gemini`,VertexClaudeTransformer:`vertex-claude`,VercelTransformer:`vercel`,GroqTransformer:`groq`,DeepseekTransformer:`deepseek`,CerebrasTransformer:`cerebras`,OpenAIResponsesTransformer:`openai-responses`,StreamOptionsTransformer:`streamoptions`,TooluseTransformer:`tooluse`,MaxTokenTransformer:`maxtoken`,MaxCompletionTokens:`maxcompletiontokens`,SamplingTransformer:`sampling`,ReasoningTransformer:`reasoning`,ForceReasoningTransformer:`forcereasoning`,EnhanceToolTransformer:`enhancetool`,CleancacheTransformer:`cleancache`,CustomParamsTransformer:`customparams`},y=Object.fromEntries(Object.entries(m).map(([e,t])=>[t,e])),w={AnthropicTransformer:{params:[{key:`UseBearer`,label:`UseBearer`,type:`boolean`,helper:`true 时放入 Authorization Bearer，默认 false 使用 x-api-key`}]},OpenAITransformer:{},OpenrouterTransformer:{allowCustom:!0,description:`可携带任意键值，合并到请求体`},GeminiTransformer:{},VertexGeminiTransformer:{},VertexClaudeTransformer:{},VercelTransformer:{allowCustom:!0,description:`任意键值合并请求体`},GroqTransformer:{},DeepseekTransformer:{},CerebrasTransformer:{},OpenAIResponsesTransformer:{},StreamOptionsTransformer:{},TooluseTransformer:{},MaxTokenTransformer:{params:[{key:`max_tokens`,label:`max_tokens`,type:`number`,placeholder:`4096`}]},MaxCompletionTokens:{},SamplingTransformer:{params:[{key:`max_tokens`,label:`max_tokens`,type:`number`,placeholder:`4096`},{key:`temperature`,label:`temperature`,type:`number`,placeholder:`0.7`},{key:`top_p`,label:`top_p`,type:`number`,placeholder:`0.9`},{key:`top_k`,label:`top_k`,type:`number`,placeholder:`40`},{key:`repetition_penalty`,label:`repetition_penalty`,type:`number`,placeholder:`1.05`}]},ReasoningTransformer:{params:[{key:`enable`,label:`enable`,type:`boolean`,helper:`默认 true，关闭则禁用 reasoning`}]},ForceReasoningTransformer:{},EnhanceToolTransformer:{},CleancacheTransformer:{},CustomParamsTransformer:{allowCustom:!0,description:`附加任意键值对对象，递归合并`}},T=r(()=>Object.keys(w));function E(e){return m[e]||e}function D(e){return y[e]||e}let O=a,k=o,A=s([]),j=s([]),M=s(1),N=s({}),P=s(!1),F=r(()=>{let e=new Set([...T.value,...f]),t=(O.options?.map(e=>D(e.name))??[]).filter(t=>e.has(t));return[...f,...t].filter((e,t,n)=>n.indexOf(e)===t)}),I=r(()=>A.value.length>0);function G(e){return e===`none`?!1:A.value.filter(t=>t.scope===e).length>1}let _e=r(()=>[{label:`None`,value:`none`},{label:`全局 (use)`,value:`use`},...j.value.map(e=>({label:`模型 (${e})`,value:e}))]),ve=r(()=>F.value.map(e=>({label:e,value:e})));t(()=>[O.modelValue,O.models],()=>{if(P.value){P.value=!1;return}ye(O.modelValue)},{immediate:!0,deep:!0});function ye(e){let t=new Map,n=new Set(O.models??[]);e&&Object.keys(e).forEach(e=>{e!==`use`&&n.add(e)});let r=1,i=(e,n)=>{!Array.isArray(n)||n.length===0||(t.has(e)||t.set(e,[]),n.forEach(n=>{let{type:i,params:a}=K(n);t.get(e).push({id:r++,scope:e,type:i,params:a})}))};e?.use&&Array.isArray(e.use)&&e.use.length>0&&i(`use`,e.use),n.forEach(t=>{let n=e?e[t]:void 0;Array.isArray(n)&&n.length>0?i(t,n):n&&typeof n==`object`&&`use`in n&&Array.isArray(n.use)&&n.use.length>0&&i(t,n.use)}),j.value=Array.from(n),t.size===0&&t.set(`none`,[{id:r++,scope:`none`,type:``,params:{}}]),A.value=Array.from(t.entries()).map(([e,t])=>({scope:e,transformers:t}));let a=Array.from(t.values()).flat();M.value=a.length>0?Math.max(...a.map(e=>e.id))+1:1;let o={...N.value};a.forEach(e=>{o[e.id]===void 0&&(o[e.id]=!0)}),N.value=o}function K(e){let t=``,n={};if(typeof e==`string`)t=e,n={};else if(Array.isArray(e)){let[r,i]=e;t=r,n=i&&typeof i==`object`?{...i}:{}}if(t=D(t),t){let e=$(t);e.params&&e.params.length>0&&e.params.forEach(e=>{n[e.key]===void 0&&(e.type===`boolean`?n[e.key]=!1:n[e.key]=``)})}return{type:t,params:n}}function be(){let e={};A.value.forEach(t=>{if(t.scope===`none`)return;let n=[];t.transformers.forEach(e=>{if(!e.type.trim())return;let t=Te(e.params),r=E(e.type.trim()),i=t&&Object.keys(t).length>0?[r,t]:r;n.push(i)}),n.length>0&&(e[t.scope]=n)});let t={};return e.use?.length&&(t.use=e.use),j.value.forEach(n=>{let r=e[n];r?.length&&(t[n]={use:r})}),t}function q(){P.value=!0,k(`update:modelValue`,be())}function J(e){let t=e??`none`;A.value.push({scope:t,transformers:[{id:M.value++,scope:t,type:``,params:{}}]}),N.value[M.value-1]=!0,q()}function Y(e){let t=A.value.findIndex(t=>t.scope===e);if(t===-1)return;let n=A.value[t];n&&(n.transformers.forEach(e=>{delete N.value[e.id]}),A.value.splice(t,1),A.value.length===0?J(`none`):q())}function xe(e){let t=e.scope,n=e.transformers.map(e=>({id:M.value++,scope:t,type:e.type,params:JSON.parse(JSON.stringify(e.params))}));A.value.push({scope:t,transformers:n}),n.forEach(e=>{N.value[e.id]=!0}),q()}function Se(e,t){if(t===e.scope)return;let n=O.modelValue?.[t],r;if(Array.isArray(n)?r=n:n&&typeof n==`object`&&`use`in n&&(r=n.use),r&&r.length>0){let n=[];r.forEach(e=>{let{type:r,params:i}=K(e);n.push({id:M.value++,scope:t,type:r,params:i})}),e.transformers.forEach(e=>{delete N.value[e.id]}),e.transformers=n,e.scope=t,n.forEach(e=>{N.value[e.id]===void 0&&(N.value[e.id]=!0)})}else e.scope=t,e.transformers.forEach(e=>{e.scope=t});q()}function Ce(e,t){let n={id:M.value++,scope:e.scope,type:F.value[0]??``,params:{}};if(t){let r=e.transformers.findIndex(e=>e.id===t.id);r===-1?e.transformers.push(n):e.transformers.splice(r+1,0,n)}else e.transformers.push(n);N.value[n.id]=!1,q()}function we(e,t){let n=e.transformers.findIndex(e=>e.id===t.id);n!==-1&&(e.transformers.splice(n,1),delete N.value[t.id],e.transformers.length===0?Y(e.scope):q())}function X(e){let t=$(e.type),n=(t.params?.length??0)>0,r=e.type===`CustomParamsTransformer`,i=e.type===`CustomParamsTransformer`&&Object.keys(e.params||{}).some(n=>!new Set(t.params?.map(e=>e.key)??[]).has(n)&&e.params[n]!==void 0&&e.params[n]!==``);return n||r||i}function Z(e){N.value[e]=!N.value[e]}function Q(e,t){let n=e.type,r={...e.params};if(!t){e.type=``,e.params={},N.value[e.id]=!0,q();return}if(n===t)return;e.type=t;let i=$(n),a=$(t),o=new Set(i.params?.map(e=>e.key)??[]),s=new Set(a.params?.map(e=>e.key)??[]),c={};a.params&&a.params.length>0&&a.params.forEach(e=>{if(r[e.key]!==void 0){let t=r[e.key];c[e.key]=Ee(t,e.type)}else e.type===`boolean`?c[e.key]=!1:(e.type===`number`||e.type,c[e.key]=``)}),t===`CustomParamsTransformer`&&Object.entries(r).forEach(([e,t])=>{let n=!o.has(e),r=s.has(e);n&&!r&&(c[e]=t)}),e.params=c,X({...e,type:t,params:c})?N.value[e.id]===void 0&&(N.value[e.id]=!1):N.value[e.id]=!0,q()}function Te(e){let t={};return Object.entries(e).forEach(([e,n])=>{e.trim()!==``&&(t[e]=n)}),t}function $(e){let t=e===`CustomParamsTransformer`;return w[e]??{allowCustom:t,params:[]}}function Ee(e,t){if(t===`boolean`)return e===!0||e===`true`;if(t===`number`){let t=Number(e);return Number.isNaN(t)?e:t}if(t===`json`){let t=String(e);try{return JSON.parse(t)}catch{return t}}return e}function De(e){return $(e.type).params?.map(e=>e.key)??[]}return(t,r)=>(p(),l(`div`,re,[I.value?(p(),l(`div`,ie,[(p(!0),l(c,null,v(A.value,t=>(p(),l(`div`,{key:t.scope,class:`rounded-md border border-slate-300 bg-white/90 transition group`},[_(`div`,ae,[_(`div`,oe,[r[2]||=_(`label`,{class:`text-xs font-medium text-slate-600 shrink-0 whitespace-nowrap`},`作用域：`,-1),_(`div`,se,[e(S,{class:`w-full select-bordered`,"model-value":t.scope,options:_e.value,disabled:a.disabled,searchable:!1,clearable:!1,"dropdown-min-width":220,placeholder:`选择作用域`,"onUpdate:modelValue":e=>Se(t,e)},null,8,[`model-value`,`options`,`disabled`,`onUpdate:modelValue`])]),G(t.scope)?(p(),l(`div`,ce,[e(g(te),{class:`w-3 h-3`}),r[1]||=_(`span`,{class:`text-[10px] font-medium`},`作用域重复`,-1)])):d(``,!0),_(`div`,le,[_(`button`,{type:`button`,class:`p-1 text-slate-400 hover:text-sky-600 transition rounded`,title:`复制配置`,onClick:e=>xe(t),disabled:a.disabled},[e(g(ee),{class:`w-3 h-3`})],8,L),_(`button`,{type:`button`,class:`p-1 text-slate-400 hover:text-sky-600 transition rounded`,title:`添加作用域`,onClick:r[0]||=e=>J(),disabled:a.disabled},[e(g(C),{class:`w-3 h-3`})],8,R),_(`button`,{type:`button`,class:`p-1 text-slate-400 hover:text-red-500 transition rounded`,title:`删除配置`,onClick:e=>Y(t.scope),disabled:a.disabled},[e(g(x),{class:`w-3 h-3`})],8,z)])]),t.scope===`none`?d(``,!0):(p(),l(`div`,B,[(p(!0),l(c,null,v(t.transformers,r=>(p(),l(`div`,{key:r.id,class:`rounded border border-slate-200/60 bg-slate-50/40 p-1 space-y-0.5`},[_(`div`,V,[_(`button`,{type:`button`,class:`p-0.5 text-slate-400 hover:text-slate-600 transition rounded shrink-0`,onClick:e=>Z(r.id),disabled:a.disabled},[_(`div`,U,[X(r)?(p(),n(g(b),{key:0,class:u([`w-full h-full transition-transform`,N.value[r.id]?`-rotate-90`:``])},null,8,[`class`])):d(``,!0)])],8,H),_(`label`,{class:u([`text-[10px] font-medium text-slate-500 shrink-0 whitespace-nowrap`,{"cursor-pointer":X(r)}]),onClick:e=>X(r)&&Z(r.id)},`转换器：`,10,W),_(`div`,ue,[e(S,{class:`w-full select-bordered`,"model-value":r.type,options:ve.value,placeholder:O.placeholder??`选择或搜索转换器`,disabled:a.disabled||a.loading,clearable:!0,searchable:!0,"dropdown-min-width":260,"dropdown-max-height":300,"onUpdate:modelValue":e=>Q(r,e||``)},null,8,[`model-value`,`options`,`placeholder`,`disabled`,`onUpdate:modelValue`])]),_(`div`,de,[_(`button`,{type:`button`,class:`p-1 text-slate-400 hover:text-sky-600 transition rounded`,title:`添加转换器`,onClick:e=>Ce(t,r),disabled:a.disabled},[e(g(C),{class:`w-3 h-3`})],8,fe),_(`button`,{type:`button`,class:`p-1 text-slate-400 hover:text-red-500 transition rounded`,title:`删除转换器`,onClick:e=>we(t,r),disabled:a.disabled},[e(g(x),{class:`w-3 h-3`})],8,pe)])]),X(r)?h((p(),l(`div`,me,[e(ne,{"model-value":r.params,"readonly-keys":De(r),fields:$(r.type).params,"transformer-type":r.type,disabled:a.disabled,class:`pl-1`,"onUpdate:modelValue":e=>{r.params=e,q()}},null,8,[`model-value`,`readonly-keys`,`fields`,`transformer-type`,`disabled`,`onUpdate:modelValue`]),!$(r.type).params?.length&&$(r.type).allowCustom===!1&&Object.keys(r.params||{}).length===0?(p(),l(`div`,he,` 此转换器无需参数 `)):d(``,!0)],512)),[[i,!N.value[r.id]]]):d(``,!0)]))),128))]))])]))),128))])):(p(),l(`div`,ge,` 暂无配置项，点击"添加配置"按钮添加 `))]))}}),[[`__scopeId`,`data-v-f2ea8b46`]]);export{G as t};