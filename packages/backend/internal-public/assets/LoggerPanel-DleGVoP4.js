const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./useLlmApi-KVLBFRuJ.js","./useLlmApi-e_L-gZNA.js","./index-urHyhAmF.js","./index-DeS_E3jM.css"])))=>i.map(i=>d[i]);
import{t as e}from"./CheckOutlined-DEphouVW.js";import{t}from"./CodeOutlined-CLfIHCtY.js";import{t as n}from"./ContentCopyOutlined-BSSisDIl.js";import{n as r,t as i}from"./EditOutlined-CZHFqlPU.js";import{t as a}from"./DescriptionOutlined-BZtsuoqD.js";import{n as o,r as s,t as c}from"./PersonOutlined-CcvXTybv.js";import{n as l,t as u}from"./SearchOutlined-BTXNd_tE.js";import{n as d,t as f}from"./SettingsOutlined-BEqIuKuj.js";import{t as p}from"./VisibilityOutlined-yaS2V4O_.js";import{t as m}from"./WarningOutlined-BYCjiJjg.js";import{$t as h,An as g,Bn as _,Dn as v,En as y,It as b,Jt as x,Kt as S,Mt as C,Qn as w,Qt as T,Ut as E,Vn as D,Vt as O,Xt as k,Yn as A,Yt as j,Zn as M,a as N,cn as P,en as F,gn as I,i as L,jn as ee,kt as te,ln as R,mn as z,pn as ne,qn as B,qt as V,s as H,t as U,vn as W,yn as G,zt as K}from"./index-urHyhAmF.js";import"./editor.api-CN-1LKou.js";import"./monaco.contribution-DPTc76V3.js";import{t as re}from"./useLlmApi-e_L-gZNA.js";import{i as ie,p as ae}from"./dist-DmajSpNV.js";import{u as oe}from"./floating-ui.vue-C1NloyW1.js";import{t as q}from"./chevron-down-ByDMAM3t.js";import{t as se}from"./Popconfirm-2RVy9gVC.js";import{c as ce,d as le,f as J,i as ue,l as de,n as Y,o as fe,r as pe,t as me,u as he}from"./CollapsibleTrigger-BJjM-Dm8.js";import{t as ge}from"./trash-2-l40C5gd0.js";import{t as X}from"./utils-jrYJ9m3X.js";import{t as _e}from"./CodeEditor-BYu0j6s-.js";import{t as Z}from"./Input-DqR3mkMP.js";import{t as ve}from"./Dropdown-ocMVVnLy.js";var ye={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},be=F({name:`AutoAwesomeOutlined`,render:function(e,t){return I(),k(`svg`,ye,t[0]||=[V(`path`,{d:`M19 9l1.25-2.75L23 5l-2.75-1.25L19 1l-1.25 2.75L15 5l2.75 1.25zm0 6l-1.25 2.75L15 19l2.75 1.25L19 23l1.25-2.75L23 19l-2.75-1.25zm-7.5-5.5L9 4L6.5 9.5L1 12l5.5 2.5L9 20l2.5-5.5L17 12l-5.5-2.5zm-1.51 3.49L9 15.17l-.99-2.18L5.83 12l2.18-.99L9 8.83l.99 2.18l2.18.99l-2.18.99z`,fill:`currentColor`},null,-1)])}}),Q={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},xe=F({name:`InsertDriveFileOutlined`,render:function(e,t){return I(),k(`svg`,Q,t[0]||=[V(`path`,{d:`M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z`,fill:`currentColor`},null,-1)])}}),Se={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},Ce=F({name:`KeyboardArrowDownOutlined`,render:function(e,t){return I(),k(`svg`,Se,t[0]||=[V(`path`,{d:`M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6l-6-6l1.41-1.41z`,fill:`currentColor`},null,-1)])}}),we={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},Te=F({name:`SmartToyOutlined`,render:function(e,t){return I(),k(`svg`,we,t[0]||=[V(`path`,{d:`M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3zm-2 10H6V7h12v12zm-9-6c-.83 0-1.5-.67-1.5-1.5S8.17 10 9 10s1.5.67 1.5 1.5S9.83 13 9 13zm7.5-1.5c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5s1.5.67 1.5 1.5zM8 15h8v2H8v-2z`,fill:`currentColor`},null,-1)])}}),Ee={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},De=F({name:`WrapTextOutlined`,render:function(e,t){return I(),k(`svg`,Ee,t[0]||=[V(`path`,{d:`M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z`,fill:`currentColor`},null,-1)])}}),Oe=oe(`arrow-up`,[[`path`,{d:`m5 12 7-7 7 7`,key:`hav0vg`}],[`path`,{d:`M12 19V5`,key:`x0mq9r`}]]),ke={class:`flex items-center`},Ae={class:`flex items-center border border-slate-200 rounded-md shadow-sm overflow-hidden bg-white`},je=[`disabled`],Me=[`disabled`],Ne={class:`p-4 min-w-[280px]`},Pe={class:`flex items-center justify-between mb-4`},Fe=[`disabled`,`aria-checked`],Ie={class:`flex items-center gap-2`},Le={class:`text-xs text-slate-500 whitespace-nowrap`},Re=L(F({__name:`RefreshButton`,props:{isRefreshing:{type:Boolean},disabled:{type:Boolean}},emits:[`refresh`],setup(e,{emit:t}){let n=e,r=t,i=D(!1),a=D(!1),s=D(5),c=D(`5`),l=null,u=S(()=>`${s.value} 秒`);function f(){l&&=(clearInterval(l),null)}function p(){f(),a.value&&s.value>0&&(l=setInterval(()=>{!n.isRefreshing&&!n.disabled&&r(`refresh`)},s.value*1e3))}function m(){f()}v(a,e=>{e?p():m()}),v(c,e=>{let t=parseInt(e,10);if(!isNaN(t)&&t>0){let e=Math.max(1,Math.min(300,t));s.value=e,e!==t&&(c.value=e.toString())}}),v(s,()=>{a.value&&p()}),z(()=>{f()});function _(){r(`refresh`)}function y(){a.value=!a.value}return(t,n)=>(I(),k(`div`,ke,[V(`div`,Ae,[V(`button`,{onClick:_,type:`button`,disabled:e.disabled,class:A([`px-3 py-1.5 transition-all text-xs font-medium flex items-center gap-1.5 h-8 disabled:opacity-50 disabled:cursor-not-allowed`,[a.value?`bg-indigo-50 hover:bg-indigo-100 text-indigo-700`:`hover:bg-slate-50 text-slate-700`]]),title:`刷新`},[h(B(d),{class:A([`w-3.5 h-3.5`,{"animate-spin":e.isRefreshing,"auto-refresh-pulse":a.value&&!e.isRefreshing},e.disabled?`text-slate-400`:a.value?`text-indigo-600`:`text-slate-600`])},null,8,[`class`]),n[4]||=V(`span`,null,`刷新`,-1)],10,je),V(`div`,{class:A([`h-6 w-px`,a.value?`bg-indigo-200`:`bg-slate-200`])},null,2),V(`div`,{class:`relative`,onClick:n[3]||=K(()=>{},[`stop`])},[h(ve,{show:i.value,"onUpdate:show":n[2]||=e=>i.value=e,spacing:8,position:`bottom`},{trigger:g(()=>[V(`button`,{type:`button`,disabled:e.disabled,class:A([`px-2 py-1.5 hover:bg-slate-50 transition-all h-8 disabled:opacity-50 disabled:cursor-not-allowed`,e.disabled?``:`text-slate-700`]),title:`刷新设置`,onClick:n[0]||=K(e=>i.value=!i.value,[`stop`])},[h(B(o),{class:A([`w-3.5 h-3.5 transition-transform`,i.value?`rotate-180`:``,e.disabled?`text-slate-400`:`text-slate-600`])},null,8,[`class`])],10,Me)]),default:g(()=>[V(`div`,Ne,[V(`div`,Pe,[n[5]||=V(`div`,{class:`flex-1`},[V(`div`,{class:`text-sm font-medium text-slate-900 mb-0.5`},` 自动刷新 `),V(`div`,{class:`text-xs text-slate-500`},` 开启后，将按设定间隔自动刷新 `)],-1),V(`button`,{type:`button`,onClick:y,disabled:e.disabled,class:A([`relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed`,a.value?`bg-indigo-500`:`bg-slate-200`]),role:`switch`,"aria-checked":a.value},[V(`span`,{class:A([`pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out`,a.value?`translate-x-4`:`translate-x-0`])},null,2)],10,Fe)]),V(`div`,null,[n[6]||=V(`label`,{class:`block text-sm font-medium text-slate-900 mb-1.5`},` 刷新间隔（秒） `,-1),V(`div`,Ie,[h(Z,{modelValue:c.value,"onUpdate:modelValue":n[1]||=e=>c.value=e,type:`number`,min:1,max:300,class:`flex-1`,disabled:e.disabled||!a.value,placeholder:`5`},null,8,[`modelValue`,`disabled`]),V(`span`,Le,w(u.value),1)])])])]),_:1},8,[`show`])])])]))}}),[[`__scopeId`,`data-v-422253cd`]]),ze={class:`flex items-center gap-2`},Be={class:`flex items-center gap-2 flex-1 min-w-0`},Ve={key:0,class:`truncate text-xs`},He={class:`text-[12px] text-slate-600 leading-tight`},Ue={class:`text-[9px] text-slate-500 font-medium leading-tight align-right`},We={key:1,class:`text-slate-400 text-xs`},Ge={key:0,class:`absolute top-full left-0 mt-1 bg-white border border-slate-200 rounded-lg shadow-xl z-50 max-h-96 overflow-y-auto min-w-[280px]`},Ke=[`onClick`],qe={class:`flex items-start justify-between gap-3`},Je={class:`flex-1 min-w-0`},Ye={class:`text-sm text-slate-800 font-medium mb-1`},Xe={class:`text-xs text-slate-500 font-mono truncate`},Ze={class:`text-xs text-slate-400 whitespace-nowrap shrink-0`},Qe={key:0,class:`px-4 pt-4 pb-2 text-sm text-slate-400 text-center`},$e={class:`flex items-center gap-1 bg-slate-100 rounded-lg p-1`},et=L(F({__name:`LoggerHeaderControls`,props:{activeMode:{},logFiles:{},selectedLogFileObj:{},isRefreshing:{type:Boolean},isRefreshingMessages:{type:Boolean}},emits:[`update:activeMode`,`selectFile`,`refresh`,`refreshMessages`,`clearLog`],setup(e,{emit:t}){let n=te(),i=S(()=>n.name===`Logger`),s=t,c=D(!1);function l(e){if(!e||!e.lastModified)return``;try{let t=new Date(e.lastModified);return isNaN(t.getTime())?``:`${t.getFullYear()}年${String(t.getMonth()+1).padStart(2,`0`)}月${String(t.getDate()).padStart(2,`0`)}日 ${String(t.getHours()).padStart(2,`0`)}:${String(t.getMinutes()).padStart(2,`0`)}:${String(t.getSeconds()).padStart(2,`0`)}`}catch{return``}}function u(e){if(!e)return``;try{let t=new Date,n=new Date(e);if(isNaN(n.getTime()))return``;let r=t.getTime()-n.getTime(),i=Math.floor(r/6e4),a=Math.floor(r/36e5),o=Math.floor(r/864e5);return i<1?`刚刚`:i<60?`${i}分钟前`:a<1?`最近1小时`:a<24?`${a}小时前`:o<1?`最近1天`:o<7?`${o}天前`:o<30?`${Math.floor(o/7)}周前`:o<365?`${Math.floor(o/30)}个月前`:`${Math.floor(o/365)}年前`}catch{return``}}function d(e){s(`update:activeMode`,e)}return(t,n)=>(I(),x(E,{defer:``,to:`#header-right-target`,disabled:!i.value},[V(`div`,ze,[e.activeMode===`logs`?(I(),k(O,{key:0},[V(`div`,{class:`relative`,"data-log-dropdown":``,onClick:n[1]||=K(()=>{},[`stop`])},[V(`button`,{onClick:n[0]||=e=>c.value=!c.value,type:`button`,class:`bg-white border border-slate-200 text-sm rounded-md pl-8 pr-7 py-1.5 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 transition-all cursor-pointer text-slate-700 min-w-[240px] text-left flex items-center justify-between hover:border-slate-300 shadow-sm h-8`},[V(`div`,Be,[h(B(a),{class:`absolute left-2.5 w-4 h-4 text-slate-400 shrink-0`}),e.selectedLogFileObj?(I(),k(`span`,Ve,[V(`div`,He,w(l(e.selectedLogFileObj)),1),V(`div`,Ue,w(e.selectedLogFileObj.name),1)])):(I(),k(`span`,We,`选择日志文件`))]),h(B(o),{class:A([`w-3.5 h-3.5 text-slate-400 transition-transform shrink-0`,{"rotate-180":c.value}])},null,8,[`class`])]),c.value?(I(),k(`div`,Ge,[(I(!0),k(O,null,W(e.logFiles,t=>(I(),k(`div`,{key:t.path,onClick:e=>{s(`selectFile`,t),c.value=!1},class:A([`px-4 pt-4 pb-2 border-l-2 cursor-pointer transition-colors`,e.selectedLogFileObj?.path===t.path?`bg-indigo-50 border-indigo-500`:`border-transparent hover:bg-slate-50`])},[V(`div`,qe,[V(`div`,Je,[V(`div`,Ye,w(l(t)),1),V(`div`,Xe,w(t.name),1)]),V(`div`,Ze,w(u(t.lastModified)),1)])],10,Ke))),128)),e.logFiles.length===0?(I(),k(`div`,Qe,` 暂无日志文件 `)):j(``,!0)])):j(``,!0)]),e.selectedLogFileObj?(I(),x(Re,{key:0,"is-refreshing":e.isRefreshing,onRefresh:n[2]||=()=>s(`refresh`)},null,8,[`is-refreshing`])):j(``,!0),e.selectedLogFileObj?(I(),k(`button`,{key:1,onClick:n[3]||=e=>s(`clearLog`),type:`button`,class:`px-3 py-1.5 bg-white border border-rose-200 hover:bg-rose-50 rounded-md transition-all text-xs font-medium flex items-center gap-1.5 shadow-sm hover:shadow h-8 text-rose-600`,title:`清空当前日志内容`},[h(B(r),{class:`w-3.5 h-3.5`}),n[7]||=V(`span`,{class:`text-xs leading-none`},`清空`,-1)])):j(``,!0),n[8]||=V(`div`,{class:`h-6 w-px bg-slate-200 mx-2`},null,-1)],64)):j(``,!0),e.activeMode===`messages`?(I(),k(O,{key:1},[h(Re,{"is-refreshing":e.isRefreshingMessages,onRefresh:n[4]||=()=>s(`refreshMessages`)},null,8,[`is-refreshing`]),n[9]||=V(`div`,{class:`h-6 w-px bg-slate-200 mx-2`},null,-1)],64)):j(``,!0),V(`nav`,$e,[V(`button`,{onClick:n[5]||=e=>d(`messages`),class:A([`px-4 py-1 text-xs rounded-md font-medium transition-all flex items-center gap-2 border border-transparent`,e.activeMode===`messages`?`bg-white text-primary shadow-sm border border-primary/20`:`text-slate-500 hover:text-slate-700`])},` 对话查询 `,2),V(`button`,{onClick:n[6]||=e=>d(`logs`),class:A([`px-4 py-1 text-xs rounded-md font-medium transition-all flex items-center gap-2 border border-transparent`,e.activeMode===`logs`?`bg-white text-primary shadow-sm border border-primary/20`:`text-slate-500 hover:text-slate-700`])},` 完整日志 `,2)])])],8,[`disabled`]))}}),[[`__scopeId`,`data-v-d20aa45c`]]),tt={class:`relative time-range-picker`},nt={class:`block truncate text-xs`},rt={class:`w-full md:w-40 bg-slate-50 p-4 border-b md:border-b-0 md:border-r border-slate-200 space-y-1`},it=[`onClick`],at={key:0,class:`absolute left-0 top-0 bottom-0 w-[3px] bg-indigo-600`},ot={class:`p-6 flex flex-col gap-6 flex-1`},st={class:`flex flex-col sm:flex-row gap-8`},ct={class:`w-64`},lt={class:`flex items-center justify-between mb-4`},ut={class:`text-sm font-bold text-slate-700`},dt={class:`grid grid-cols-7 text-[10px] font-bold text-slate-400 mb-2 text-center`},ft={class:`grid grid-cols-7 gap-px bg-slate-100 border border-slate-100 rounded-lg overflow-hidden text-xs`},pt=[`onClick`],mt={class:`w-64`},ht={class:`flex items-center justify-between mb-4`},gt={class:`text-sm font-bold text-slate-700`},_t={class:`grid grid-cols-7 text-[10px] font-bold text-slate-400 mb-2 text-center`},vt={class:`grid grid-cols-7 gap-px bg-slate-100 border border-slate-100 rounded-lg overflow-hidden text-xs`},yt=[`onClick`],bt={class:`flex flex-col sm:flex-row items-center justify-between pt-6 border-t border-slate-100 gap-4`},xt={class:`flex items-center gap-3`},St={class:`flex items-center bg-slate-100 rounded-lg px-3 py-1.5`},Ct={class:`flex items-center bg-slate-100 rounded-lg px-3 py-1.5`},wt={class:`flex items-center gap-3 w-full sm:w-auto`},Tt=[`disabled`],Et=L(F({__name:`TimeRangePicker`,props:{modelValue:{}},emits:[`update:modelValue`],setup(e,{emit:t}){let n=e,r=t,i=D(!1),a=D(new Date),o=D(null),s=D(null),c=D(`00:00`),l=D(`23:59`),u=D(null),d=D({top:`0px`,left:`0px`,width:`100%`}),f=D(null),p=[{key:`hour`,label:`最近一小时`,getRange:()=>{let e=new Date;return{start:new Date(e.getTime()-3600*1e3),end:e}}},{key:`today`,label:`今天`,getRange:()=>{let e=new Date;return{start:new Date(e.getFullYear(),e.getMonth(),e.getDate()),end:new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59,999)}}},{key:`week`,label:`最近 7 天`,getRange:()=>{let e=new Date;return{start:new Date(e.getTime()-10080*60*1e3),end:e}}},{key:`month`,label:`最近一个月`,getRange:()=>{let e=new Date;return{start:new Date(e.getTime()-720*60*60*1e3),end:e}}},{key:`now`,label:`从现在开始`,getRange:()=>({start:new Date,end:null})}];function m(){if(n.modelValue?.start?(o.value=new Date(n.modelValue.start.getFullYear(),n.modelValue.start.getMonth(),n.modelValue.start.getDate()),c.value=`${String(n.modelValue.start.getHours()).padStart(2,`0`)}:${String(n.modelValue.start.getMinutes()).padStart(2,`0`)}`):(o.value=null,c.value=`00:00`),n.modelValue?.end?(s.value=new Date(n.modelValue.end.getFullYear(),n.modelValue.end.getMonth(),n.modelValue.end.getDate()),l.value=`${String(n.modelValue.end.getHours()).padStart(2,`0`)}:${String(n.modelValue.end.getMinutes()).padStart(2,`0`)}`):(s.value=null,l.value=`23:59`),u.value=null,n.modelValue?.start)for(let e of p){let t=e.getRange();if(h(n.modelValue.start)===h(t.start)&&(!n.modelValue.end||!t.end||h(n.modelValue.end)===h(t.end))){u.value=e.key;break}}}v(()=>n.modelValue,()=>{m()},{deep:!0,immediate:!0});function h(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,`0`)}-${String(e.getDate()).padStart(2,`0`)}`}function g(e){if(!o.value)return!1;let t=h(e),n=h(o.value);if(s.value){let e=h(s.value);return t>=n&&t<=e}return t===n}function _(e){return o.value?h(e)===h(o.value):!1}function y(e){return s.value?h(e)===h(s.value):!1}let C=S(()=>new Date(a.value.getFullYear(),a.value.getMonth(),1)),N=S(()=>new Date(a.value.getFullYear(),a.value.getMonth()+1,1));function P(e){let t=e.getFullYear(),n=e.getMonth(),r=new Date(t,n,1).getDay(),i=new Date(t,n+1,0).getDate(),a=new Date(t,n,0).getDate(),o=[];for(let e=r;e>0;e--){let r=new Date(t,n-1,a-e+1);o.push({date:r,isCurrentMonth:!1})}for(let e=1;e<=i;e++){let r=new Date(t,n,e);o.push({date:r,isCurrentMonth:!0})}let s=42-o.length;for(let e=1;e<=s;e++){let r=new Date(t,n+1,e);o.push({date:r,isCurrentMonth:!1})}return o}let F=S(()=>P(C.value)),L=S(()=>P(N.value)),te=S(()=>`${C.value.getFullYear()}年 ${C.value.getMonth()+1}月`),B=S(()=>`${N.value.getFullYear()}年 ${N.value.getMonth()+1}月`),H=[`日`,`一`,`二`,`三`,`四`,`五`,`六`];function U(e){!o.value||s.value&&e<o.value?(o.value=new Date(e),s.value=null,u.value=null):!s.value||e>=o.value?(s.value=new Date(e),u.value=null):(s.value=o.value,o.value=new Date(e),u.value=null)}function G(e){let t=new Date(a.value);t.setMonth(t.getMonth()+e),a.value=t}function re(e){let t=e.getRange();o.value=new Date(t.start.getFullYear(),t.start.getMonth(),t.start.getDate()),c.value=`${String(t.start.getHours()).padStart(2,`0`)}:${String(t.start.getMinutes()).padStart(2,`0`)}`,t.end?(s.value=new Date(t.end.getFullYear(),t.end.getMonth(),t.end.getDate()),l.value=`${String(t.end.getHours()).padStart(2,`0`)}:${String(t.end.getMinutes()).padStart(2,`0`)}`):(s.value=null,l.value=`23:59`),u.value=e.key,a.value=new Date(t.start)}function ie(){if(!o.value)return;let e=c.value.split(`:`).map(Number),t=e[0]??0,n=e[1]??0,a=new Date(o.value);a.setHours(t,n,0,0);let u=null;if(s.value){let e=l.value.split(`:`).map(Number),t=e[0]??23,n=e[1]??59;u=new Date(s.value),u.setHours(t,n,59,999)}r(`update:modelValue`,{start:a,end:u}),i.value=!1}function ae(){i.value=!1}function oe(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function q(e){return`${String(e.getHours()).padStart(2,`0`)}:${String(e.getMinutes()).padStart(2,`0`)}`}function se(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,`0`)}-${String(e.getDate()).padStart(2,`0`)}`}function ce(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,`0`)}-${String(e.getDate()).padStart(2,`0`)} ${String(e.getHours()).padStart(2,`0`)}:${String(e.getMinutes()).padStart(2,`0`)}`}let le=S(()=>{if(!n.modelValue?.start)return`选择时间范围`;let e=n.modelValue.start;if(!n.modelValue?.end)return`从 ${ce(e)}`;let t=n.modelValue.end;return oe(e,t)?`${q(e)} - ${q(t)}`:`${se(e)} - ${se(t)}`});function J(){if(!f.value||!i.value)return;let e=f.value.getBoundingClientRect(),t=window.innerWidth,n=e.left+window.scrollX;n+800+16>t+window.scrollX&&(n=t+window.scrollX-800-16),n<window.scrollX+16&&(n=window.scrollX+16);let r=e.bottom+window.scrollY+8,a=window.innerHeight;e.bottom+500+16>a&&(r=e.top+window.scrollY-500-8,r<window.scrollY+16&&(r=window.scrollY+16)),d.value={top:`${r}px`,left:`${n}px`,width:`${Math.min(800,t-32)}px`}}v(i,async e=>{e?(await R(),J(),window.addEventListener(`resize`,J),window.addEventListener(`scroll`,J,!0)):(window.removeEventListener(`resize`,J),window.removeEventListener(`scroll`,J,!0))});function ue(e){e.target.closest(`.time-range-picker`)||(i.value=!1)}return ne(()=>{document.addEventListener(`click`,ue),m()}),z(()=>{document.removeEventListener(`click`,ue)}),(t,n)=>(I(),k(`div`,tt,[V(`button`,{ref_key:`triggerRef`,ref:f,onClick:n[0]||=K(e=>i.value=!i.value,[`stop`]),type:`button`,class:A([`w-full bg-white border border-slate-200 text-sm rounded-lg pl-9 pr-4 py-2 text-left focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 transition-all hover:border-slate-300`,{"text-slate-900":e.modelValue?.start,"text-slate-400":!e.modelValue?.start}])},[n[6]||=V(`svg`,{class:`absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`},[V(`path`,{"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-width":`2`,d:`M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z`})],-1),V(`span`,nt,w(le.value),1)],2),i.value?(I(),x(E,{key:0,to:`body`},[V(`div`,{onClick:n[5]||=K(()=>{},[`stop`]),class:`fixed bg-white rounded-2xl shadow-2xl border border-slate-200 flex flex-col md:flex-row`,style:M({top:d.value.top,left:d.value.left,width:d.value.width,zIndex:9999})},[V(`div`,rt,[n[7]||=V(`p`,{class:`text-[11px] font-bold text-slate-400 mb-3 uppercase tracking-wider px-2`},` 快捷方案 `,-1),(I(),k(O,null,W(p,e=>V(`button`,{key:e.key,onClick:t=>re(e),type:`button`,class:A([`w-full text-left px-3 py-1.5 text-xs transition-all relative`,{"text-indigo-600 bg-white font-semibold":u.value===e.key,"text-slate-600 hover:bg-white":u.value!==e.key}])},[u.value===e.key?(I(),k(`span`,at)):j(``,!0),T(` `+w(e.label),1)],10,it)),64))]),V(`div`,ot,[V(`div`,st,[V(`div`,ct,[V(`div`,lt,[V(`button`,{onClick:n[1]||=e=>G(-1),type:`button`,class:`p-1 hover:bg-slate-100 rounded-full text-slate-400`},[...n[8]||=[V(`svg`,{class:`w-4 h-4`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`},[V(`path`,{d:`M15 19l-7-7 7-7`,"stroke-width":`2`,"stroke-linecap":`round`,"stroke-linejoin":`round`})],-1)]]),V(`span`,ut,w(te.value),1),n[9]||=V(`div`,{class:`w-6`},null,-1)]),V(`div`,dt,[(I(),k(O,null,W(H,e=>V(`div`,{key:e},w(e),1)),64))]),V(`div`,ft,[(I(!0),k(O,null,W(F.value,(e,t)=>(I(),k(`button`,{key:t,onClick:t=>U(e.date),type:`button`,class:A([`py-2 text-center transition-colors`,{"bg-white text-slate-200":!e.isCurrentMonth,"bg-white text-slate-700 hover:bg-indigo-50 cursor-pointer":e.isCurrentMonth&&!g(e.date)&&!_(e.date)&&!y(e.date),"bg-indigo-600 text-white font-bold":_(e.date)||y(e.date),"bg-indigo-50 text-indigo-700 cursor-pointer":g(e.date)&&!_(e.date)&&!y(e.date)}])},w(e.date.getDate()),11,pt))),128))])]),V(`div`,mt,[V(`div`,ht,[n[11]||=V(`div`,{class:`w-6`},null,-1),V(`span`,gt,w(B.value),1),V(`button`,{onClick:n[2]||=e=>G(1),type:`button`,class:`p-1 hover:bg-slate-100 rounded-full text-slate-400`},[...n[10]||=[V(`svg`,{class:`w-4 h-4`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`},[V(`path`,{d:`M9 5l7 7-7 7`,"stroke-width":`2`,"stroke-linecap":`round`,"stroke-linejoin":`round`})],-1)]])]),V(`div`,_t,[(I(),k(O,null,W(H,e=>V(`div`,{key:e},w(e),1)),64))]),V(`div`,vt,[(I(!0),k(O,null,W(L.value,(e,t)=>(I(),k(`button`,{key:t,onClick:t=>U(e.date),type:`button`,class:A([`py-2 text-center transition-colors`,{"bg-white text-slate-200":!e.isCurrentMonth,"bg-white text-slate-700 hover:bg-indigo-50 cursor-pointer":e.isCurrentMonth&&!g(e.date)&&!_(e.date)&&!y(e.date),"bg-indigo-600 text-white font-bold":_(e.date)||y(e.date),"bg-indigo-50 text-indigo-700 cursor-pointer":g(e.date)&&!_(e.date)&&!y(e.date)}])},w(e.date.getDate()),11,yt))),128))])])]),V(`div`,bt,[V(`div`,xt,[V(`div`,St,[n[12]||=V(`span`,{class:`text-[10px] font-bold text-slate-400 mr-2 uppercase`},`From`,-1),ee(V(`input`,{"onUpdate:modelValue":n[3]||=e=>c.value=e,type:`time`,class:`bg-transparent text-sm font-medium outline-none text-slate-700`},null,512),[[b,c.value]])]),n[14]||=V(`span`,{class:`text-slate-300`},`—`,-1),V(`div`,Ct,[n[13]||=V(`span`,{class:`text-[10px] font-bold text-slate-400 mr-2 uppercase`},`To`,-1),ee(V(`input`,{"onUpdate:modelValue":n[4]||=e=>l.value=e,type:`time`,class:`bg-transparent text-sm font-medium outline-none text-slate-700`},null,512),[[b,l.value]])])]),V(`div`,wt,[V(`button`,{onClick:ae,type:`button`,class:`flex-1 sm:flex-none px-6 py-2 text-sm font-medium text-slate-500 hover:text-slate-700 transition-colors`},` 取消 `),V(`button`,{onClick:ie,type:`button`,disabled:!o.value,class:`flex-1 sm:flex-none px-8 py-2 text-sm font-bold text-white bg-indigo-600 rounded-xl shadow-lg shadow-indigo-200 hover:bg-indigo-700 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:active:scale-100`},` 确定 `,8,Tt)])])])],4)])):j(``,!0)]))}}),[[`__scopeId`,`data-v-a27bae49`]]),Dt={class:`h-full flex flex-col bg-white border-r border-slate-200`},Ot={class:`p-4 border-b border-slate-200 bg-slate-50 overflow-hidden`},kt={class:`mb-3 flex items-center gap-2 overflow-hidden`},At={class:`flex-1 w-full overflow-hidden`},jt={key:0,class:`h-[38px] pl-3 flex items-center justify-between border border-slate-200 rounded-md bg-white`},Mt={class:`flex items-center gap-2 flex-wrap py-1`},Nt={class:`flex items-center gap-1.5 cursor-pointer`},Pt=[`checked`],Ft=[`onClick`,`disabled`],It=[`title`],Lt={class:`flex gap-1 flex-wrap`},Rt={key:0,class:`p-8 text-center text-slate-400`},zt={key:1,class:`p-8 text-center text-slate-400`},Bt=[`onClick`],Vt=[`onClick`],Ht=[`checked`,`onChange`],Ut=[`title`],Wt=[`title`],Gt={class:`flex items-center gap-1.5 flex-wrap`},Kt={key:0,class:`inline-flex items-center px-2 py-0.5 rounded-md text-[10px] font-medium bg-gradient-to-r from-green-50 to-green-50/80 text-green-700 border border-green-200/60 shadow-sm whitespace-nowrap`},qt={key:1,class:`inline-flex items-center px-2 py-0.5 rounded-md text-[10px] font-medium bg-gradient-to-r from-blue-50 to-blue-50/80 text-blue-700 border border-blue-200/60 shadow-sm whitespace-nowrap`},Jt={key:2,class:`inline-flex items-center px-2 py-0.5 rounded-md text-[10px] font-medium bg-gradient-to-r from-purple-50 to-purple-50/80 text-purple-700 border border-purple-200/60 shadow-sm whitespace-nowrap`},Yt={class:`absolute bottom-4 right-4`},Xt={class:`text-xs text-slate-400 font-medium`},Zt={key:3,class:`p-4 text-center border-t border-slate-200 bg-slate-50`},Qt={class:`flex items-center justify-center gap-2 text-slate-500`},$t={key:4,class:`p-4 text-center border-t border-slate-200 bg-slate-50`},en=F({__name:`MessageList`,props:{messages:{},selectedMessageId:{},searchQuery:{},filterTag:{},isLoading:{type:Boolean},isLoadingMore:{type:Boolean},hasMore:{type:Boolean},isRefreshing:{type:Boolean}},emits:[`update:selectedMessageId`,`update:filterTag`,`update:searchQuery`,`refresh`,`load-more`],setup(e,{emit:t}){let n=e,r=t,{deleteMessages:i}=re(),a=D(!1),o=D(new Set),s=D(!1),c=D(null);function l(){a.value=!a.value,a.value||(o.value.clear(),c.value=null)}let u=S(()=>F.value.length>0&&F.value.every(e=>o.value.has(e.requestId))),d=S(()=>o.value.size>0);function f(e,t){t&&t.stopPropagation(),o.value.has(e)?o.value.delete(e):o.value.add(e),a.value&&r(`update:selectedMessageId`,e)}function p(e,t,n){if(!a.value){r(`update:selectedMessageId`,e);return}if(n.shiftKey&&c.value!==null){let n=Math.min(c.value,t),i=Math.max(c.value,t),a=F.value[c.value];if(!a){c.value=t,f(e);return}let s=o.value.has(a.requestId);for(let e=n;e<=i;e++){let t=F.value[e];t&&(s?o.value.add(t.requestId):o.value.delete(t.requestId))}r(`update:selectedMessageId`,e)}else f(e),c.value=t}function m(){F.value.forEach(e=>{o.value.add(e.requestId)})}function _(){F.value.forEach(e=>{o.value.delete(e.requestId)})}function v(){F.value.forEach(e=>{o.value.has(e.requestId)?o.value.delete(e.requestId):o.value.add(e.requestId)})}function y(){u.value?_():m()}async function b(){if(!d.value||s.value)return;let e=Array.from(o.value);s.value=!0;try{let t=await i(e);t.success?(o.value.clear(),n.selectedMessageId&&e.includes(n.selectedMessageId)&&r(`update:selectedMessageId`,null),r(`refresh`)):console.error(`删除消息失败:`,t.message)}catch(e){console.error(`删除消息失败:`,e)}finally{s.value=!1}}let C=D({start:null,end:null}),T=D(Date.now()),E=null,M=D(null),N=null;function P(e){let t=e.target;if(!t||N!==null)return;N=window.setTimeout(()=>{N=null},200);let i=t.scrollTop,a=t.scrollHeight,o=t.clientHeight;a-i-o<100&&n.hasMore&&!n.isLoading&&r(`load-more`)}ne(async()=>{E=window.setInterval(()=>{T.value=Date.now()},6e4),await R(),M.value&&M.value.addEventListener(`scroll`,P)}),z(()=>{E!==null&&clearInterval(E),N!==null&&clearTimeout(N),M.value&&M.value.removeEventListener(`scroll`,P)});let F=S(()=>{let e=n.messages;if(n.searchQuery){let t=n.searchQuery.toLowerCase();e=e.filter(e=>e.requestId.toLowerCase().includes(t)||e.model&&e.model.toLowerCase().includes(t)||e.timestamp&&e.timestamp.toLowerCase().includes(t))}return(C.value.start||C.value.end)&&(e=e.filter(e=>{if(!e.timestamp)return!1;try{let t=new Date(e.timestamp).getTime();if(isNaN(t))return!1;let n=C.value.start?.getTime()??null,r=C.value.end?.getTime()??null;return!(n!==null&&t<n||r!==null&&t>r)}catch{return!1}})),e});function L(e){if(!e)return``;try{let t=new Date(e);if(isNaN(t.getTime()))return``;let n=T.value-t.getTime(),r=Math.floor(n/1e3),i=Math.floor(n/6e4),a=Math.floor(n/36e5),o=Math.floor(n/864e5);return r<10?`刚刚`:r<60?`${r}秒前`:i<60?`${i}分钟前`:a<24?`${a}小时前`:o<7?`${o}天前`:o<30?`${Math.floor(o/7)}周前`:o<365?`${Math.floor(o/30)}个月前`:`${Math.floor(o/365)}年前`}catch{return``}}return(t,n)=>(I(),k(`div`,Dt,[V(`div`,Ot,[V(`div`,kt,[V(`div`,At,[a.value?(I(),k(`div`,jt,[V(`div`,Mt,[V(`label`,Nt,[V(`input`,{type:`checkbox`,checked:u.value,onChange:y,class:`w-4 h-4 text-indigo-600 border-slate-300 rounded focus:ring-indigo-500`},null,40,Pt),n[6]||=V(`span`,{class:`text-xs text-slate-600 font-medium`},`全选`,-1)]),V(`button`,{onClick:v,type:`button`,class:`px-2 py-1 text-xs font-medium text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors`,title:`反选`},` 反选 `)]),d.value?(I(),x(se,{key:0,title:`删除消息`,description:`确定要删除选中的 ${o.value.size} 条消息吗？此操作不可撤销。`,type:`danger`,"confirm-text":`删除`,onConfirm:b},{reference:g(({toggle:e})=>[V(`button`,{onClick:K(e,[`stop`]),type:`button`,disabled:s.value,class:`px-3 py-1 hover:border-red-200 hover:text-red-600 rounded-md transition-all text-xs font-medium flex items-center gap-1.5 h-8 text-slate-600 disabled:opacity-50 disabled:cursor-not-allowed`,title:`删除选中消息`},[h(B(ge),{class:`w-3.5 h-3.5`}),V(`span`,null,`(`+w(o.value.size)+`)`,1)],8,Ft)]),_:1},8,[`description`])):j(``,!0)])):(I(),x(Et,{key:1,modelValue:C.value,"onUpdate:modelValue":n[0]||=e=>C.value=e},null,8,[`modelValue`]))]),V(`button`,{onClick:l,type:`button`,class:A([`px-3 py-1.5 rounded-md text-xs font-medium border transition-all flex items-center gap-1.5 shadow-sm hover:shadow h-8`,a.value?`bg-indigo-600 text-white border-indigo-600 hover:bg-indigo-700`:`bg-white text-slate-600 border-slate-200 hover:bg-slate-100`]),title:a.value?`退出多选模式`:`进入多选模式`},[a.value?(I(),x(B(he),{key:0,class:`w-3.5 h-3.5`})):(I(),x(B(de),{key:1,class:`w-3.5 h-3.5`})),V(`span`,null,w(a.value?`退出`:`多选`),1)],10,It)]),V(`div`,Lt,[V(`button`,{onClick:n[1]||=e=>r(`update:filterTag`,`all`),class:A([`px-3 py-1.5 rounded-md text-xs font-medium border border-slate-200`,e.filterTag===`all`?`bg-indigo-600 text-white shadow-sm`:`bg-white text-slate-600 hover:bg-slate-100`])},` 全部 (`+w(F.value.length)+`) `,3),V(`button`,{onClick:n[2]||=e=>r(`update:filterTag`,`completed`),class:A([`px-3 py-1.5 rounded-md text-xs font-medium border border-slate-200`,e.filterTag===`completed`?`bg-indigo-600 text-white shadow-sm`:`bg-white text-slate-600 hover:bg-slate-100`])},` 已完成 `,2),V(`button`,{onClick:n[3]||=e=>r(`update:filterTag`,`pending`),class:A([`px-3 py-1.5 rounded-md text-xs font-medium border border-slate-200`,e.filterTag===`pending`?`bg-indigo-600 text-white shadow-sm`:`bg-white text-slate-600 hover:bg-slate-100`])},` 未完成 `,2),V(`button`,{onClick:n[4]||=e=>r(`update:filterTag`,`error`),class:A([`px-3 py-1.5 rounded-md text-xs font-medium border border-slate-200`,e.filterTag===`error`?`bg-indigo-600 text-white shadow-sm`:`bg-white text-slate-600 hover:bg-slate-100`])},` 错误 `,2)])]),V(`div`,{ref_key:`scrollContainer`,ref:M,class:`flex-1 overflow-y-auto relative`},[e.isLoading&&e.messages.length===0?(I(),k(`div`,Rt,[...n[7]||=[V(`p`,{class:`text-sm`},`加载中...`,-1)]])):F.value.length===0?(I(),k(`div`,zt,[...n[8]||=[V(`p`,{class:`text-sm`},`没有找到匹配的对话`,-1)]])):(I(!0),k(O,{key:2},W(F.value,(t,r)=>(I(),k(`div`,{key:t.requestId,onClick:e=>p(t.requestId,r,e),class:A([`p-4 border-b border-slate-100 cursor-pointer transition-all relative`,e.selectedMessageId===t.requestId?`bg-indigo-50/50 border-l-4 border-l-indigo-600 shadow-sm`:`border-l-4 border-l-transparent `,a.value&&o.value.has(t.requestId)?`bg-indigo-100/50`:`hover:bg-slate-50/80`])},[a.value?(I(),k(`div`,{key:0,class:`absolute left-4 top-4 z-10`,onClick:K(e=>f(t.requestId,e),[`stop`])},[V(`input`,{type:`checkbox`,checked:o.value.has(t.requestId),onChange:e=>f(t.requestId,e),onClick:n[5]||=K(()=>{},[`stop`]),class:`w-4 h-4 text-indigo-600 border-slate-300 rounded focus:ring-indigo-500 cursor-pointer`},null,40,Ht)],8,Vt)):j(``,!0),V(`div`,{class:A(a.value?`pr-16 pl-8`:`pr-16`)},[t.model?(I(),k(`div`,{key:0,class:`font-mono text-sm font-bold text-slate-800 mb-2 line-clamp-2 break-words`,title:t.model},w(t.model),9,Ut)):j(``,!0),t.requestId?(I(),k(`div`,{key:1,class:`text-xs font-mono text-slate-500 mb-2 truncate`,title:t.requestId},w(t.requestId),9,Wt)):j(``,!0),V(`div`,Gt,[t.hasRequest?(I(),k(`span`,Kt,`请求`)):j(``,!0),t.hasResponse?(I(),k(`span`,qt,`响应`)):j(``,!0),t.hasStreamResponse?(I(),k(`span`,Jt,`流式`)):j(``,!0)])],2),V(`div`,Yt,[V(`span`,Xt,w(L(t.timestamp)),1)])],10,Bt))),128)),e.isLoadingMore?(I(),k(`div`,Zt,[V(`div`,Qt,[h(B(J),{class:`w-4 h-4 animate-spin`}),n[9]||=V(`span`,{class:`text-xs font-medium`},`加载更多...`,-1)])])):!e.hasMore&&F.value.length>0?(I(),k(`div`,$t,[...n[10]||=[V(`span`,{class:`text-xs text-slate-400`},`没有更多数据了`,-1)]])):j(``,!0)],512)]))}}),tn=[`title`],nn={key:2},rn={key:3},an=[`title`],on=F({__name:`MessageActionButtons`,props:{itemType:{},itemData:{},shouldShowCollapse:{type:Boolean,default:!1},isCollapsed:{type:Boolean,default:!1},collapsedCharCount:{default:0},isCopySuccess:{type:Boolean,default:!1},hasScrollbar:{type:Boolean,default:!1},wordWrap:{type:Boolean,default:!1}},emits:[`toggle-collapse`,`copy-item`,`toggle-word-wrap`],setup(t,{emit:r}){let i=t,a=r;function c(){switch(i.itemType){case`message`:return{copyButtonClass:`text-slate-400 hover:text-slate-600`,copySuccessClass:`text-green-600`,collapseButtonClass:`text-slate-400 hover:text-slate-600`,wrapButtonClass:`text-slate-400 hover:text-slate-600`,wrapButtonActiveClass:`text-indigo-600 hover:text-indigo-700`,hoverBgClass:`hover:bg-slate-100`,borderColor:`border-slate-100`};case`full_response`:return{copyButtonClass:`text-green-500 hover:text-green-700`,copySuccessClass:`text-green-600`,collapseButtonClass:`text-green-500 hover:text-green-700`,wrapButtonClass:`text-green-500 hover:text-green-700`,wrapButtonActiveClass:`text-green-600 hover:text-green-700`,hoverBgClass:`hover:bg-green-100`,borderColor:`border-green-100`};case`error`:return{copyButtonClass:`text-red-500 hover:text-red-700`,copySuccessClass:`text-green-600`,collapseButtonClass:`text-red-500 hover:text-red-700`,wrapButtonClass:`text-red-500 hover:text-red-700`,wrapButtonActiveClass:`text-red-600 hover:text-red-700`,hoverBgClass:`hover:bg-red-100`,borderColor:`border-red-100`};default:return{copyButtonClass:`text-slate-400 hover:text-slate-600`,copySuccessClass:`text-green-600`,collapseButtonClass:`text-slate-400 hover:text-slate-600`,wrapButtonClass:`text-slate-400 hover:text-slate-600`,wrapButtonActiveClass:`text-indigo-600 hover:text-indigo-700`,hoverBgClass:`hover:bg-slate-100`,borderColor:`border-slate-100`}}}let{copyButtonClass:l,copySuccessClass:u,collapseButtonClass:d,wrapButtonClass:f,wrapButtonActiveClass:p,hoverBgClass:m,borderColor:g}=c();return(r,i)=>(I(),k(`div`,{class:A([`sticky bottom-0 flex items-center justify-end gap-1 pt-1 pb-2 px-4 border-t bg-inherit z-10 -mx-4 rounded-b-2xl`,B(g)])},[V(`button`,{onClick:i[0]||=e=>a(`toggle-word-wrap`),class:A([`text-xs p-1.5 rounded transition-colors duration-200`,[B(m),t.wordWrap?B(p):B(f)]]),title:t.wordWrap?`关闭自动换行`:`开启自动换行`},[h(B(De),{class:`w-3.5 h-3.5`})],10,tn),t.shouldShowCollapse?(I(),k(`button`,{key:0,onClick:i[1]||=e=>a(`toggle-collapse`),class:A([`text-xs px-2 py-1 rounded flex items-center gap-1 transition-colors duration-200`,[B(m),B(d)]])},[t.isCollapsed?(I(),x(B(o),{key:0,class:`w-3.5 h-3.5`})):(I(),x(B(s),{key:1,class:`w-3.5 h-3.5`})),t.isCollapsed?(I(),k(`span`,nn,` 展开 (`+w(t.collapsedCharCount)+` 字符) `,1)):(I(),k(`span`,rn,`折叠`))],2)):j(``,!0),V(`button`,{onClick:i[2]||=e=>a(`copy-item`),class:A([`text-xs p-1.5 rounded transition-colors duration-200`,[B(m),t.isCopySuccess?B(u):B(l)]]),title:t.isCopySuccess?`已复制!`:`复制对象数据`},[t.isCopySuccess?(I(),x(B(e),{key:0,class:`w-3.5 h-3.5`})):(I(),x(B(n),{key:1,class:`w-3.5 h-3.5`}))],10,an)],2))}}),sn={key:0,class:`bg-slate-100 border border-slate-200 rounded-lg p-3 mb-1 shadow-sm`},cn={class:`flex items-center gap-2 mb-2`},ln={class:`text-xs font-mono text-indigo-600`},un={class:`flex items-center gap-2 mb-3 px-2 py-1 bg-gray-200 rounded border border-slate-100`},dn={class:`text-xs font-mono text-slate-700 truncate`},fn={key:0,class:`rounded border border-slate-100 overflow-hidden`},pn={key:0,class:`p-3 text-xs text-slate-600`},mn={key:0,class:`space-y-1`},hn={class:`text-red-600`},gn={class:`text-green-600`},_n={key:1,class:`text-green-600`},vn={key:2,class:`text-red-600`},yn={key:1,class:`text-[10px] text-slate-500 mt-2`},bn={key:1,class:`bg-slate-100 border border-slate-200 rounded-lg p-3 mb-1 shadow-sm`},xn={class:`flex items-center gap-2 mb-1`},Sn={class:`text-xs font-mono text-indigo-600`},Cn={key:0,class:`text-xs font-mono text-slate-700`},wn={key:0,class:`whitespace-pre-wrap`},Tn={key:1,class:`whitespace-pre-wrap`},En={key:1,class:`text-[10px] text-slate-500 mt-1`},Dn=L(F({__name:`ToolUseEdit`,props:{toolData:{},isCollapsed:{type:Boolean,default:!1}},setup(e){let t=e,n=S(()=>t.toolData?.name===`Edit`||t.toolData?.name?.toLowerCase().includes(`edit`)||t.toolData?.input&&(t.toolData.input.old_string||t.toolData.input.new_string)),r=S(()=>t.toolData?.input?.path||t.toolData?.input?.file_path||`Unknown file`),a=S(()=>t.toolData?.input?.old_string||``),o=S(()=>t.toolData?.input?.new_string||``),s=S(()=>t.toolData?.name||`Edit`),c=S(()=>t.toolData?.id||``),l=S(()=>{let e=r.value;return e.length>50?`...`+e.substring(e.length-47):e});return(t,r)=>n.value?(I(),k(`div`,sn,[V(`div`,cn,[h(B(i),{class:`w-4 h-4 text-slate-600`}),r[0]||=V(`span`,{class:`text-xs font-bold text-slate-600 uppercase`},`Tool Use:`,-1),V(`span`,ln,w(s.value),1)]),V(`div`,un,[h(B(xe),{class:`w-3.5 h-3.5 text-slate-500`}),V(`span`,dn,w(l.value),1)]),a.value||o.value?(I(),k(`div`,fn,[e.isCollapsed?(I(),k(`div`,pn,[a.value&&o.value?(I(),k(`div`,mn,[V(`div`,hn,` - `+w(a.value.trim().substring(0,100))+w(a.value.length>100?`...`:``),1),V(`div`,gn,` + `+w(o.value.trim().substring(0,100))+w(o.value.length>100?`...`:``),1)])):o.value?(I(),k(`div`,_n,` + `+w(o.value.trim().substring(0,200))+w(o.value.length>200?`...`:``),1)):a.value?(I(),k(`div`,vn,` - `+w(a.value.trim().substring(0,200))+w(a.value.length>200?`...`:``),1)):j(``,!0)])):(I(),x(ce,{key:1,"old-text":a.value,"new-text":o.value},null,8,[`old-text`,`new-text`]))])):j(``,!0),c.value?(I(),k(`div`,yn,`ID: `+w(c.value),1)):j(``,!0)])):(I(),k(`div`,bn,[V(`div`,xn,[r[1]||=V(`span`,{class:`text-xs font-bold text-slate-600 uppercase`},`Tool Use:`,-1),V(`span`,Sn,w(s.value),1)]),e.toolData?.input?(I(),k(`div`,Cn,[e.isCollapsed?(I(),k(`pre`,wn,w(JSON.stringify(e.toolData.input,null,2).trim().substring(0,200)+`...`),1)):(I(),k(`pre`,Tn,w(JSON.stringify(e.toolData.input,null,2).trim()),1))])):j(``,!0),c.value?(I(),k(`div`,En,`ID: `+w(c.value),1)):j(``,!0)]))}}),[[`__scopeId`,`data-v-dc4f85d3`]]),On={key:0,class:`flex flex-col items-center`},kn=[`src`,`alt`],An={class:`mt-4 text-white text-sm text-center bg-black bg-opacity-50 px-4 py-2 rounded-lg pointer-events-none`},jn={key:0,class:`text-xs text-slate-300 mt-1`},Mn={key:1,class:`text-xs text-slate-300 mt-1`},Nn={key:1,class:`text-center text-white`},Pn=.5,Fn=5,In=.1,Ln=F({__name:`ImagePreview`,props:{src:{},alt:{default:`Image`},isOpen:{type:Boolean},debug:{type:Boolean,default:!1}},emits:[`close`],setup(e,{emit:t}){let n=e,r=t,i=D(!1),a=D(1),o=D(0),s=D(0),c=D(!1),l=D({x:0,y:0}),u=D(null),d=null,f=()=>{r(`close`),a.value=1,o.value=0,s.value=0},p=e=>{if(!n.isOpen)return;e.preventDefault();let t=e.deltaY>0?-In:In,r=Math.max(Pn,Math.min(Fn,a.value+t));if(r===a.value)return;let i=u.value?.getBoundingClientRect();if(!i)return;let c=e.clientX-i.left,l=e.clientY-i.top,d=(c-o.value-i.width/2)/a.value,f=(l-s.value-i.height/2)/a.value;a.value=r,o.value=c-i.width/2-d*a.value,s.value=l-i.height/2-f*a.value},m=e=>{!n.isOpen||e.button!==0||(c.value=!0,l.value={x:e.clientX-o.value,y:e.clientY-s.value},document.body.style.cursor=`grabbing`)},h=e=>{!n.isOpen||!c.value||(d!==null&&cancelAnimationFrame(d),d=requestAnimationFrame(()=>{o.value=e.clientX-l.value.x,s.value=e.clientY-l.value.y,d=null}))},g=()=>{n.isOpen&&(c.value=!1,document.body.style.cursor=``)},_=e=>{n.isOpen&&e.key===`Escape`&&f()},y=()=>{a.value=1,o.value=0,s.value=0},b=()=>{i.value=!0},C=S(()=>{let e=n.src;if(!e||typeof e!=`string`)return n.debug&&console.warn(`Invalid image source provided:`,e),``;if(e.startsWith(`data:image/`))return n.debug&&console.log(`Source is already a data URI`),e;let t=e;e.startsWith(`data:`)&&(t=e.replace(/^data:[^;]*;base64,/,``)),t=t.trim(),n.debug&&console.log(`Image processing:`,{originalLength:e.length,cleanLength:t.length,startsWithData:e.startsWith(`data:`),hasImageType:e.startsWith(`data:image/`),first50Chars:e.substring(0,50)}),/^[A-Za-z0-9+/]*={0,2}$/.test(t)||n.debug&&console.warn(`Invalid base64 format detected:`,e.substring(0,50)+`...`);let r=`image/png`;try{let e=atob(t.substring(0,10)),n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);n[0]===255&&n[1]===216?r=`image/jpeg`:n[0]===137&&n[1]===80&&n[2]===78&&n[3]===71?r=`image/png`:n[0]===71&&n[1]===73&&n[2]===70?r=`image/gif`:n[0]===82&&n[1]===73&&n[2]===70&&n[3]===70&&(r=`image/webp`)}catch(e){n.debug&&console.warn(`Could not detect image type:`,e)}let i=`data:${r};base64,${t}`;return n.debug&&console.log(`Generated image src:`,{original:e.substring(0,50)+`...`,result:i.substring(0,50)+`...`,mimeType:r,length:t.length}),i});return v(()=>n.isOpen,e=>{e&&(i.value=!1,a.value=1,o.value=0,s.value=0)}),ne(()=>{window.addEventListener(`wheel`,p,{passive:!1}),window.addEventListener(`mousemove`,h),window.addEventListener(`mouseup`,g),window.addEventListener(`keydown`,_)}),z(()=>{window.removeEventListener(`wheel`,p),window.removeEventListener(`mousemove`,h),window.removeEventListener(`mouseup`,g),window.removeEventListener(`keydown`,_),document.body.style.cursor=``,d!==null&&cancelAnimationFrame(d)}),(t,n)=>(I(),x(E,{to:`body`},[e.isOpen?(I(),k(`div`,{key:0,class:`fixed inset-0 z-50 flex items-center justify-center p-4`,onClick:f},[n[5]||=V(`div`,{class:`absolute inset-0 bg-black bg-opacity-75 backdrop-blur-sm`},null,-1),V(`button`,{onClick:K(f,[`stop`]),class:`absolute top-4 right-4 z-10 text-white hover:text-slate-300 transition-colors p-2 bg-black bg-opacity-50 rounded-full hover:bg-opacity-70`},[...n[1]||=[V(`svg`,{class:`w-6 h-6`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`},[V(`path`,{"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-width":`2`,d:`M6 18L18 6M6 6l12 12`})],-1)]]),a.value!==1||o.value!==0||s.value!==0?(I(),k(`button`,{key:0,onClick:K(y,[`stop`]),class:`absolute top-4 left-4 z-10 text-white hover:text-slate-300 transition-colors p-2 bg-black bg-opacity-50 rounded-full hover:bg-opacity-70`,title:`Reset zoom`},[...n[2]||=[V(`svg`,{class:`w-6 h-6`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`},[V(`path`,{"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-width":`2`,d:`M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15`})],-1)]])):j(``,!0),V(`div`,{ref_key:`imageContainerRef`,ref:u,class:`relative w-full h-full flex items-center justify-center overflow-hidden`,onClick:n[0]||=K(()=>{},[`stop`]),onMousedown:m,style:M({cursor:c.value?`grabbing`:a.value>1?`grab`:`default`})},[i.value?(I(),k(`div`,Nn,[...n[4]||=[V(`svg`,{class:`w-16 h-16 mx-auto mb-4 text-red-400`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`},[V(`path`,{"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-width":`2`,d:`M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.734-.833-2.504 0L4.314 16.5c-.77.833.192 2.5 1.732 2.5z`})],-1),V(`p`,{class:`text-lg`},`Failed to load image`,-1),V(`p`,{class:`text-sm text-slate-300 mt-2`},` The image data might be corrupted or in an unsupported format `,-1)]])):(I(),k(`div`,On,[V(`div`,{style:M({transform:`translate(${o.value}px, ${s.value}px) scale(${a.value})`,transformOrigin:`center center`,transition:`none`,willChange:`transform`})},[V(`img`,{src:C.value,alt:e.alt,class:`max-w-full max-h-full object-contain rounded-lg shadow-2xl select-none`,style:{"pointer-events":`none`},onError:b,draggable:`false`},null,40,kn)],4),V(`div`,An,[V(`p`,null,w(e.alt),1),e.src?(I(),k(`p`,jn,` Size: `+w(Math.round(e.src.length*.75/1024))+`KB `,1)):j(``,!0),n[3]||=V(`p`,{class:`text-xs text-slate-300 mt-1`},` Scroll to zoom • Drag to pan • Press ESC to close `,-1),a.value===1?j(``,!0):(I(),k(`p`,Mn,` Zoom: `+w(Math.round(a.value*100))+`% `,1))])]))],36)])):j(``,!0)]))}}),Rn={class:`image-display`},zn=[`src`,`alt`],Bn={key:0,class:`mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs`},Vn={class:`font-mono text-yellow-800`},Hn=L(F({__name:`ImageDisplay`,props:{src:{},alt:{default:`Image`},maxWidth:{default:`300px`},maxHeight:{default:`200px`},className:{default:``},debug:{type:Boolean,default:!1}},setup(e,{expose:t}){let n=e,r=D(!1),i=D(!1),a=()=>{r.value=!0},o=()=>{r.value=!1},s=S(()=>{let e=n.src;if(!e||typeof e!=`string`)return n.debug&&console.warn(`Invalid image source provided:`,e),``;if(e.startsWith(`data:image/`))return n.debug&&console.log(`Source is already a data URI`),e;let t=e;e.startsWith(`data:`)&&(t=e.replace(/^data:[^;]*;base64,/,``)),t=t.trim(),n.debug&&console.log(`Image processing:`,{originalLength:e.length,cleanLength:t.length,startsWithData:e.startsWith(`data:`),hasImageType:e.startsWith(`data:image/`),first50Chars:e.substring(0,50)}),/^[A-Za-z0-9+/]*={0,2}$/.test(t)||n.debug&&console.warn(`Invalid base64 format detected:`,e.substring(0,50)+`...`);let r=`image/png`;try{let e=atob(t.substring(0,10)),n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);n[0]===255&&n[1]===216?r=`image/jpeg`:n[0]===137&&n[1]===80&&n[2]===78&&n[3]===71?r=`image/png`:n[0]===71&&n[1]===73&&n[2]===70?r=`image/gif`:n[0]===82&&n[1]===73&&n[2]===70&&n[3]===70&&(r=`image/webp`)}catch(e){n.debug&&console.warn(`Could not detect image type:`,e)}let i=`data:${r};base64,${t}`;return n.debug&&console.log(`Generated image src:`,{original:e.substring(0,50)+`...`,result:i.substring(0,50)+`...`,mimeType:r,length:t.length}),i}),c=()=>{i.value=!0,console.error(`Thumbnail image failed to load:`,{src:s.value,alt:n.alt,originalSrc:n.src})};return t({closePreview:o,isPreviewOpen:r}),(t,l)=>(I(),k(`div`,Rn,[V(`div`,{class:A([`inline-block cursor-pointer group relative`,e.className]),onClick:a},[i.value?(I(),k(`div`,{key:0,class:`rounded-lg border border-red-200 bg-red-50 p-4 flex flex-col items-center justify-center`,style:M({maxWidth:e.maxWidth,maxHeight:e.maxHeight})},[...l[0]||=[V(`svg`,{class:`w-8 h-8 text-red-400 mb-2`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`},[V(`path`,{"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-width":`2`,d:`M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.734-.833-2.504 0L4.314 16.5c-.77.833.192 2.5 1.732 2.5z`})],-1),V(`p`,{class:`text-xs text-red-600 text-center`},`Image failed to load`,-1),V(`p`,{class:`text-xs text-red-400 mt-1`},`Click to try preview`,-1)]],4)):(I(),k(`img`,{key:1,src:s.value,alt:n.alt,class:`rounded-lg border border-slate-200 shadow-sm transition-all duration-200 group-hover:shadow-md group-hover:border-slate-300`,style:M({maxWidth:e.maxWidth,maxHeight:e.maxHeight}),loading:`lazy`,onError:c},null,44,zn)),l[1]||=V(`div`,{class:`absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all duration-200 rounded-lg flex items-center justify-center`},[V(`svg`,{class:`w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`},[V(`path`,{"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-width":`2`,d:`M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7`})])],-1)],2),e.debug&&!i.value?(I(),k(`div`,Bn,[V(`p`,Vn,[l[2]||=V(`strong`,null,`Debug Info:`,-1),l[3]||=V(`br`,null,null,-1),T(` Src: `+w(n.src.substring(0,100))+w(n.src.length>100?`...`:``),1),l[4]||=V(`br`,null,null,-1),T(` Length: `+w(n.src.length)+` chars`,1),l[5]||=V(`br`,null,null,-1),T(` Type: `+w(n.src.startsWith(`data:`)?`Data URI`:`Raw Base64`),1),l[6]||=V(`br`,null,null,-1),T(` Has Image Type: `+w(n.src.startsWith(`data:image/`)?`Yes`:`No`),1)])])):j(``,!0),h(Ln,{src:n.src,alt:n.alt,"is-open":r.value,debug:e.debug,onClose:o},null,8,[`src`,`alt`,`is-open`,`debug`])]))}}),[[`__scopeId`,`data-v-6f5d262d`]]),Un=F({__name:`Queue`,props:{class:{}},setup(e){let t=e;return(e,n)=>(I(),k(`div`,{class:A(B(X)(`flex flex-col gap-2 rounded-xl border border-border bg-background px-3 pt-2 pb-2 shadow-xs`,t.class))},[G(e.$slots,`default`)],2))}}),Wn=F({__name:`QueueItem`,props:{class:{}},setup(e){let t=e;return(e,n)=>(I(),k(`li`,{class:A(B(X)(`group flex flex-col gap-1 rounded-md px-3 py-1 text-sm transition-colors hover:bg-muted`,t.class))},[G(e.$slots,`default`)],2))}}),Gn=F({__name:`QueueItemAction`,props:{class:{}},setup(e){let t=e;return(e,n)=>(I(),x(B(fe),{class:A(B(X)(`size-auto rounded p-1 text-muted-foreground opacity-0 transition-opacity hover:bg-muted-foreground/10 hover:text-foreground group-hover:opacity-100`,t.class)),size:`icon`,type:`button`,variant:`ghost`},{default:g(()=>[G(e.$slots,`default`)]),_:3},8,[`class`]))}}),Kn=F({__name:`QueueItemActions`,props:{class:{}},setup(e){let t=e;return(e,n)=>(I(),k(`div`,{class:A(B(X)(`flex gap-1`,t.class))},[G(e.$slots,`default`)],2))}}),qn=F({__name:`QueueItemAttachment`,props:{class:{}},setup(e){let t=e;return(e,n)=>(I(),k(`div`,{class:A(B(X)(`mt-1 flex flex-wrap gap-2`,t.class))},[G(e.$slots,`default`)],2))}}),Jn=F({__name:`QueueItemContent`,props:{completed:{type:Boolean,default:!1},class:{}},setup(e){let t=e;return(e,n)=>(I(),k(`span`,{class:A(B(X)(`line-clamp-1 grow break-words`,t.completed?`text-muted-foreground/50 line-through`:`text-muted-foreground`,t.class))},[G(e.$slots,`default`)],2))}}),Yn=F({__name:`QueueItemDescription`,props:{completed:{type:Boolean,default:!1},class:{}},setup(e){let t=e;return(e,n)=>(I(),k(`div`,{class:A(B(X)(`ml-6 text-xs`,t.completed?`text-muted-foreground/40 line-through`:`text-muted-foreground`,t.class))},[G(e.$slots,`default`)],2))}}),Xn={class:`max-w-[100px] truncate`},Zn=F({__name:`QueueItemFile`,props:{class:{}},setup(e){let t=e;return(e,n)=>(I(),k(`span`,{class:A(B(X)(`flex items-center gap-1 rounded border bg-muted px-2 py-1 text-xs`,t.class))},[h(B(le),{size:12}),V(`span`,Xn,[G(e.$slots,`default`)])],2))}}),Qn=F({__name:`QueueItemImage`,props:{class:{}},setup(e){let t=e;return(e,n)=>(I(),k(`img`,P({alt:``,class:B(X)(`h-8 w-8 rounded border object-cover`,t.class),height:`32`,width:`32`},e.$attrs),null,16))}}),$n=F({__name:`QueueItemIndicator`,props:{completed:{type:Boolean,default:!1},class:{}},setup(e){let t=e;return(e,n)=>(I(),k(`span`,{class:A(B(X)(`mt-0.5 inline-block size-2.5 rounded-full border`,t.completed?`border-muted-foreground/20 bg-muted-foreground/10`:`border-muted-foreground/50`,t.class))},null,2))}}),er=F({__name:`QueueList`,props:{class:{},maxHeight:{default:`max-h-40`}},setup(e){let t=e;return(e,n)=>(I(),x(B(ue),P({class:B(X)(`-mb-1 mt-2`,t.class)},e.$attrs),{default:g(()=>[V(`div`,{class:A([t.maxHeight,`pr-4`])},[V(`ul`,null,[G(e.$slots,`default`)])],2)]),_:3},16,[`class`]))}}),tr=F({__name:`QueueSection`,props:{defaultOpen:{type:Boolean,default:!0},class:{}},setup(e){let t=e;return(e,n)=>(I(),x(B(pe),{class:A(B(X)(t.class)),"default-open":t.defaultOpen},{default:g(()=>[G(e.$slots,`default`)]),_:3},8,[`class`,`default-open`]))}}),nr=F({__name:`QueueSectionContent`,props:{class:{}},setup(e){let t=e;return(e,n)=>(I(),x(B(Y),{class:A(B(X)(t.class))},{default:g(()=>[G(e.$slots,`default`)]),_:3},8,[`class`]))}}),rr=F({__name:`QueueSectionLabel`,props:{count:{},label:{},class:{}},setup(e){let t=e;return(e,n)=>(I(),k(`span`,{class:A(B(X)(`flex items-center gap-2`,t.class))},[h(B(q),{class:`group-data-[state=closed]:-rotate-90 size-4 transition-transform`}),G(e.$slots,`icon`),V(`span`,null,w(t.count)+` `+w(t.label),1)],2))}}),ir=F({__name:`QueueSectionTrigger`,props:{class:{}},setup(e){let t=e;return(e,n)=>(I(),x(B(me),{"as-child":``},{default:g(()=>[V(`button`,{class:A(B(X)(`group flex w-full items-center justify-between rounded-md bg-sidebar px-3 py-2 text-left font-medium text-muted-foreground text-sm transition-colors hover:bg-muted`,t.class)),type:`button`},[G(e.$slots,`default`)],2)]),_:3}))}}),ar={class:`flex items-center gap-2`},or={class:`flex items-center gap-2`},sr=F({__name:`Queue`,props:{todos:{default:()=>[]},messages:{default:()=>[]},showMessages:{type:Boolean,default:!0},preview:{type:Boolean,default:!1}},setup(e){let t=e,n=[{id:`msg-1`,parts:[{type:`text`,text:`How do I set up the project?`}]},{id:`msg-2`,parts:[{type:`text`,text:`What is the roadmap for Q4?`}]},{id:`msg-3`,parts:[{type:`text`,text:`Update the default logo to this png.`},{type:`file`,url:`https://github.com/peoray.png`,filename:`setup-guide.png`,mediaType:`image/png`}]},{id:`msg-4`,parts:[{type:`text`,text:`Please generate a changelog.`}]},{id:`msg-5`,parts:[{type:`text`,text:`Add dark mode support.`}]},{id:`msg-6`,parts:[{type:`text`,text:`Optimize database queries.`}]},{id:`msg-7`,parts:[{type:`text`,text:`Set up CI/CD pipeline.`}]}],r=[{id:`todo-1`,title:`Restore message container backgrounds`,description:`Restoring message backgrounds`,status:`pending`},{id:`todo-2`,title:`Keep nested tool content white`,description:`Keeping nested content white`,status:`pending`},{id:`todo-3`,title:`Ensure proper visual hierarchy with backgrounds`,description:`Ensuring visual hierarchy`,status:`pending`}],i=D(t.messages.length>0?t.messages:n),a=D(t.todos.length>0?t.todos:r);v(()=>t.todos,e=>{e.length>0&&(a.value=e)},{immediate:!0,deep:!0}),v(()=>t.messages,e=>{e.length>0&&(i.value=e)},{immediate:!0,deep:!0});function o(e){i.value=i.value.filter(t=>t.id!==e)}function s(e){a.value=a.value.filter(t=>t.id!==e)}function c(e){console.log(`Send now:`,e),o(e)}let l=S(()=>i.value.length>0||a.value.length>0);return(t,n)=>l.value?(I(),x(B(Un),{key:0,class:`min-w-0 w-full`},{default:g(()=>[e.showMessages&&i.value.length>0?(I(),x(B(tr),{key:0},{default:g(()=>[h(B(ir),null,{default:g(()=>[h(B(rr),{count:i.value.length,label:`Queued`},null,8,[`count`])]),_:1}),h(B(nr),null,{default:g(()=>[h(B(er),null,{default:g(()=>[(I(!0),k(O,null,W(i.value,t=>(I(),x(B(Wn),{key:t.id},{default:g(()=>[V(`div`,ar,[h(B($n)),h(B(Jn),null,{default:g(()=>[T(w(t.parts.filter(e=>e.type===`text`).map(e=>e.text).join(` `).trim()||`(queued message)`),1)]),_:2},1024),e.preview?j(``,!0):(I(),x(B(Kn),{key:0},{default:g(()=>[h(B(Gn),{"aria-label":`Remove from queue`,title:`Remove from queue`,onClick:K(e=>o(t.id),[`stop`])},{default:g(()=>[h(B(ge),{size:12})]),_:1},8,[`onClick`]),h(B(Gn),{"aria-label":`Send now`,onClick:K(e=>c(t.id),[`stop`])},{default:g(()=>[h(B(Oe),{size:14})]),_:1},8,[`onClick`])]),_:2},1024))]),t.parts.some(e=>e.type===`file`&&e.url)?(I(),x(B(qn),{key:0},{default:g(()=>[(I(!0),k(O,null,W(t.parts.filter(e=>e.type===`file`&&e.url),e=>(I(),k(O,{key:e.url},[e.mediaType?.startsWith(`image/`)?(I(),x(B(Qn),{key:0,src:e.url,alt:e.filename||`attachment`},null,8,[`src`,`alt`])):(I(),x(B(Zn),{key:1},{default:g(()=>[T(w(e.filename||`file`),1)]),_:2},1024))],64))),128))]),_:2},1024)):j(``,!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):j(``,!0),a.value.length>0?(I(),x(B(tr),{key:1,class:`w-full`},{default:g(()=>[h(B(ir),null,{default:g(()=>[h(B(rr),{count:a.value.length,label:`Todo`},null,8,[`count`])]),_:1}),h(B(nr),{class:`w-full`},{default:g(()=>[h(B(er),{"max-height":e.preview?null:`max-h-40`},{default:g(()=>[(I(!0),k(O,null,W(a.value,t=>(I(),x(B(Wn),{key:t.id},{default:g(()=>[V(`div`,or,[h(B($n),{completed:t.status===`completed`},null,8,[`completed`]),h(B(Jn),{completed:t.status===`completed`},{default:g(()=>[T(w(t.title),1)]),_:2},1032,[`completed`]),e.preview?j(``,!0):(I(),x(B(Kn),{key:0},{default:g(()=>[h(B(Gn),{"aria-label":`Remove todo`,onClick:e=>s(t.id)},{default:g(()=>[h(B(ge),{size:12})]),_:1},8,[`onClick`])]),_:2},1024))]),t.description&&t.description!==t.title?(I(),x(B(Yn),{key:0,completed:t.status===`completed`},{default:g(()=>[T(w(t.description),1)]),_:2},1032,[`completed`])):j(``,!0)]),_:2},1024))),128))]),_:1},8,[`max-height`])]),_:1})]),_:1})):j(``,!0)]),_:1})):j(``,!0)}}),cr={class:`text-xs text-slate-500 mb-1 font-bold uppercase tracking-wider`},lr={class:`w-full overflow-auto`},ur={key:1},dr={key:0,class:`mb-1`},fr={key:2,class:`bg-green-50 border border-green-200 rounded-lg p-3 mb-1 shadow-sm`},pr={class:`flex items-center gap-2 mb-1`},mr={key:0,class:`text-xs font-mono text-green-700`},hr={key:0,class:`text-xs font-mono text-slate-700`},gr={key:0,class:`whitespace-pre-wrap`},_r={key:1,class:`whitespace-pre-wrap`},vr={key:1,class:`text-xs text-red-600 mt-1 font-bold`},yr={key:3,class:`mb-1`},br={key:0,class:`text-xs text-slate-500 mt-2 ml-2`},xr={key:4,class:`bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-1 shadow-sm`},Sr={class:`flex items-center gap-2 mb-1`},Cr={class:`text-xs font-bold text-yellow-700 uppercase`},wr={class:`text-xs font-mono text-slate-700 whitespace-pre-wrap`},Tr={key:1,class:`flex gap-4 mb-4 last:mb-0 w-10/12 mx-auto`},Er={class:`w-8 h-8 rounded-full bg-green-600 flex items-center justify-center shrink-0 shadow-md`},Dr={class:`flex flex-col max-w-[85%] w-full`},Or={class:`flex items-center gap-2 mb-1`},kr={class:`font-mono text-[10px] opacity-70`},Ar={key:2,class:`flex gap-4 mb-4 last:mb-0 w-10/12 mx-auto`},jr={class:`w-8 h-8 rounded-full bg-red-600 flex items-center justify-center shrink-0 shadow-md`},Mr={class:`flex flex-col max-w-[85%] w-full`},Nr=F({__name:`PreviewMessageItem`,props:{item:{},shouldShowCollapse:{type:Boolean},isCollapsed:{type:Boolean},collapsedCharCount:{},isCopySuccess:{type:Boolean},wordWrap:{type:Boolean},formatJson:{type:Function},getDisplayContent:{type:Function},isTodoWrite:{type:Function},convertTodosToQueueFormat:{type:Function}},emits:[`toggle-collapse`,`copy-item`,`toggle-word-wrap`],setup(e,{emit:t}){let n=e,r=t,i=y(`contentRef`),a=D(!1);function o(){R(()=>{if(i.value){let e=i.value;a.value=e.scrollWidth>e.clientWidth}})}return ne(()=>{o(),window.addEventListener(`resize`,o)}),z(()=>{window.removeEventListener(`resize`,o)}),v(()=>[n.item,n.isCollapsed,n.wordWrap],()=>{o()},{deep:!0}),(t,n)=>e.item.type===`message`?(I(),k(`div`,{key:0,class:A([`flex gap-4 mb-4 last:mb-0 w-10/12 mx-auto`,{"flex-row-reverse":e.item.data.role===`user`}])},[V(`div`,{class:A([`w-8 h-8 rounded-full flex items-center justify-center shrink-0 shadow-md`,e.item.data.role===`user`?`bg-indigo-600`:e.item.data.role===`system`?`bg-slate-600`:`bg-orange-600`])},[e.item.data.role===`user`?(I(),x(B(c),{key:0,class:`w-5 h-5 text-white`})):e.item.data.role===`system`?(I(),x(B(f),{key:1,class:`w-5 h-5 text-white`})):(I(),x(B(Te),{key:2,class:`w-5 h-5 text-white`}))],2),V(`div`,{class:A([`flex flex-col max-w-[85%]`,{"items-end":e.item.data.role===`user`}])},[V(`div`,cr,w(e.item.data.role),1),V(`div`,{ref_key:`contentRef`,ref:i,class:A([`min-w-32 px-4 pt-4 rounded-2xl text-sm leading-relaxed shadow-sm font-mono select-text w-full flex flex-col gap-1 relative overflow-y-visible`,[e.item.data.role===`system`?`bg-slate-100 text-slate-800 border border-slate-200`:`bg-white text-slate-800 border border-slate-200`,e.wordWrap?`whitespace-pre-wrap wrap-break-word`:`whitespace-pre `]])},[V(`div`,lr,[Array.isArray(e.item.data.content)?(I(!0),k(O,{key:0},W(e.item.data.content,(t,r)=>(I(),k(`div`,{key:r,class:`mb-1 last:mb-0`},[t.type===`text`?(I(),k(`div`,{key:0,class:A(e.wordWrap?`whitespace-pre-wrap wrap-break-word`:`whitespace-pre `)},[e.shouldShowCollapse&&e.isCollapsed?(I(),k(O,{key:0},[T(w((t.text?.trim()||``).substring(0,200)+`...`),1)],64)):(I(),k(O,{key:1},[T(w(t.text?.trim()||``),1)],64))],2)):t.type===`tool_use`?(I(),k(`div`,ur,[e.isTodoWrite(t)?(I(),k(`div`,dr,[h(sr,{todos:e.convertTodosToQueueFormat(t.input.todos),"show-messages":!1,preview:!0},null,8,[`todos`])])):(I(),x(Dn,{key:1,"tool-data":t,"is-collapsed":e.shouldShowCollapse&&e.isCollapsed},null,8,[`tool-data`,`is-collapsed`]))])):t.type===`tool_result`?(I(),k(`div`,fr,[V(`div`,pr,[n[9]||=V(`span`,{class:`text-xs font-bold text-green-600 uppercase`},`Tool Result:`,-1),t.tool_use_id?(I(),k(`span`,mr,w(t.tool_use_id),1)):j(``,!0)]),t.content?(I(),k(`div`,hr,[e.shouldShowCollapse&&e.isCollapsed?(I(),k(`pre`,gr,w((Array.isArray(t.content)?t.content.join(`
`).trim():t.content?.trim()||``).substring(0,200)+`...`),1)):(I(),k(`pre`,_r,w(Array.isArray(t.content)?t.content.join(`
`).trim():t.content?.trim()||``),1))])):j(``,!0),t.is_error?(I(),k(`div`,vr,` Error: `+w(t.is_error),1)):j(``,!0)])):t.type===`image`?(I(),k(`div`,yr,[n[10]||=V(`div`,{class:`flex items-center gap-2 mb-2`},[V(`span`,{class:`text-xs font-bold text-purple-700 uppercase`},`Image:`)],-1),h(Hn,{src:t.source?.data||t.data||``,alt:t.alt||`Generated image`,"max-width":`250px`,"max-height":`250px`,class:`inline-block`,debug:!1},null,8,[`src`,`alt`]),t.detail?(I(),k(`div`,br,w(t.detail),1)):j(``,!0)])):(I(),k(`div`,xr,[V(`div`,Sr,[V(`span`,Cr,w(t.type)+`:`,1)]),V(`pre`,wr,[n[11]||=T(`                `,-1),e.shouldShowCollapse&&e.isCollapsed?(I(),k(O,{key:0},[T(`
                  `+w(e.formatJson(t).trim().substring(0,200)+`...`)+`
                `,1)],64)):(I(),k(O,{key:1},[T(`
                  `+w(e.formatJson(t).trim())+`
                `,1)],64)),n[12]||=T(`
              `,-1)])]))]))),128)):(I(),k(O,{key:1},[T(w(e.getDisplayContent(e.item)),1)],64))]),h(on,{"item-type":e.item.type,"item-data":e.item.data,"should-show-collapse":e.shouldShowCollapse,"is-collapsed":e.isCollapsed,"collapsed-char-count":e.collapsedCharCount,"is-copy-success":e.isCopySuccess,"has-scrollbar":a.value,onToggleCollapse:n[0]||=e=>r(`toggle-collapse`),onCopyItem:n[1]||=e=>r(`copy-item`),onToggleWordWrap:n[2]||=e=>r(`toggle-word-wrap`)},null,8,[`item-type`,`item-data`,`should-show-collapse`,`is-collapsed`,`collapsed-char-count`,`is-copy-success`,`has-scrollbar`])],2)],2)],2)):e.item.type===`full_response`?(I(),k(`div`,Tr,[V(`div`,Er,[h(B(be),{class:`w-5 h-5 text-white`})]),V(`div`,Dr,[V(`div`,Or,[n[13]||=V(`span`,{class:`text-xs text-green-600 font-bold uppercase tracking-wider`},`Full Response (Reconstructed)`,-1),V(`span`,kr,`Length: `+w(e.item.data.data?.content?.length||0)+` chars`,1)]),V(`div`,{ref_key:`contentRef`,ref:i,class:`bg-white text-slate-800 border border-green-200 px-4 pt-4 rounded-2xl rounded-tl-none shadow-sm font-mono select-text flex flex-col gap-1 relative overflow-y-visible`},[V(`div`,{class:A([`text-slate-800 text-xs flex-1 overflow-auto`,{"whitespace-pre-wrap wrap-break-word":e.wordWrap,"whitespace-pre":!e.wordWrap}])},w(e.getDisplayContent(e.item)),3),h(on,{"item-type":e.item.type,"item-data":e.item.data,"should-show-collapse":e.shouldShowCollapse,"is-collapsed":e.isCollapsed,"collapsed-char-count":e.collapsedCharCount,"is-copy-success":e.isCopySuccess,"has-scrollbar":a.value,onToggleCollapse:n[3]||=e=>r(`toggle-collapse`),onCopyItem:n[4]||=e=>r(`copy-item`),onToggleWordWrap:n[5]||=e=>r(`toggle-word-wrap`)},null,8,[`item-type`,`item-data`,`should-show-collapse`,`is-collapsed`,`collapsed-char-count`,`is-copy-success`,`has-scrollbar`])],512)])])):e.item.type===`error`?(I(),k(`div`,Ar,[V(`div`,jr,[h(B(m),{class:`w-5 h-5 text-white`})]),V(`div`,Mr,[n[14]||=V(`div`,{class:`text-xs text-red-600 mb-1 font-bold uppercase tracking-wider`},` Error `,-1),V(`div`,{ref_key:`contentRef`,ref:i,class:`bg-red-50 border border-red-200 px-4 pt-4 rounded-2xl rounded-tl-none shadow-sm flex flex-col gap-1 relative overflow-y-visible`},[V(`pre`,{class:A([`text-red-600 text-xs select-text flex-1 overflow-auto`,{"whitespace-pre-wrap wrap-break-word":e.wordWrap,"whitespace-pre":!e.wordWrap}])},w(e.isCollapsed&&e.shouldShowCollapse?e.formatJson(e.item.data.err).trim().substring(0,500)+`...`:e.formatJson(e.item.data.err).trim()),3),h(on,{"item-type":e.item.type,"item-data":e.item.data,"should-show-collapse":e.shouldShowCollapse,"is-collapsed":e.isCollapsed,"collapsed-char-count":e.collapsedCharCount,"is-copy-success":e.isCopySuccess,"has-scrollbar":a.value,onToggleCollapse:n[6]||=e=>r(`toggle-collapse`),onCopyItem:n[7]||=e=>r(`copy-item`),onToggleWordWrap:n[8]||=e=>r(`toggle-word-wrap`)},null,8,[`item-type`,`item-data`,`should-show-collapse`,`is-collapsed`,`collapsed-char-count`,`is-copy-success`,`has-scrollbar`])],512)])])):j(``,!0)}}),Pr={class:`px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50 shrink-0`},Fr={class:`font-bold text-slate-800 flex items-center gap-2`},Ir={class:`text-sm font-normal text-slate-600 ml-2`},Lr={key:0},Rr={class:`flex-1 overflow-hidden flex`},zr={class:`w-80 border-r border-slate-100 bg-slate-50 overflow-hidden flex flex-col shrink-0`},Br={class:`p-4 border-b border-slate-200 shrink-0 space-y-3`},Vr={class:`relative`},Hr={class:`flex gap-2`},Ur={class:`flex-1 overflow-y-auto p-4 space-y-2`},Wr=[`onClick`],Gr={class:`absolute top-0 right-0 w-24 h-24 overflow-hidden pointer-events-none`},Kr={class:`flex items-start justify-between gap-2`},qr={class:`flex-1 min-w-0`},Jr={class:`mb-1`},Yr=[`title`],Xr={key:0,class:`text-xs text-slate-500 mt-1 line-clamp-2`},Zr={class:`flex items-center gap-2 mt-2 flex-wrap`},Qr={class:`text-[10px] px-2 py-0.5 rounded bg-slate-100 text-slate-700 font-mono`},$r={key:0,class:`text-[10px] px-2 py-0.5 rounded bg-slate-100 text-slate-700`},ei={key:0,class:`text-center py-8 text-slate-400 text-sm`},ti={class:`flex-1 overflow-hidden flex flex-col p-6`},ni={key:0,class:`flex-1 flex items-center justify-center`},ri={class:`text-center`},ii={key:1,class:`flex-1 overflow-hidden flex flex-col`},ai={class:`flex items-center gap-6 border-b border-slate-200 mb-4 shrink-0`},oi={class:`flex-1 overflow-hidden flex flex-col`},si={key:0,class:`flex-1 overflow-y-auto`},ci={class:`space-y-3`},li={class:`flex items-center gap-2 mb-3`},ui={class:`font-mono text-sm font-bold text-slate-800 select-text`},di={class:`font-mono text-sm text-slate-700 select-text`},fi={class:`text-sm text-slate-700 select-text`},pi={key:0},mi={class:`text-sm text-slate-700 whitespace-pre-wrap select-text`},hi={key:1,class:`mt-4 pt-4`},gi={key:1,class:`flex-1 overflow-y-auto`},_i={class:`space-y-4`},vi={class:`flex items-center gap-2 mb-2 select-text`},yi={class:`font-mono text-sm font-bold text-slate-800`},bi={key:0,class:`text-xs px-2 py-0.5 rounded bg-red-100 text-red-700 font-bold`},xi={key:1,class:`text-xs px-2 py-0.5 rounded bg-blue-100 text-blue-700 font-mono`},Si={key:0,class:`text-sm text-slate-600 mb-2 select-text`},Ci={key:1,class:`text-xs text-slate-500 mb-1`},wi={class:`font-mono`},Ti={key:2,class:`text-xs text-slate-500`},Ei={class:`font-mono text-slate-700`},Di={key:3,class:`mt-2`},Oi={class:`mt-2 text-xs font-mono p-2 overflow-x-auto`},ki={key:2,class:`flex-1 min-h-0 flex flex-col`},Ai={class:`overflow-hidden flex-1 min-h-0`},ji=L(F({__name:`MCPPreview`,props:{show:{type:Boolean},request:{}},emits:[`update:show`],setup(e,{emit:n}){let r=e,i=n,o=S(()=>{if(!r.request)return[];let e=r.request.logs.find(e=>e.type===`request body`&&e.data);if(e&&e.data.tools&&Array.isArray(e.data.tools))return e.data.tools;let t=r.request.logs.find(e=>e.request&&e.request.body);if(t)try{let e=typeof t.request.body==`string`?JSON.parse(t.request.body):t.request.body;if(e.tools&&Array.isArray(e.tools))return e.tools}catch{}return[]}),s=S(()=>o.value.filter(e=>e.name&&e.name.startsWith(`mcp__`))),c=D(``),l=D(`all`),d=S(()=>{let e=o.value;if(l.value===`mcp`?e=e.filter(e=>M(e.name)):l.value===`base`&&(e=e.filter(e=>!M(e.name))),c.value.trim()){let t=c.value.toLowerCase().trim();e=e.filter(e=>{let n=E(e.name).toLowerCase(),r=(e.description||``).toLowerCase(),i=P(e.name).toLowerCase();return n.includes(t)||r.includes(t)||i.includes(t)})}return e}),f=D(null),p=S(()=>f.value===null?null:d.value[f.value]||null),m=D(`info`),_=S(()=>p.value&&(p.value.inputSchema||p.value.input_schema||p.value.annotations)?.properties||{}),y=S(()=>p.value&&(p.value.inputSchema||p.value.input_schema||p.value.annotations)?.required||[]);function E(e){return e.startsWith(`mcp__`)?e.substring(5):e}function M(e){return!!(e&&e.startsWith(`mcp__`))}function P(e){return e.startsWith(`mcp__`)?e.substring(5).split(`__`)[0]||`Unknown`:`基础工具`}function F(e){try{return JSON.stringify(e,null,2)}catch{return String(e)}}function L(){i(`update:show`,!1),f.value=null,m.value=`info`,c.value=``,l.value=`all`}function te(e){e.target.classList.contains(`modal-backdrop`)&&L()}function R(e){e.key===`Escape`&&r.show&&L()}return ne(()=>{document.addEventListener(`keydown`,R)}),z(()=>{document.removeEventListener(`keydown`,R)}),v(()=>d.value,()=>{f.value!==null&&f.value>=d.value.length&&(f.value=null),d.value.length>0&&f.value===null&&(f.value=0)}),v(()=>r.show,e=>{e&&d.value.length>0&&(f.value=0)}),(n,r)=>(I(),x(C,{name:`fade`},{default:g(()=>[e.show?(I(),k(`div`,{key:0,class:`modal-backdrop fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4`,onClick:te},[V(`div`,{class:`relative bg-white rounded-xl shadow-2xl w-full max-w-7xl h-[90vh] overflow-hidden flex flex-col animate-in fade-in zoom-in duration-200`,onClick:r[7]||=K(()=>{},[`stop`])},[V(`div`,Pr,[V(`h3`,Fr,[h(B(N),{class:`w-5 h-5`}),r[9]||=V(`span`,{class:`text-lg`},`工具预览`,-1),V(`span`,Ir,[T(` (`+w(d.value.length)+`/`+w(o.value.length)+` 个工具 `,1),s.value.length>0?(I(),k(`span`,Lr,`，`+w(s.value.length)+` 个 MCP`,1)):j(``,!0),r[8]||=T(`) `,-1)])]),V(`button`,{class:`btn-icon`,onClick:L},[h(B(H),{class:`w-5 h-5`})])]),V(`div`,Rr,[V(`div`,zr,[V(`div`,Br,[V(`div`,Vr,[h(B(u),{class:`absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400`}),ee(V(`input`,{"onUpdate:modelValue":r[0]||=e=>c.value=e,type:`text`,placeholder:`搜索工具...`,class:`w-full pl-9 pr-3 py-2 text-sm border border-slate-200 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all`},null,512),[[b,c.value]])]),V(`div`,Hr,[V(`button`,{onClick:r[1]||=e=>l.value=`all`,class:A([`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-all`,l.value===`all`?`bg-indigo-600 text-white shadow-sm`:`bg-white text-slate-600 border border-slate-200 hover:bg-slate-50`])},` 全部 (`+w(o.value.length)+`) `,3),V(`button`,{onClick:r[2]||=e=>l.value=`mcp`,class:A([`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-all`,l.value===`mcp`?`bg-purple-600 text-white shadow-sm`:`bg-white text-purple-600 border border-purple-200 hover:bg-purple-50`])},` MCP (`+w(s.value.length)+`) `,3),V(`button`,{onClick:r[3]||=e=>l.value=`base`,class:A([`flex-1 px-3 py-1.5 text-xs font-medium rounded-md transition-all`,l.value===`base`?`bg-blue-600 text-white shadow-sm`:`bg-white text-blue-600 border border-blue-200 hover:bg-blue-50`])},` 基础 (`+w(o.value.length-s.value.length)+`) `,3)])]),V(`div`,Ur,[(I(!0),k(O,null,W(d.value,(e,t)=>(I(),k(`div`,{key:t,class:A([`p-4 rounded-lg cursor-pointer transition-all border relative overflow-hidden`,f.value===t?`bg-white border-slate-300 shadow-md`:`bg-white border-slate-200 hover:border-slate-300 hover:shadow-sm`]),onClick:e=>f.value=t},[V(`div`,Gr,[V(`span`,{class:A([`absolute top-3 -right-1/2 w-32 text-center text-[11px] px-3 py-1 font-bold transform rotate-45 origin-center whitespace-nowrap`,M(e.name)?`bg-purple-200 text-purple-800`:`bg-blue-200 text-blue-800`])},w(M(e.name)?`MCP`:`基础`),3)]),V(`div`,Kr,[V(`div`,qr,[V(`div`,Jr,[V(`div`,{class:`font-mono text-sm font-bold text-slate-800 truncate`,title:E(e.name)},w(E(e.name)),9,Yr)]),e.description?(I(),k(`div`,Xr,w(e.description),1)):j(``,!0),V(`div`,Zr,[V(`span`,Qr,w(P(e.name)),1),e.inputSchema?.properties||e.input_schema?.properties||e.annotations?.properties?(I(),k(`span`,$r,w(Object.keys(e.inputSchema?.properties||e.input_schema?.properties||e.annotations?.properties||{}).length)+` 个参数 `,1)):j(``,!0)])])])],10,Wr))),128)),d.value.length===0?(I(),k(`div`,ei,w(c.value.trim()?`未找到匹配的工具`:`未找到工具`),1)):j(``,!0)])]),V(`div`,ti,[f.value===null?(I(),k(`div`,ni,[V(`div`,ri,[h(B(N),{class:`w-16 h-16 text-slate-300 mx-auto mb-4`}),r[10]||=V(`p`,{class:`text-slate-500 text-lg`},`选择一个工具查看详情`,-1)])])):p.value?(I(),k(`div`,ii,[V(`nav`,ai,[V(`button`,{class:A([`px-1 py-3 text-sm font-medium transition-all flex items-center gap-2 relative -mb-px`,m.value===`info`?`text-primary border-b-2 border-primary`:`text-slate-500 hover:text-slate-700 border-b-2 border-transparent`]),onClick:r[4]||=e=>m.value=`info`},[h(B(N),{class:`w-4 h-4`}),r[11]||=T(` 基本信息 `,-1)],2),Object.keys(_.value).length>0?(I(),k(`button`,{key:0,class:A([`px-1 py-3 text-sm font-medium transition-all flex items-center gap-2 relative -mb-px`,m.value===`params`?`text-primary border-b-2 border-primary`:`text-slate-500 hover:text-slate-700 border-b-2 border-transparent`]),onClick:r[5]||=e=>m.value=`params`},[h(B(a),{class:`w-4 h-4`}),r[12]||=T(` 参数定义 `,-1)],2)):j(``,!0),V(`button`,{class:A([`px-1 py-3 text-sm font-medium transition-all flex items-center gap-2 relative -mb-px`,m.value===`json`?`text-primary border-b-2 border-primary`:`text-slate-500 hover:text-slate-700 border-b-2 border-transparent`]),onClick:r[6]||=e=>m.value=`json`},[h(B(t),{class:`w-4 h-4`}),r[13]||=T(` 完整 JSON `,-1)],2)]),V(`div`,oi,[m.value===`info`?(I(),k(`div`,si,[V(`div`,ci,[V(`div`,li,[V(`span`,{class:A([`text-xs px-3 py-1 rounded font-bold`,M(p.value.name)?`bg-purple-200 text-purple-800`:`bg-blue-200 text-blue-800`])},w(M(p.value.name)?`MCP 工具`:`基础工具`),3)]),V(`div`,null,[r[14]||=V(`div`,{class:`text-xs text-slate-500 mb-1`},`工具名称`,-1),V(`div`,ui,w(E(p.value.name)),1)]),V(`div`,null,[r[15]||=V(`div`,{class:`text-xs text-slate-500 mb-1`},`完整名称`,-1),V(`div`,di,w(p.value.name),1)]),V(`div`,null,[r[16]||=V(`div`,{class:`text-xs text-slate-500 mb-1`},`所属服务器`,-1),V(`div`,fi,w(P(p.value.name)),1)]),p.value.description?(I(),k(`div`,pi,[r[17]||=V(`div`,{class:`text-xs text-slate-500 mb-1`},`描述`,-1),V(`div`,mi,w(p.value.description),1)])):j(``,!0),Object.keys(_.value).length===0?(I(),k(`div`,hi,[...r[18]||=[V(`p`,{class:`text-slate-500 text-sm text-center`},` 此工具不需要参数 `,-1)]])):j(``,!0)])])):j(``,!0),m.value===`params`&&Object.keys(_.value).length>0?(I(),k(`div`,gi,[V(`div`,_i,[(I(!0),k(O,null,W(_.value,(e,t)=>(I(),k(`div`,{key:t,class:`p-4`},[V(`div`,vi,[V(`span`,yi,w(t),1),y.value.includes(t)?(I(),k(`span`,bi,` 必填 `)):j(``,!0),e.type?(I(),k(`span`,xi,w(e.type),1)):j(``,!0)]),e.description?(I(),k(`div`,Si,w(e.description),1)):j(``,!0),e.enum?(I(),k(`div`,Ci,[r[19]||=T(` 可选值: `,-1),V(`span`,wi,w(e.enum.join(`, `)),1)])):j(``,!0),e.default===void 0?j(``,!0):(I(),k(`div`,Ti,[r[20]||=T(` 默认值: `,-1),V(`span`,Ei,w(F(e.default)),1)])),Object.keys(e).length>5?(I(),k(`details`,Di,[r[21]||=V(`summary`,{class:`text-xs text-slate-500 cursor-pointer hover:text-slate-700`},` 查看完整定义 `,-1),V(`pre`,Oi,w(F(e)),1)])):j(``,!0)]))),128))])])):j(``,!0),m.value===`json`?(I(),k(`div`,ki,[V(`div`,Ai,[h(_e,{class:`h-full`,"model-value":F(p.value),language:`json`,readonly:!0,options:{wordWrap:`on`,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:12,lineNumbers:`on`}},null,8,[`model-value`])])])):j(``,!0)])])):j(``,!0)])])])])):j(``,!0)]),_:1}))}}),[[`__scopeId`,`data-v-352b2af9`]]);function Mi(e,t,n={}){let{initialChars:r=2e3,loadMoreChars:i=1e3}=n,a=D(-1),o=D(!1),s=(n,r=i)=>{let a=0,o=[],s=-1;for(let i=n;i<e.value.length;i++){let n=e.value[i],c=t(n);if(a+c>r&&o.length>0)break;o.push(n),a+=c,s=i}return s===-1?n:s+1},c=S(()=>(a.value===-1&&(a.value=s(0,r)),e.value.slice(0,a.value)));function l(){a.value=-1}async function u(){o.value||a.value>=e.value.length||(o.value=!0,await new Promise(e=>setTimeout(e,100)),a.value=s(a.value+1,i),o.value=!1)}let d=S(()=>a.value<e.value.length),f=S(()=>Math.min(i,e.value.length-a.value));return{lastIndex:a,visibleItems:c,isLoading:_(o),hasMore:d,nextLoadChars:f,loadMore:u,reset:l}}var Ni={key:0,class:`w-full h-full flex flex-col bg-slate-50`},Pi={class:`bg-white p-4 border-b border-slate-200 shadow-sm`},Fi={class:`flex justify-between items-start`},Ii={class:`flex-1 min-w-0`},Li={class:`flex items-center gap-3 mb-2`},Ri={class:`max-w-[200px] truncate text-base text-blue-700 underline break-all font-mono`},zi={key:1,class:`flex justify-center`},Bi={class:`bg-indigo-50 border border-indigo-200 text-indigo-700 px-4 py-1 rounded text-xs font-mono shadow-sm`},Vi={class:`font-bold`},Hi={class:`flex gap-6 text-xs text-slate-500 font-mono`},Ui={key:0},Wi={class:`flex gap-2 items-center`},Gi=[`disabled`],Ki=[`title`],qi={class:`font-bold`},Ji={key:0,class:`ml-1 opacity-70`},Yi={class:`flex-1 overflow-hidden relative`},Xi={key:1,class:`w-full h-full flex flex-col overflow-hidden`},Zi={key:0,class:`flex-1 flex items-center justify-center text-slate-400`},Qi={key:1,class:`flex-1 flex flex-col overflow-hidden`},$i={class:`py-6`},ea={key:0,class:`text-xs text-slate-400 animate-pulse`},ta={class:`max-w-5xl mx-auto`},na={class:`flex flex-col items-end w-24 shrink-0 pt-1`},ra={class:`text-xs text-slate-500 font-mono`},ia={class:`text-[10px] text-slate-400 font-mono`},aa={class:`relative flex flex-col items-center`},oa={key:0,class:`w-0.5 bg-slate-200 h-full absolute top-3`},sa={class:`pb-6 flex-1 min-w-0 max-w-full`},ca={class:`bg-white rounded-lg px-4 pt-4 pb-2 border border-slate-200 group-hover:border-slate-300 transition-all shadow-sm flex flex-col w-full`},la={class:`flex justify-between items-start mb-1`},ua={key:0,class:`text-xs font-bold text-indigo-600`},da={key:1,class:`text-xs font-bold text-slate-500`},fa={class:`text-[10px] text-slate-400 bg-slate-100 px-2 py-0.5 rounded`},pa={key:0,class:`mt-2 text-xs font-mono bg-slate-50 p-3 rounded border border-slate-100 overflow-x-auto overflow-y-visible text-slate-600 flex flex-col relative wrap-break-word`},ma={key:0},ha={class:`text-green-600 font-bold mb-1 flex items-center gap-2`},ga={class:`bg-white border border-green-200 p-3 rounded mt-2 relative overflow-hidden shadow-sm`},_a={class:`text-slate-800 whitespace-pre-wrap wrap-break-word select-text overflow-x-auto`},va={class:`text-xs text-slate-500 mt-2 text-right`},ya={key:0,class:`ml-2`},ba={key:1},xa={class:`text-cyan-600 font-bold mb-1 flex items-center gap-2`},Sa={class:`bg-cyan-50 border border-cyan-200 p-3 rounded mt-2 relative overflow-hidden shadow-sm`},Ca={class:`text-slate-800 whitespace-pre-wrap wrap-break-word select-text pl-2 overflow-x-auto`},wa={key:2},Ta={class:`text-red-600 font-bold mb-1 flex items-center gap-2`},Ea={class:`bg-red-50 border border-red-200 p-3 rounded mt-2`},Da={class:`text-red-600 select-text whitespace-pre-wrap wrap-break-word overflow-x-auto`},Oa={key:0},ka={class:`text-slate-700 whitespace-pre-wrap wrap-break-word overflow-x-auto`},Aa={key:1},ja={class:`text-slate-700 whitespace-pre-wrap wrap-break-word overflow-x-auto`},Ma={key:2},Na={class:`text-slate-700 whitespace-pre-wrap wrap-break-word overflow-x-auto`},Pa={key:3},Fa={class:`text-slate-700 whitespace-pre-wrap wrap-break-word overflow-x-auto`},Ia={key:4,class:`opacity-70`},La={key:5},Ra={class:`text-red-600 whitespace-pre-wrap wrap-break-word overflow-x-auto`},za={key:1,class:`sticky bottom-0 flex items-center justify-end gap-1 pt-2 pb-1 mt-2 border-t border-slate-200 bg-white`},Ba=[`onClick`],Va={key:2},Ha={key:3},Ua={key:0,class:`text-xs text-slate-400 animate-pulse`},Wa={key:3,class:`w-full h-full p-6`},Ga={class:`max-w-8xl h-full mx-auto`},Ka={key:1,class:`flex-1 flex flex-col items-center justify-center bg-slate-50 text-slate-400`},qa=1e3,$=1e3,Ja=F({__name:`LoggerRequestDetail`,props:{request:{}},setup(e){let n=e,r=D(`preview`),i=D(!1),a=S(()=>H(n.request||{})),o=S(()=>{let e=n.request?.logs||[],t=n.request?.responseFull;if(!t||!Array.isArray(t)||t.length===0)return e;let r=[...e],i=e.length>0?e[e.length-1]:void 0,a=i&&typeof i.time==`number`?i.time:n.request?.startTime??Date.now();return t&&Array.isArray(t)&&t.forEach((e,t)=>{r.push({type:`stream_event`,time:a+(t+1)*10,level:30,msg:`Stream Event: ${e?.type||`unknown`}`,data:e})}),r.sort((e,t)=>e.time-t.time)}),s=S(()=>!n.request||!U(n.request)?[]:G(n.request).filter(e=>Array.isArray(e.content)?e.content.some(e=>e.type===`text`&&e.text&&e.text.trim()||e.type===`tool_use`||e.type===`tool_result`?!0:e&&Object.keys(e).length>0):e.content&&e.content.trim())),c=S(()=>{if(!n.request||!U(n.request))return[];let e=[];return s.value.forEach(t=>{e.push({type:`message`,data:t})}),(n.request.logs||[]).forEach(t=>{t.type===`full_response`?e.push({type:`full_response`,data:t}):t.type===`error`&&e.push({type:`error`,data:t})}),e}),u=Mi(o,e=>JSON.stringify(e).length,{initialChars:1e3,loadMoreChars:1e3}),d=y(`messageContainerRef`),f=y(`timelineContainerRef`),g=y(`messageLoadTriggerRef`),_=y(`timelineLoadTriggerRef`),b=Mi(c,e=>{if(e.type===`message`){let t=e.data;return Array.isArray(t.content)?t.content.reduce((e,t)=>t.type===`text`?e+String(t.text||``).length:t.type===`tool_use`?e+String(t.name||``).length+JSON.stringify(t.input||{}).length:t.type===`tool_result`?e+String(t.content||``).length:t.type===`image`?e+200:e+JSON.stringify(t).length,0):String(t.content||``).length}else if(e.type===`full_response`)return JSON.stringify(e.data.data?.content||``).length;else if(e.type===`error`)return JSON.stringify(e.data.err||``).length;return 0},{initialChars:5e3,loadMoreChars:5e3}),C=ae(()=>{u.hasMore.value&&!u.isLoading.value&&u.loadMore()},66),E=ae(()=>{b.hasMore.value&&!b.isLoading.value&&b.loadMore()},66),{stop:M}=ie(_,([e])=>{e?.isIntersecting&&C()},{threshold:.1,rootMargin:`50px`}),{stop:N}=ie(g,([e])=>{e?.isIntersecting&&E()},{threshold:.1,rootMargin:`50px`});v(()=>n.request,()=>{u.reset(),b.reset(),q.value.clear(),n.request&&U(n.request)&&c.value.forEach(e=>{if(me(e)){let t=`${e.type}-${e.data.time||e.data.role||Math.random()}`;q.value.add(t)}}),n.request&&(n.request.logs||[]).forEach((e,t)=>{if(ve(e)){let n=Q(e,t);q.value.add(n)}}),d.value?.scrollTo({top:0,behavior:`instant`}),f.value?.scrollTo({top:0,behavior:`instant`})});let P=S(()=>u.visibleItems.value),F=S(()=>b.visibleItems.value),L=S(()=>{let e=n.request;if(!e||!U(e))return!1;let t=G(e).length>0,r=e.logs.some(e=>e.type===`full_response`),i=e.logs.some(e=>e.type===`error`);return t||r||i});v(()=>n.request,e=>{if(!e){r.value=`timeline`;return}if(L.value){r.value=`preview`;return}r.value===`preview`&&(r.value=`timeline`)},{immediate:!0});function ee(e){return new Date(e).toLocaleString()}function te(e){let t=new Date(e);return`${t.getHours().toString().padStart(2,`0`)}:${t.getMinutes().toString().padStart(2,`0`)}:${t.getSeconds().toString().padStart(2,`0`)}.${t.getMilliseconds().toString().padStart(3,`0`)}`}function R(e,t){if(!Array.isArray(e)||t<=0)return 0;let n=e[t-1],r=e[t];return!n||!r||typeof r.time!=`number`||typeof n.time!=`number`?0:r.time-n.time}function H(e){try{return JSON.stringify(e,null,2)}catch{return String(e)}}function U(e){return!!e&&(e.url.includes(`/messages`)||e.url.includes(`/chat/completions`))}function G(e){if(!e)return[];let t=e.logs.find(e=>e.type===`request body`&&e.data&&e.data.messages),n=[];if(t)n=[...t.data.messages],t.data.system&&n.unshift({role:`system`,content:t.data.system});else{let t=e.logs.find(e=>e.request&&e.request.body);if(t)try{let e=JSON.parse(t.request.body);e.messages&&(n=e.messages)}catch{}}return n}let K=S(()=>{if(!n.request)return[];let e=n.request.logs.find(e=>e.type===`request body`&&e.data);if(e&&e.data.tools&&Array.isArray(e.data.tools))return e.data.tools;let t=n.request.logs.find(e=>e.request&&e.request.body);if(t)try{let e=typeof t.request.body==`string`?JSON.parse(t.request.body):t.request.body;if(e.tools&&Array.isArray(e.tools))return e.tools}catch{}return[]}),re=S(()=>K.value.filter(e=>e.name&&e.name.startsWith(`mcp__`)));function oe(e){return e===30?`bg-blue-500`:e===40?`bg-yellow-500`:e>=50?`bg-red-500`:`bg-slate-400`}let q=D(new Set),se=D(new Map),ce=D(new Map);function le(e){return ce.value.get(e)??!1}function J(e){let t=le(e);ce.value.set(e,!t)}function ue(e){return`${e.type}-${e.data.time||e.data.role||Math.random()}`}function de(e){let t=new Set(q.value);t.has(e)?t.delete(e):t.add(e),q.value=t}function Y(e){return q.value.has(e)}function fe(e){if(e.type===`message`){let t=e.data;return Array.isArray(t.content)?t.content.map(e=>e.type===`text`?e.text||``:e.type===`tool_use`?`[Tool: ${e.name||`Unknown`}] ${e.input?JSON.stringify(e.input):``}`:e.type===`tool_result`?`[Tool Result] ${e.content?Array.isArray(e.content)?e.content.join(`
`):e.content:``}`:e.type===`image`?`[Image: ${e.alt||`Generated image`}] ${e.detail?`(${e.detail})`:``}`:`[${e.type}] ${JSON.stringify(e)}`).join(``):t.content||``}else if(e.type===`full_response`)return e.data.data?.content||``;else if(e.type===`error`)return JSON.stringify(e.data.err||``);return``}function pe(e){return fe(e).length>qa}function me(e){return fe(e).length>$}function he(e){let t=fe(e);return!pe(e)||!Y(`${e.type}-${e.data.time||e.data.role||Math.random()}`)?t.trim():t.trim().substring(0,$)+`...`}function ge(e){let t=fe(e);return t.length<=qa?0:t.length-qa}function X(e){if(e.type===`full_response`&&e.data?.content)return String(e.data.content||``).trim();if(e.type===`stream_event`&&e.data)return H(e.data).trim();if(e.type===`error`&&e.err)return H(e.err).trim();{let t=[];return e.data&&e.type!==`recieved data`&&t.push(H(e.data).trim()),e.req&&t.push(H(e.req).trim()),e.request&&t.push(H(e.request).trim()),e.response&&!e.data&&t.push(H(e.response).trim()),e.err&&t.push(H(e.err).trim()),t.join(`

`)}}function Z(e){return X(e).length>qa}function ve(e){return X(e).length>$}function ye(e){let t=X(e);return t.length<=qa?0:t.length-qa}function Q(e,t){return`timeline-${e.time||t||Math.random()}`}async function xe(e){let t=`${e.type}-${e.data.time||e.data.role||Math.random()}`;try{let r={type:e.type,data:e.data,context:{requestId:n.request?.id,timestamp:e.data.time||Date.now()}};await navigator.clipboard.writeText(JSON.stringify(r,null,2)),se.value.set(t,!0),setTimeout(()=>{se.value.delete(t)},3e3)}catch(r){console.error(`Failed to copy:`,r);let i=document.createElement(`textarea`);i.value=JSON.stringify({type:e.type,data:e.data,context:{requestId:n.request?.id,timestamp:e.data.time||Date.now()}},null,2),document.body.appendChild(i),i.select(),document.execCommand(`copy`),document.body.removeChild(i),se.value.set(t,!0),setTimeout(()=>{se.value.delete(t)},3e3)}}function Se(e){return se.value.get(e)||!1}function we(e){return e?.name===`TodoWrite`&&e?.input?.todos}function Te(e){return e.map((e,t)=>({id:e.id||`todo-${t}`,title:e.content||``,description:e.activeForm||void 0,status:e.status===`completed`?`completed`:`pending`}))}z(()=>{M(),N()});let Ee;ne(()=>{Ee=e=>{e.key===`Escape`&&document.querySelectorAll(`[data-preview-open="true"]`).forEach(e=>{e.closePreview?.()})},document.addEventListener(`keydown`,Ee)}),z(()=>{Ee&&document.removeEventListener(`keydown`,Ee)});async function De(){let e=r.value===`preview`?b:u,t=r.value===`preview`?d.value:f.value,n=r.value===`preview`?c.value:o.value;e.lastIndex.value<n.length&&(e.lastIndex.value=n.length),await new Promise(e=>setTimeout(e,100)),t&&t.scrollTo({top:t.scrollHeight,behavior:`smooth`})}return(n,s)=>(I(),k(O,null,[e.request?(I(),k(`div`,Ni,[V(`div`,Pi,[V(`div`,Fi,[V(`div`,Ii,[V(`div`,Li,[V(`span`,{class:A([`px-3 py-1 rounded-md text-sm font-bold`,e.request.method===`GET`?`bg-blue-100 text-blue-700`:e.request.method===`POST`?`bg-green-100 text-green-700`:`bg-slate-100 text-slate-700`])},w(e.request.method),3),V(`span`,Ri,w(e.request.url),1),e.request.status?(I(),k(`span`,{key:0,class:A([`px-2 py-1 rounded text-xs font-bold`,e.request.status===200?`bg-green-100 text-green-700 border border-green-300`:`bg-red-100 text-red-700 border border-red-300`])},w(e.request.status),3)):j(``,!0),e.request.model?(I(),k(`div`,zi,[V(`span`,Bi,[V(`span`,Vi,w(e.request.model),1)])])):j(``,!0)]),V(`div`,Hi,[V(`span`,null,`Start: `+w(ee(e.request.startTime)),1),e.request.duration?(I(),k(`span`,Ui,`Duration: `+w(e.request.duration.toFixed(2))+`ms`,1)):j(``,!0),V(`span`,null,w(e.request.id),1)])]),V(`div`,Wi,[V(`button`,{onClick:s[0]||=e=>r.value=`preview`,disabled:!L.value,class:A([`px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-2 border border-slate-200`,L.value?r.value===`preview`?`bg-indigo-600 text-white shadow-sm`:`bg-white text-slate-600 hover:bg-slate-50`:`bg-slate-100 text-slate-400 cursor-not-allowed`])},[h(B(p),{class:`w-4 h-4`}),s[5]||=T(` 预览 `,-1)],10,Gi),K.value.length>0?(I(),k(`button`,{key:0,onClick:s[1]||=e=>i.value=!0,class:`bg-purple-50 border border-purple-200 text-purple-700 px-3 py-1.5 rounded-md text-xs font-mono shadow-sm hover:bg-purple-100 hover:border-purple-300 transition-colors cursor-pointer`,title:`点击查看 ${K.value.length} 个工具详情 (${re.value.length} 个 MCP 工具)`},[s[6]||=T(` Tools: `,-1),V(`span`,qi,w(K.value.length),1),re.value.length>0?(I(),k(`span`,Ji,`(`+w(re.value.length)+` MCP)`,1)):j(``,!0)],8,Ki)):j(``,!0),V(`button`,{onClick:s[2]||=e=>r.value=`timeline`,class:A([`px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-2 border border-slate-200`,r.value===`timeline`?`bg-indigo-600 text-white shadow-sm`:`bg-white text-slate-600 hover:bg-slate-50`])},[h(B(l),{class:`w-4 h-4`}),s[7]||=T(` 时间轴 `,-1)],2),V(`button`,{onClick:s[3]||=e=>r.value=`raw`,class:A([`px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-2 border border-slate-200`,r.value===`raw`?`bg-indigo-600 text-white shadow-sm`:`bg-white text-slate-600 hover:bg-slate-50`])},[h(B(t),{class:`w-4 h-4`}),s[8]||=T(` 原始数据 `,-1)],2)])])]),V(`div`,Yi,[r.value===`preview`||r.value===`timeline`?(I(),k(`button`,{key:0,onClick:De,class:`fixed right-12 bottom-8 z-50 w-8 h-8 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2`,title:`加载全部内容并滚动到底部`},[h(B(Ce),{class:`w-6 h-6`})])):j(``,!0),r.value===`preview`?(I(),k(`div`,Xi,[U(e.request)?(I(),k(`div`,Qi,[V(`div`,{ref_key:`messageContainerRef`,ref:d,class:`flex-1 overflow-y-auto overflow-x-hidden px-6 pr-2`},[V(`div`,$i,[(I(!0),k(O,null,W(F.value,(e,t)=>(I(),x(Nr,{key:t,item:e,"should-show-collapse":pe(e),"is-collapsed":Y(ue(e)),"collapsed-char-count":ge(e),"is-copy-success":Se(ue(e)),"word-wrap":le(ue(e)),"format-json":H,"get-display-content":he,"is-todo-write":we,"convert-todos-to-queue-format":Te,onToggleCollapse:t=>de(ue(e)),onCopyItem:t=>xe(e),onToggleWordWrap:t=>J(ue(e))},null,8,[`item`,`should-show-collapse`,`is-collapsed`,`collapsed-char-count`,`is-copy-success`,`word-wrap`,`onToggleCollapse`,`onCopyItem`,`onToggleWordWrap`]))),128))]),B(b).hasMore.value?(I(),k(`div`,{key:0,ref_key:`messageLoadTriggerRef`,ref:g,class:`w-full h-1 flex items-center justify-center py-2`},[B(b).isLoading.value?(I(),k(`div`,ea,` Loading more... `)):j(``,!0)],512)):j(``,!0)],512)])):(I(),k(`div`,Zi,[...s[9]||=[V(`div`,{class:`text-center`},[V(`p`,{class:`text-lg`},`此请求不是聊天补全请求，无法预览对话。`),V(`p`,{class:`text-sm mt-2`},`请切换到"时间轴"或"原始数据"查看详情。`)],-1)]]))])):j(``,!0),r.value===`timeline`?(I(),k(`div`,{key:2,ref_key:`timelineContainerRef`,ref:f,class:`h-full overflow-y-auto overflow-x-hidden p-6 py-0 my-6 mr-2`},[V(`div`,ta,[(I(!0),k(O,null,W(P.value,(e,t)=>(I(),k(`div`,{key:t,class:`flex gap-4 group mb-4 last:mb-0`},[V(`div`,na,[V(`span`,ra,w(te(e.time)),1),V(`span`,ia,` +`+w(R(o.value,t))+`ms `,1)]),V(`div`,aa,[V(`div`,{class:A([`w-3 h-3 rounded-full border-2 border-white shadow-sm z-10`,oe(e.level||30)])},null,2),t===(o.value.length||0)-1?j(``,!0):(I(),k(`div`,oa))]),V(`div`,sa,[V(`div`,ca,[V(`div`,la,[e.msg?(I(),k(`span`,ua,w(e.msg),1)):(I(),k(`span`,da,`Log Entry`)),V(`span`,fa,`Level `+w(e.level),1)]),e.type===`stream_event`||e.type===`full_response`||e.type===`error`||e.data||e.request||e.response||e.req||e.res||e.err?(I(),k(`div`,pa,[e.type===`full_response`&&e.data?.content?(I(),k(`div`,ma,[V(`span`,ha,[h(B(be),{class:`w-4 h-4`}),s[10]||=T(` > Full Response: `,-1)]),V(`div`,ga,[s[11]||=V(`div`,{class:`absolute top-0 left-0 w-1 h-full bg-green-600`},null,-1),V(`pre`,_a,w(Z(e)&&Y(Q(e,t))?(e.data.content?.trim()||``).substring(0,$)+`...`:e.data.content?.trim()||``),1),V(`div`,va,[T(` Length: `+w(e.data.content.length)+` chars `,1),e.data.model?(I(),k(`span`,ya,`Model: `+w(e.data.model),1)):j(``,!0)])])])):e.type===`stream_event`?(I(),k(`div`,ba,[V(`span`,xa,[h(B(be),{class:`w-4 h-4`}),T(` > Stream Event: `+w(e.data?.type||`unknown`),1)]),V(`div`,Sa,[s[12]||=V(`div`,{class:`absolute top-0 left-0 w-1 h-full bg-cyan-600`},null,-1),V(`pre`,Ca,w(Z(e)&&Y(Q(e,t))?H(e.data).trim().substring(0,$)+`...`:H(e.data).trim()),1)])])):e.type===`error`?(I(),k(`div`,wa,[V(`span`,Ta,[h(B(m),{class:`w-4 h-4`}),s[13]||=T(` > Error: `,-1)]),V(`div`,Ea,[V(`pre`,Da,w(Z(e)&&Y(Q(e,t))?H(e.err).trim().substring(0,$)+`...`:H(e.err).trim()),1)])])):(I(),k(O,{key:3},[e.data&&e.type!==`recieved data`?(I(),k(`div`,Oa,[s[14]||=V(`span`,{class:`text-blue-600 font-bold block mb-1`},`> Payload Data:`,-1),V(`pre`,ka,w(Z(e)&&Y(Q(e,t))?H(e.data).trim().substring(0,$)+`...`:H(e.data).trim()),1)])):j(``,!0),e.req?(I(),k(`div`,Aa,[s[15]||=V(`span`,{class:`text-purple-600 font-bold block mb-1`},`> Request Info:`,-1),V(`pre`,ja,w(Z(e)&&Y(Q(e,t))?H(e.req).trim().substring(0,$)+`...`:H(e.req).trim()),1)])):j(``,!0),e.request?(I(),k(`div`,Ma,[s[16]||=V(`span`,{class:`text-purple-600 font-bold block mb-1`},`> Outbound Request:`,-1),V(`pre`,Na,w(Z(e)&&Y(Q(e,t))?H(e.request).trim().substring(0,$)+`...`:H(e.request).trim()),1)])):j(``,!0),e.response&&!e.data?(I(),k(`div`,Pa,[s[17]||=V(`span`,{class:`text-green-600 font-bold block mb-1`},`> Response Info:`,-1),V(`pre`,Fa,w(Z(e)&&Y(Q(e,t))?H(e.response).trim().substring(0,$)+`...`:H(e.response).trim()),1)])):j(``,!0),e.type===`recieved data`?(I(),k(`div`,Ia,[...s[18]||=[V(`span`,{class:`text-teal-600 font-bold`},`> Stream Chunk Received`,-1)]])):j(``,!0),e.err?(I(),k(`div`,La,[s[19]||=V(`span`,{class:`text-red-600 font-bold block mb-1`},`> Error Trace:`,-1),V(`pre`,Ra,w(Z(e)&&Y(Q(e,t))?H(e.err).trim().substring(0,$)+`...`:H(e.err).trim()),1)])):j(``,!0)],64))])):j(``,!0),Z(e)?(I(),k(`div`,za,[V(`button`,{onClick:n=>de(Q(e,t)),class:`text-xs px-2 py-1 rounded flex items-center gap-1 transition-colors duration-200 hover:bg-slate-100 text-slate-600`},[Y(Q(e,t))?(I(),x(B(Ce),{key:0,class:`w-3.5 h-3.5`})):(I(),x(B(Ce),{key:1,class:`w-3.5 h-3.5 rotate-180`})),Y(Q(e,t))?(I(),k(`span`,Va,` 展开 (`+w(ye(e))+` 字符) `,1)):(I(),k(`span`,Ha,`折叠`))],8,Ba)])):j(``,!0)])])]))),128)),B(u).hasMore.value?(I(),k(`div`,{key:0,ref_key:`timelineLoadTriggerRef`,ref:_,class:`w-full h-1 flex items-center justify-center py-2`},[B(u).isLoading.value?(I(),k(`div`,Ua,` Loading more... `)):j(``,!0)],512)):j(``,!0)])],512)):j(``,!0),r.value===`raw`?(I(),k(`div`,Wa,[V(`div`,Ga,[h(_e,{class:`bg-white p-4 rounded-lg border border-slate-200 shadow-sm h-full`,"model-value":a.value,language:`json`,readonly:!0,options:{wordWrap:`on`,minimap:{enabled:!1},scrollBeyondLastLine:!1}},null,8,[`model-value`])])])):j(``,!0)])])):(I(),k(`div`,Ka,[...s[20]||=[V(`p`,{class:`text-xl font-semibold mb-2`},`选择一个请求查看详情`,-1),V(`p`,{class:`text-sm max-w-md text-center`},` 左侧列表展示了所有捕获的请求。点击任意条目可以查看时间轴、对话还原及原始日志数据。 `,-1)]])),h(ji,{show:i.value,request:e.request,"onUpdate:show":s[4]||=e=>i.value=e},null,8,[`show`,`request`])],64))}});function Ya(){let{fetchLogFiles:e,clearLogs:t}=re(),n=D([]),r=D(``),i=D(null),a=D(!1);async function o(t=!1){try{if(n.value=await e()||[],t&&n.value.length>0){let e=n.value[0];e&&await s(e)}}catch(e){console.error(`Error loading log files:`,e)}}async function s(e){r.value=e.path,i.value=e}async function c(){if(!(!r.value||!i.value)){a.value=!0;try{await o();let e=n.value.find(e=>e.path===r.value);e&&(i.value=e)}finally{a.value=!1}}}async function l(){if(!(!r.value||!i.value))try{await t(r.value),await o();let e=n.value.find(e=>e.path===r.value);e&&(i.value=e)}catch(e){console.error(`Error clearing log content:`,e)}}return{logFiles:n,selectedLogFile:r,selectedLogFileObj:i,isRefreshing:a,loadLogFiles:o,selectLogFile:s,refreshLogFile:c,clearCurrentLogFile:l}}function Xa(){let{fetchMessages:e,fetchMessageDetail:t}=re(),n=D([]),r=D(null),i=D(null),a=D(``),o=D(`all`),s=D(!1),c=D(!1),l=D(!1),u=D(!1),d=D(100),f=D(0),p=D(0);async function m(t=!1){if(!(s.value||c.value)){t?(s.value=!0,u.value=!0):c.value=!0;try{t&&(f.value=0);let r=await e(d.value,f.value);if(t)n.value=r.messages;else{let e=new Set(n.value.map(e=>e.requestId)),t=r.messages.filter(t=>!e.has(t.requestId));n.value=[...n.value,...t]}p.value=r.total,f.value+=r.messages.length}catch(e){console.error(`Error loading messages:`,e)}finally{s.value=!1,c.value=!1,t&&(u.value=!1)}}}async function h(e){if(!l.value){l.value=!0;try{i.value=await t(e)}catch(e){console.error(`Error loading message detail:`,e),i.value=null}finally{l.value=!1}}}async function g(e){r.value=e,await h(e)}function _(e){return e.hasResponse||e.hasStreamResponse?`completed`:e.hasRequest&&!e.hasResponse&&!e.hasStreamResponse?`pending`:`completed`}return{messages:n,selectedMessageId:r,selectedMessageDetail:i,searchQuery:a,filterTag:o,isLoading:s,isLoadingMore:c,isLoadingDetail:l,isRefreshing:u,filteredMessages:S(()=>{let e=n.value;if(o.value!==`all`&&(e=e.filter(e=>_(e)===o.value)),a.value){let t=a.value.toLowerCase();e=e.filter(e=>e.requestId.toLowerCase().includes(t)||e.model&&e.model.toLowerCase().includes(t)||e.timestamp&&e.timestamp.toLowerCase().includes(t))}return e}),hasMore:S(()=>n.value.length<p.value),loadMessages:m,loadMessageDetail:h,selectMessage:g}}var Za={class:`h-full flex flex-col bg-slate-50 overflow-hidden`},Qa={class:`flex-1 flex overflow-hidden`},$a={key:0,class:`flex-1 min-w-0 w-full h-full`},eo={key:0,class:`flex items-center justify-center h-full`},to={class:`flex flex-col items-center gap-3`},no={class:`w-80 shrink-0`},ro={class:`flex-1 min-w-0 w-full h-full flex items-center justify-center`},io={key:0,class:`flex flex-col items-center gap-3`},ao=F({__name:`LoggerPanel`,setup(e){let t=D(`messages`),{logFiles:n,selectedLogFileObj:r,isRefreshing:i,loadLogFiles:a,selectLogFile:o,refreshLogFile:s,clearCurrentLogFile:c}=Ya(),l=D(``),u=D(!1),d=D(!1),{messages:f,selectedMessageId:p,selectedMessageDetail:m,searchQuery:g,filterTag:_,isLoading:y,isLoadingMore:b,isLoadingDetail:C,isRefreshing:w,filteredMessages:T,hasMore:E,loadMessages:A,selectMessage:M}=Xa();async function N(){let e=p.value;if(await A(!0),e){if(T.value.some(t=>t.requestId===e))await M(e);else if(T.value.length>0){let e=T.value[0];e?.requestId&&await M(e.requestId)}}}async function P(){E.value&&!y.value&&await A(!1)}async function F(){let e=r.value?.path;if(await s(),e){let t=n.value.find(t=>t.path===e);if(t&&t.path!==r.value?.path)await o(t);else if(!t&&n.value.length>0){let e=n.value[0];e&&await o(e)}}r.value?await R(r.value.path):l.value=``}async function L(){await c(),r.value?await R(r.value.path):l.value=``}async function ee(){if(await A(!0),T.value.length>0&&!p.value){let e=T.value[0];e?.requestId&&await M(e.requestId)}}async function te(e=!1){d.value=!0;try{await a(e)}finally{d.value=!1}}async function R(e){if(!u.value){u.value=!0;try{let{useLlmApi:t}=await U(async()=>{let{useLlmApi:e}=await import(`./useLlmApi-KVLBFRuJ.js`);return{useLlmApi:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),{fetchLogs:n}=t(),r=await n(e,0,1e4);l.value=Array.isArray(r)?r.join(`
`):``}catch(e){console.error(`Error loading log content:`,e),l.value=``}finally{u.value=!1}}}v(()=>r.value,async e=>{e&&t.value===`logs`&&await R(e.path)});function H(e){if(!e)return null;let t=e.request||{},n=t.body||{},r=n.messages||t.messages||[],i=[];if((n.messages||t.messages)&&i.push({type:`request body`,time:new Date(e.request?.timestamp||e.requestId).getTime(),level:30,data:{...n,messages:r}}),!n.tools&&!t.tools&&t.body)try{let e=typeof t.body==`string`?JSON.parse(t.body):t.body;if(e.tools){let t=i.find(e=>e.type===`request body`);t&&(t.data.tools=e.tools)}}catch{}let a=!1,o=null;function s(e){if(!e)return null;let t={...e};if(t.message&&typeof t.message==`string`)try{let n=t.message,r=0,i=-1;for(let a=0;a<n.length;a++)if(n[a]===`{`)r===0&&(i=a),r++;else if(n[a]===`}`&&(r--,r===0&&i!==-1)){let r=n.substring(i,a+1);try{let n=JSON.parse(r);if(n.error?.message_zh){t.message=n.error.message_zh,t.originalMessage=e.message;break}else if(n.message_zh){t.message=n.message_zh,t.originalMessage=e.message;break}}catch{}}}catch{}return t}if(e.response?.full&&Array.isArray(e.response.full)){let r=``,c=e.response.full;for(let e of c){let t=e;t.error?o=s(t.error):t.message?.error?o=s(t.message.error):t.delta?.error&&(o=s(t.delta.error)),e.type===`content_block_delta`&&e.delta&&e.delta.type===`text_delta`&&e.delta.text&&(r+=e.delta.text)}r&&(a=!0,i.push({type:`full_response`,time:Date.now(),level:30,data:{content:r,model:n.model||t.model}}))}return!a&&e.response?.content&&(a=!0,i.push({type:`full_response`,time:Date.now(),level:30,data:{content:e.response.content,model:n.model||t.model}})),o&&i.push({type:`error`,time:Date.now(),level:50,err:o}),{id:e.requestId,startTime:new Date(e.request?.timestamp||e.requestId).getTime(),logs:i,method:t.method||`POST`,url:t.url||`/v1/messages`,status:200,model:n.model||t.model||``,fullResponse:e.response?.content||``,hasError:!!o,error:o,responseFull:e.response?.full||void 0}}let W=S(()=>H(m.value));v(()=>p.value,async e=>{e&&await M(e)}),v(t,async e=>{e===`messages`?await ee():e===`logs`&&(await te(!0),r.value&&await R(r.value.path))});function G(e){e.target.closest(`[data-log-dropdown]`)}return ne(async()=>{t.value===`messages`?await ee():t.value===`logs`&&(await te(!0),r.value&&await R(r.value.path)),document.addEventListener(`click`,G)}),z(()=>{document.removeEventListener(`click`,G)}),(e,a)=>(I(),k(`div`,Za,[h(et,{"active-mode":t.value,"log-files":B(n),"selected-log-file-obj":B(r),"is-refreshing":B(i),"is-refreshing-messages":B(w),"onUpdate:activeMode":a[0]||=e=>t.value=e,onSelectFile:B(o),onRefresh:F,onRefreshMessages:N,onClearLog:L},null,8,[`active-mode`,`log-files`,`selected-log-file-obj`,`is-refreshing`,`is-refreshing-messages`,`onSelectFile`]),V(`div`,Qa,[t.value===`logs`?(I(),k(`div`,$a,[d.value||u.value?(I(),k(`div`,eo,[V(`div`,to,[h(B(J),{class:`w-6 h-6 text-slate-400 animate-spin`}),a[4]||=V(`p`,{class:`text-slate-400 text-sm`},`加载中...`,-1)])])):(I(),x(_e,{key:1,class:`h-full`,"model-value":l.value,language:`json`,readonly:!0,options:{wordWrap:`on`,minimap:{enabled:!1},scrollBeyondLastLine:!1}},null,8,[`model-value`]))])):t.value===`messages`?(I(),k(O,{key:1},[V(`div`,no,[h(en,{messages:B(f),"selected-message-id":B(p),"search-query":B(g),"filter-tag":B(_),"is-loading":B(y),"is-loading-more":B(b),"is-refreshing":B(w),"has-more":B(E),"onUpdate:selectedMessageId":a[1]||=e=>p.value=e,"onUpdate:filterTag":a[2]||=e=>_.value=e,"onUpdate:searchQuery":a[3]||=e=>g.value=e,onRefresh:N,onLoadMore:P},null,8,[`messages`,`selected-message-id`,`search-query`,`filter-tag`,`is-loading`,`is-loading-more`,`is-refreshing`,`has-more`])]),V(`div`,ro,[B(y)&&!B(m)?(I(),k(`div`,io,[h(B(J),{class:`w-6 h-6 text-slate-400 animate-spin`}),a[5]||=V(`p`,{class:`text-slate-400 text-sm`},`加载中...`,-1)])):(I(),x(Ja,{key:1,request:W.value},null,8,[`request`]))])],64)):j(``,!0)])]))}});export{ao as default};