import{n as e,t}from"./SaveOutlined-Dxj_WRmH.js";import{n,t as r}from"./DnsOutlined-CTWqMa1w.js";import{t as i}from"./CheckOutlined-DEphouVW.js";import{t as a}from"./CodeOutlined-CLfIHCtY.js";import{t as o}from"./ContentCopyOutlined-BSSisDIl.js";import{n as s,t as c}from"./EditOutlined-CZHFqlPU.js";import{t as l}from"./GridViewOutlined-DuITpPMi.js";import{n as u,t as d}from"./SearchOutlined-BTXNd_tE.js";import{t as f}from"./PlayArrowOutlined-BSkvosrY.js";import{n as p,t as m}from"./SettingsOutlined-BEqIuKuj.js";import{t as h}from"./ViewListOutlined-D9SARPsO.js";import{t as g}from"./WarningOutlined-BYCjiJjg.js";import{$t as _,An as v,Dn as y,It as b,Jt as x,Kt as S,Mt as C,Pt as ee,Qn as w,Qt as T,Vn as E,Vt as D,Xt as O,Yn as k,Yt as A,bn as j,dn as te,en as M,gn as N,i as P,jn as F,pn as ne,qn as I,qt as L,r as re,s as ie,vn as R,w as ae,zt as oe}from"./index-urHyhAmF.js";import"./editor.api-CN-1LKou.js";import"./monaco.contribution-DPTc76V3.js";import{t as z}from"./useLlmApi-e_L-gZNA.js";import{l as B,o as se}from"./dist-DmajSpNV.js";import{t as V}from"./CodeEditor-BYu0j6s-.js";import{t as ce}from"./Input-DqR3mkMP.js";import"./Dropdown-ocMVVnLy.js";import{t as H}from"./BaseSelect-B1tsUc23.js";import{n as le,t as ue}from"./mcp-BwFAu-Fh.js";var U={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},de=M({name:`BuildOutlined`,render:function(e,t){return N(),O(`svg`,U,t[0]||=[L(`path`,{d:`M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11L6.08 7.52L2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82c-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09l4.24-4.24l-3.09-3.09c1.24-.07 2.49.37 3.44 1.31a4.469 4.469 0 0 1 1.24 3.96a4.35 4.35 0 0 1-.88 1.96l9.45 9.45l-.88.89z`,fill:`currentColor`},null,-1)])}}),W={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},fe=M({name:`OpenInNewOutlined`,render:function(e,t){return N(),O(`svg`,W,t[0]||=[L(`path`,{d:`M19 19H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3h-7z`,fill:`currentColor`},null,-1)])}}),G={class:`bg-white rounded-xl border border-slate-200 p-3 shadow-sm hover:shadow-md transition-shadow group flex flex-col h-full relative`},K={class:`flex items-start justify-between gap-2 mb-2`},q={class:`flex-1 min-w-0 pr-1 flex flex-col gap-2`},J={class:`font-bold text-slate-800 text-sm truncate`},Y={class:`flex items-center gap-2 text-xs text-slate-500 bg-slate-50 p-1.5 rounded border border-slate-100 truncate mt-0.5`},X={class:`truncate`},Z={class:`flex gap-1 items-center shrink-0`},Q={key:0,class:`btn-icon text-slate-400 cursor-default`,title:`保存配置中...`},pe={key:1,class:`flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity`},me={class:`mt-2 pt-2 border-t border-slate-100`},he={class:`flex items-center justify-between mb-1.5`},ge={class:`text-xs font-semibold text-slate-700 flex items-center gap-1.5`},_e={class:`flex items-center gap-1.5`},$=[`disabled`],ve={class:`text-xs text-slate-500`},ye={key:0,class:`text-center py-4 text-slate-400 text-xs`},be={key:1,class:`text-center py-4 text-slate-400 text-xs`},xe={key:2,class:`flex flex-wrap gap-1.5 content-start h-24 overflow-y-auto`},Se=[`title`,`onClick`],Ce={key:0,class:`mt-2 pt-2 border-t border-slate-100`},we={class:`flex flex-wrap gap-1.5`},Te={class:`mt-auto pt-2 border-t border-slate-100 flex items-center justify-between`},Ee={class:`flex items-center gap-1.5`},De={class:`flex items-center gap-1.5`},Oe=[`disabled`],ke=[`disabled`],Ae=M({__name:`MCPItem`,props:{server:{},tools:{},isLoadingTools:{type:Boolean},isToggling:{type:Boolean},isSavingConfig:{type:Boolean}},emits:[`delete`,`toggle`,`edit`,`toolClick`,`refresh`],setup(e,{emit:t}){let n=e,r=t,{endpoint:a}=z(),l=S(()=>n.server.config.enabled!==!1),u=E(`idle`),d=S(()=>n.server.config.command?`stdio`:n.server.config.url?n.server.config.type||`sse`:`unknown`),f=S(()=>{let e=d.value;return e===`stdio`?`STDIO`:e===`sse`?`SSE`:e===`streamable-http`?`HTTP`:`未知`}),m=S(()=>{let e=d.value;return e===`stdio`?`bg-blue-100 text-blue-700`:e===`sse`?`bg-green-100 text-green-700`:e===`streamable-http`?`bg-purple-100 text-purple-700`:`bg-slate-100 text-slate-700`}),h=S(()=>{let e=n.server.config;return e.command?`${e.command} ${(e.args||[]).join(` `)}`:e.url?e.url:`无描述`});function g(){r(`toggle`,n.server)}function v(){r(`delete`,n.server)}function y(){r(`edit`,n.server)}function b(e){r(`toolClick`,e)}function C(){r(`refresh`,n.server)}async function ee(){if(!navigator?.clipboard||u.value===`copying`)return;let e=a.value,t={[n.server.name]:{type:`http`,url:`${e}/mcp/${n.server.name}`}},r=JSON.stringify(t,null,2);try{u.value=`copying`,await navigator.clipboard.writeText(r),u.value=`done`}finally{setTimeout(()=>{u.value=`idle`},800)}}return(t,n)=>(N(),O(`div`,G,[L(`div`,K,[L(`div`,q,[L(`h3`,J,w(e.server.name),1),L(`div`,Y,[L(`span`,X,w(h.value),1)])]),L(`div`,Z,[e.isSavingConfig?(N(),O(`div`,Q,[_(I(p),{class:`w-4 h-4 animate-spin`})])):A(``,!0),e.isSavingConfig?A(``,!0):(N(),O(`div`,pe,[L(`button`,{class:`btn-icon text-slate-400 hover:text-primary-600`,title:`编辑`,onClick:y},[_(I(c),{class:`w-4 h-4`})]),L(`button`,{class:`btn-icon text-slate-400 hover:text-red-600`,title:`删除`,onClick:v},[_(I(s),{class:`w-4 h-4`})])]))])]),L(`div`,me,[L(`div`,he,[L(`h4`,ge,[_(I(de),{class:`w-3 h-3`}),n[0]||=T(` 工具列表 `,-1)]),L(`div`,_e,[L(`button`,{class:`btn-icon text-slate-400 hover:text-primary-600`,title:`刷新工具列表`,onClick:C,disabled:e.isLoadingTools},[_(I(p),{class:k([`w-3 h-3`,{"animate-spin":e.isLoadingTools}])},null,8,[`class`])],8,$),L(`span`,ve,w(e.tools.length)+` 个工具`,1)])]),e.isLoadingTools&&e.tools.length===0?(N(),O(`div`,ye,` 加载工具列表中... `)):e.tools.length===0?(N(),O(`div`,be,` 暂无工具 `)):(N(),O(`div`,xe,[(N(!0),O(D,null,R(e.tools,e=>(N(),O(`button`,{key:e.name,class:`text-[10px] px-2 py-0.5 bg-white border border-slate-200 rounded text-slate-600 font-mono cursor-pointer hover:bg-gray-100 hover:text-primary-700 transition-colors`,title:e.description||e.name,onClick:t=>b(e)},w(e.name),9,Se))),128))]))]),e.server.config.env&&Object.keys(e.server.config.env).length>0?(N(),O(`div`,Ce,[n[1]||=L(`h4`,{class:`text-xs font-semibold text-slate-700 mb-1`},`环境变量`,-1),L(`div`,we,[(N(!0),O(D,null,R(Object.keys(e.server.config.env),e=>(N(),O(`span`,{key:e,class:`text-[10px] px-2 py-0.5 bg-slate-100 text-slate-600 rounded font-mono`},w(e),1))),128))])])):A(``,!0),L(`div`,Te,[L(`div`,Ee,[L(`span`,{class:k([`px-2 py-0.5 text-xs font-mono font-bold rounded`,m.value])},w(f.value),3),L(`span`,{class:k([`px-2 py-0.5 text-xs font-semibold rounded flex items-center gap-1`,l.value?` text-green-700`:` text-slate-600`])},[L(`span`,{class:k([`w-2 h-2 rounded-full`,l.value?`bg-green-500`:`bg-slate-300`])},null,2),T(` `+w(l.value?`已启用`:`已禁用`),1)],2)]),L(`div`,De,[L(`button`,{type:`button`,class:k([`btn-icon bg-white text-slate-500 hover:text-primary-600`,[u.value===`done`?`text-green-600 border-green-200 bg-green-50`:``,u.value===`copying`?`opacity-80 cursor-wait`:``]]),disabled:u.value===`copying`,title:`复制 MCP 配置`,onClick:ee},[(N(),x(j(u.value===`done`?I(i):I(o)),{class:k([`w-3 h-3`,{"animate-pulse":u.value===`copying`,"text-green-600":u.value===`done`}])},null,8,[`class`]))],10,Oe),L(`button`,{class:k([`text-xs font-medium px-2.5 py-1 rounded-md transition-colors flex items-center gap-1`,[l.value?`bg-red-50 text-red-600 hover:bg-red-100`:`bg-green-50 text-green-600 hover:bg-green-100`,e.isToggling?`opacity-70 cursor-not-allowed pointer-events-none`:``]]),disabled:e.isToggling,onClick:g},[e.isToggling?(N(),x(I(p),{key:0,class:`w-3 h-3 animate-spin`})):A(``,!0),L(`span`,null,w(l.value?`禁用`:`启用`),1)],10,ke)])])]))}}),je={class:`flex-1 min-w-0`},Me={class:`flex gap-2 items-center shrink-0`},Ne={key:0,class:`btn-icon text-slate-400 cursor-default`,title:`保存配置中...`},Pe={key:1,class:`flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity`},Fe={key:0,class:`text-sm text-slate-500 bg-slate-50 p-2 rounded border border-slate-100 mb-3`},Ie={key:0,class:`w-96 shrink-0`},Le={class:`flex items-center justify-between mb-2`},Re={class:`text-xs font-semibold text-slate-700 flex items-center gap-1.5`},ze={class:`flex items-center gap-2`},Be=[`disabled`],Ve={class:`text-xs text-slate-500`},He={key:0,class:`text-center py-4 text-slate-400 text-xs`},Ue={key:1,class:`text-center py-4 text-slate-400 text-xs`},We={key:2,class:`flex flex-wrap gap-1.5 max-h-32 overflow-y-auto`},Ge=[`title`,`onClick`],Ke={class:`flex flex-col gap-2 shrink-0`},qe=[`disabled`],Je=M({__name:`MCPListItem`,props:{server:{},tools:{},isLoadingTools:{type:Boolean},isToggling:{type:Boolean},isSavingConfig:{type:Boolean},showTools:{type:Boolean,default:!1},compact:{type:Boolean,default:!1}},emits:[`delete`,`toggle`,`edit`,`toolClick`,`refresh`],setup(e,{emit:t}){let n=e,r=t,i=S(()=>n.server.config.enabled!==!1),a=S(()=>n.server.config.command?`stdio`:n.server.config.url?n.server.config.type||`sse`:`unknown`),o=S(()=>{let e=a.value;return e===`stdio`?`STDIO`:e===`sse`?`SSE`:e===`streamable-http`?`HTTP`:`未知`}),l=S(()=>{let e=a.value;return e===`stdio`?`bg-blue-100 text-blue-700`:e===`sse`?`bg-green-100 text-green-700`:e===`streamable-http`?`bg-purple-100 text-purple-700`:`bg-slate-100 text-slate-700`}),u=S(()=>{let e=n.server.config;return e.command?`${e.command} ${(e.args||[]).join(` `)}`:e.url?e.url:`无描述`});function d(){r(`toggle`,n.server)}function f(){r(`delete`,n.server)}function m(){r(`edit`,n.server)}function h(e){r(`toolClick`,e)}function g(){r(`refresh`,n.server)}return(t,n)=>(N(),O(`div`,{class:k([`bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow group`,e.compact?`px-4 py-2`:`p-4`])},[L(`div`,{class:k([`flex items-start`,e.compact?`gap-3`:`gap-4`])},[L(`div`,je,[L(`div`,{class:k([`flex items-center justify-between`,e.compact?`mb-0`:`mb-3`])},[L(`div`,{class:k([`flex items-center flex-1 min-w-0`,e.compact?`gap-2`:`gap-3`])},[L(`h3`,{class:k([`font-bold text-slate-800 truncate`,e.compact?`text-sm`:`text-base`])},w(e.server.name),3),L(`span`,{class:k([`text-xs font-mono font-bold rounded shrink-0`,[e.compact?`px-1.5 py-0.5`:`px-2 py-0.5`,l.value]])},w(o.value),3),L(`span`,{class:k([`text-xs font-semibold rounded flex items-center gap-1 shrink-0`,[e.compact?`px-1.5 py-0.5`:`px-2 py-0.5`,i.value?`text-green-700`:`text-slate-600`]])},[L(`span`,{class:k([`w-2 h-2 rounded-full`,i.value?`bg-green-500`:`bg-slate-300`])},null,2),T(` `+w(i.value?`已启用`:`已禁用`),1)],2)],2),L(`div`,Me,[e.isSavingConfig?(N(),O(`div`,Ne,[_(I(p),{class:`w-4 h-4 animate-spin`})])):(N(),O(`div`,Pe,[L(`button`,{class:`btn-icon text-slate-400 hover:text-indigo-600`,title:`编辑`,onClick:m},[_(I(c),{class:`w-4 h-4`})]),L(`button`,{class:`btn-icon text-slate-400 hover:text-red-600`,title:`删除`,onClick:f},[_(I(s),{class:`w-4 h-4`})])]))])],2),e.compact?A(``,!0):(N(),O(`div`,Fe,w(u.value),1))]),e.showTools?(N(),O(`div`,Ie,[L(`div`,Le,[L(`h4`,Re,[_(I(de),{class:`w-3 h-3`}),n[0]||=T(` 工具列表 `,-1)]),L(`div`,ze,[L(`button`,{class:`btn-icon text-slate-400 hover:text-indigo-600`,title:`刷新工具列表`,disabled:e.isLoadingTools,onClick:g},[_(I(p),{class:k([`w-3 h-3`,{"animate-spin":e.isLoadingTools}])},null,8,[`class`])],8,Be),L(`span`,Ve,w(e.tools.length)+` 个工具`,1)])]),e.isLoadingTools&&e.tools.length===0?(N(),O(`div`,He,` 加载工具列表中... `)):e.tools.length===0?(N(),O(`div`,Ue,` 暂无工具 `)):(N(),O(`div`,We,[(N(!0),O(D,null,R(e.tools,e=>(N(),O(`button`,{key:e.name,class:`text-[10px] px-2 py-0.5 bg-white border border-slate-200 rounded text-slate-600 font-mono cursor-pointer hover:bg-gray-100 hover:text-indigo-700 transition-colors`,title:e.description||e.name,onClick:t=>h(e)},w(e.name),9,Ge))),128))]))])):A(``,!0),L(`div`,Ke,[L(`button`,{class:k([`text-xs font-medium rounded-md transition-colors flex items-center gap-1.5 whitespace-nowrap`,[e.compact?`px-2 py-1`:`px-3 py-1.5`,i.value?`bg-red-50 text-red-600 hover:bg-red-100`:`bg-green-50 text-green-600 hover:bg-green-100`,e.isToggling?`opacity-70 cursor-not-allowed pointer-events-none`:``]]),disabled:e.isToggling,onClick:d},[e.isToggling?(N(),x(I(p),{key:0,class:`w-3 h-3 animate-spin`})):A(``,!0),L(`span`,null,w(i.value?`禁用`:`启用`),1)],10,qe)])],2)],2))}}),Ye=class{tasks=[];results=[];running=0;completed=0;concurrency;onProgress;onTaskComplete;resolveFinish;finishPromise;constructor(e={}){this.concurrency=e.concurrency??3,this.onProgress=e.onProgress,this.onTaskComplete=e.onTaskComplete}addTask(e){this.tasks.push(e),this.processQueue()}addTasks(e){this.tasks.push(...e),this.processQueue()}processQueue(){for(;this.running<this.concurrency&&this.tasks.length>0;){let e=this.tasks.shift();if(!e)break;this.running++,this.executeTask(e)}}async executeTask(e){try{let t=await e.executor(),n={id:e.id,result:t,success:!0};this.results.push(n),this.onTaskComplete?.(n)}catch(t){let n={id:e.id,error:t instanceof Error?t:Error(String(t)),success:!1};this.results.push(n),this.onTaskComplete?.(n)}finally{this.running--,this.completed++;let e=this.completed+this.running+this.tasks.length;this.onProgress?.(this.completed,e),this.processQueue(),this.running===0&&this.tasks.length===0&&this.resolveFinish&&(this.resolveFinish(),this.finishPromise=void 0,this.resolveFinish=void 0)}}async waitAll(){if(!(this.tasks.length===0&&this.running===0))return this.finishPromise||=new Promise(e=>{this.resolveFinish=e}),this.finishPromise}getResults(){return[...this.results]}getResult(e){return this.results.find(t=>t.id===e)}getStatus(){return{total:this.completed+this.tasks.length+this.running,completed:this.completed,running:this.running,pending:this.tasks.length}}clear(){this.tasks=[],this.results=[],this.completed=0,this.running=0,this.finishPromise=void 0,this.resolveFinish=void 0}},Xe={key:0,class:`fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4`},Ze={class:`px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50 shrink-0`},Qe={class:`font-bold text-slate-800 text-lg`},$e={class:`text-slate-500 text-base font-mono ml-2 px-2 py-1 rounded bg-gray-200`},et={key:0,class:`text-sm text-slate-500 mt-1`},tt={class:`flex-1 overflow-y-auto p-6 space-y-6`},nt={key:0},rt={class:`space-y-4`},it={class:`label-base flex items-center gap-2`},at={class:`flex items-center gap-1`},ot={key:0,class:`text-red-500 text-xs`},st=[`onUpdate:modelValue`,`placeholder`],ct=[`onUpdate:modelValue`,`placeholder`],lt={key:4,class:`inline-flex items-center gap-3 cursor-pointer`},ut=[`onUpdate:modelValue`],dt={class:`text-sm text-slate-700`},ft=[`onUpdate:modelValue`,`placeholder`],pt=[`onUpdate:modelValue`,`placeholder`],mt=[`onUpdate:modelValue`,`placeholder`],ht={key:1,class:`text-sm text-slate-500 text-center py-8`},gt={key:2},_t={key:0,class:`p-4 rounded-lg bg-red-50 border border-red-200 text-red-700 text-sm font-mono whitespace-pre-wrap`},vt={key:1,class:`p-4 rounded-lg bg-slate-50 border border-slate-200 text-slate-800 text-sm font-mono whitespace-pre-wrap max-h-96 overflow-y-auto`},yt={class:`px-6 py-4 border-t border-slate-100 bg-slate-50 flex justify-between items-center shrink-0`},bt={class:`flex items-center gap-3`},xt=[`disabled`],St={key:1,class:`w-4 h-4 inline-flex items-center justify-center`},Ct=[`disabled`],wt=5,Tt=P(M({__name:`ToolModal`,props:{show:{type:Boolean},tool:{},serverName:{},executionResult:{},executionError:{},isExecuting:{type:Boolean}},emits:[`update:show`,`execute`],setup(e,{emit:t}){let r=e,i=t,a=B(r,`show`,i),o=E({}),s=E(null),c=E(!1),l=E(null),u=E(!1),d=E({completed:0,total:0}),p=E(null),m=E(null),h=E(new Set);function g(e){return c.value&&h.value.has(e)}let{pushToast:j}=ae(),{sendMessage:M,translationModel:P,tempApiKey:ne,autoTranslate:re}=z(),V=se(`mcp_tool_translation_cache`,{});function ce(e){return`text_${e}`}function le(e){let t=ce(e);return V.value[t]||null}function ue(e,t){let n=ce(e);V.value[n]=t}let U=S(()=>r.tool&&(r.tool.inputSchema||r.tool.annotations)?.properties||{}),de=S(()=>r.tool&&(r.tool.inputSchema||r.tool.annotations)?.required||[]),W=S(()=>u.value&&s.value?.props||{}),fe=S(()=>r.tool?.name||``),G=S(()=>u.value?s.value?.description||r.tool?.description||``:r.tool?.description||``);y(()=>r.tool,e=>{if(s.value=null,l.value=null,c.value=!1,u.value=!1,m.value=null,h.value=new Set,p.value=null,e&&a.value){o.value={};let e=U.value;Object.keys(e).forEach(t=>{let n=e[t];n.default!==void 0&&(o.value[t]=n.default)})}},{immediate:!0}),y([()=>r.tool?.name,()=>a.value,()=>re.value,()=>P.value],([e,t,n,r])=>{let i=e||null;t&&i&&n&&r&&!c.value&&i!==p.value&&(p.value=i,Y())},{immediate:!0});function K(e){e.key===`Escape`&&a.value&&Q()}y(()=>a.value,e=>{e?window.addEventListener(`keydown`,K):window.removeEventListener(`keydown`,K)},{immediate:!0}),te(()=>{window.removeEventListener(`keydown`,K)});function q(e,t){if(u.value){let t=W.value[e]?.placeholder;if(t)return t}return t.type===`array`?`["item1", "item2"]`:t.type===`object`?`{"key": "value"}`:t.description||e}async function J(e,t,n){if(!e||!e.trim())return e||``;let r=le(e);if(r)return r;if(!t)throw Error(`未配置翻译模型，请在设置中配置翻译模型`);let i=(await M([{role:`user`,content:`请将以下文本内容翻译成中文，只返回翻译结果，不要添加任何解释或前缀：\n\n${e}`}],t,ne.value||void 0,n)).content.trim()||e;return ue(e,i),i}async function Y(){if(r.tool&&!c.value){if(s.value){u.value=!u.value;return}await X()}}async function X(){if(!P.value){let e=`未配置翻译模型，请在设置中配置翻译模型`;l.value=e,j(e,`error`);return}if(!r.tool){let e=`当前无可翻译的工具`;l.value=e,j(e,`error`);return}c.value=!0,l.value=null,d.value={completed:0,total:0},m.value=`${Date.now()}_${r.tool.name}`,h.value=new Set,s.value={name:r.tool.name,description:r.tool.description,props:{}},u.value=!0;try{let e=U.value,t=Object.entries(e),n=new Map,i={},a=(a,o)=>{if(!r.tool||!m.value||m.value!==c)return;o&&n.set(a,o),h.value.delete(a);let l=n.get(`description`)??r.tool.description;for(let[r]of t){let t=n.get(`prop_key_${r}`)||r,a=n.get(`prop_desc_${r}`)||e[r].description;i[r]={label:t,description:a,placeholder:a||t||r}}s.value={name:r.tool.name,description:l,props:{...i}}},o=new Ye({concurrency:wt,onProgress:(e,t)=>{d.value={completed:e,total:t}},onTaskComplete:e=>{if(!e.success){let t=e.error?.message||`翻译过程中出现错误`;l.value=t,j(t,`error`),h.value.delete(String(e.id));return}a(String(e.id),e.result)}}),c=m.value,u=r.tool;u.description&&u.description.trim()&&(h.value.add(`description`),o.addTask({id:`description`,executor:()=>J(u.description,P.value,void 0)}));for(let[e,n]of t)if(n.description&&n.description.trim()){let t=n.description;h.value.add(`prop_desc_${e}`),o.addTask({id:`prop_desc_${e}`,executor:()=>J(t,P.value,void 0)})}await o.waitAll()}catch(e){let t=e?.message||`翻译失败，请稍后重试`;l.value=t,j(t,`error`)}finally{c.value=!1,d.value={completed:0,total:0}}}function Z(){if(!r.tool)return;let e={};Object.keys(o.value).forEach(t=>{let n=o.value[t];n!=null&&n!==``&&(e[t]=n)}),i(`execute`,r.tool,e)}function Q(){a.value=!1}return(t,i)=>(N(),x(C,{name:`fade`},{default:v(()=>[I(a)&&e.tool?(N(),O(`div`,Xe,[L(`div`,{class:`relative bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col animate-in fade-in zoom-in duration-200`,onClick:i[0]||=oe(()=>{},[`stop`])},[L(`button`,{class:`btn-icon absolute right-3 top-3 bg-white/80 hover:bg-white`,onClick:Q},[_(I(ie),{class:`w-5 h-5`})]),L(`div`,Ze,[L(`div`,null,[L(`h3`,Qe,[i[1]||=T(` 工具 `,-1),L(`span`,$e,w(fe.value||`未命名工具`),1)]),G.value?(N(),O(`p`,et,[L(`span`,{class:k({"loading-dots":c.value&&g(`description`)})},w(G.value),3)])):A(``,!0)])]),L(`div`,tt,[Object.keys(U.value).length>0?(N(),O(`div`,nt,[i[2]||=L(`h4`,{class:`text-sm font-semibold text-slate-700 mb-4`},`参数`,-1),L(`div`,rt,[(N(!0),O(D,null,R(U.value,(e,t)=>(N(),O(`div`,{key:t,class:`space-y-2`},[L(`label`,it,[L(`span`,at,[L(`span`,null,w(t),1)]),de.value.includes(t)?(N(),O(`span`,ot,` * `)):A(``,!0)]),u.value&&W.value[t]?.description||e.description?(N(),O(`p`,{key:0,class:k([`text-xs text-slate-500 -mt-1`,{"loading-dots":c.value&&(g(`prop_desc_${t}`)||g(`prop_key_${t}`))}])},w(u.value&&W.value[t]?.description||e.description),3)):A(``,!0),e.type===`string`&&!e.enum?F((N(),O(`input`,{key:1,"onUpdate:modelValue":e=>o.value[t]=e,type:`text`,class:`input-base`,placeholder:q(t,e)},null,8,st)),[[b,o.value[t]]]):e.type===`string`&&e.enum?(N(),x(H,{key:2,class:`w-full`,"model-value":o.value[t],options:e.enum.map(e=>({label:String(e),value:e})),placeholder:`请选择...`,searchable:!1,clearable:!1,"onUpdate:modelValue":e=>o.value[t]=e},null,8,[`model-value`,`options`,`onUpdate:modelValue`])):e.type===`number`?F((N(),O(`input`,{key:3,"onUpdate:modelValue":e=>o.value[t]=e,type:`number`,class:`input-base`,placeholder:q(t,e)},null,8,ct)),[[b,o.value[t],void 0,{number:!0}]]):e.type===`boolean`?(N(),O(`label`,lt,[F(L(`input`,{"onUpdate:modelValue":e=>o.value[t]=e,type:`checkbox`,class:`w-5 h-5 rounded border-slate-300 text-primary focus:ring-primary`},null,8,ut),[[ee,o.value[t]]]),L(`span`,dt,w(W.value[t]?.description||e.description||t),1)])):e.type===`array`?F((N(),O(`textarea`,{key:5,"onUpdate:modelValue":e=>o.value[t]=e,class:`input-base font-mono text-sm`,rows:`3`,placeholder:q(t,e)},null,8,ft)),[[b,o.value[t]]]):e.type===`object`?F((N(),O(`textarea`,{key:6,"onUpdate:modelValue":e=>o.value[t]=e,class:`input-base font-mono text-sm`,rows:`5`,placeholder:q(t,e)},null,8,pt)),[[b,o.value[t]]]):F((N(),O(`input`,{key:7,"onUpdate:modelValue":e=>o.value[t]=e,type:`text`,class:`input-base`,placeholder:q(t,e)},null,8,mt)),[[b,o.value[t]]])]))),128))])])):(N(),O(`div`,ht,` 此工具不需要参数 `)),r.executionResult||r.executionError?(N(),O(`div`,gt,[i[3]||=L(`h4`,{class:`text-sm font-semibold text-slate-700 mb-4`},`执行结果`,-1),r.executionError?(N(),O(`div`,_t,w(r.executionError),1)):r.executionResult?(N(),O(`div`,vt,w(JSON.stringify(r.executionResult,null,2)),1)):A(``,!0)])):A(``,!0)]),L(`div`,yt,[L(`button`,{class:`btn-secondary`,onClick:Q},`关闭`),L(`div`,bt,[L(`button`,{class:`btn-secondary`,disabled:c.value||r.isExecuting,onClick:Y},[c.value?(N(),x(I(n),{key:0,class:`w-4 h-4 animate-spin`})):(N(),O(`span`,St,w(u.value?`原`:`译`),1)),T(` `+w(c.value?`翻译中 (${d.value.completed}/${d.value.total})`:u.value?`查看原文`:`翻译`),1)],8,xt),L(`button`,{class:`btn-primary`,disabled:r.isExecuting,onClick:Z},[r.isExecuting?(N(),x(I(n),{key:0,class:`w-4 h-4 animate-spin`})):(N(),x(I(f),{key:1,class:`w-4 h-4`})),T(` `+w(r.isExecuting?`执行中...`:`执行`),1)],8,Ct)])])])])):A(``,!0)]),_:1}))}}),[[`__scopeId`,`data-v-69b944d6`]]),Et={key:0,class:`fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4`},Dt={class:`px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50 shrink-0`},Ot={class:`font-bold text-slate-800 text-lg`},kt={class:`flex-1 overflow-y-auto p-6 space-y-6`},At={key:0},jt={key:1},Mt={class:`input-base bg-slate-100 text-slate-600 cursor-not-allowed`},Nt={class:`flex flex-col`},Pt={class:`border border-slate-200 rounded-lg overflow-hidden`,style:{height:`400px`}},Ft={key:2,class:`p-3 rounded-lg bg-red-50 border border-red-200 text-red-700 text-sm`},It={class:`px-6 py-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-3 shrink-0`},Lt=[`disabled`],Rt=[`disabled`],zt=M({__name:`ServerModal`,props:{show:{type:Boolean},server:{},defaultName:{},defaultConfig:{},isSaving:{type:Boolean}},emits:[`update:show`,`save`],setup(e,{emit:n}){let r=e,i=n,a=B(r,`show`,i),o=E(``),s=E(``),c=E(``),l=S(()=>r.server!==null);y(()=>[r.show,r.server],([e,t])=>{if(e){if(t)o.value=t.name,s.value=JSON.stringify(t.config,null,2);else{o.value=r.defaultName||``;let e=r.defaultConfig||{command:`npx`,args:[`-y`,`@modelcontextprotocol/server-fetch`],env:{}};s.value=JSON.stringify(e,null,2)}c.value=``}},{immediate:!0});function u(e){e.key===`Escape`&&a.value&&f()}y(()=>a.value,e=>{e?window.addEventListener(`keydown`,u):window.removeEventListener(`keydown`,u)},{immediate:!0}),te(()=>{window.removeEventListener(`keydown`,u)});function d(){try{if(!l.value&&!o.value.trim()){c.value=`请填写服务器名称`;return}let e;try{e=JSON.parse(s.value)}catch(e){c.value=`JSON 解析失败: ${e.message}`;return}if(!e.command&&!e.url){c.value=`配置必须包含 command 或 url 字段`;return}c.value=``,i(`save`,l.value?r.server.name:o.value.trim(),e)}catch(e){c.value=e.message}}function f(){a.value=!1,c.value=``}return(e,n)=>(N(),x(C,{name:`fade`},{default:v(()=>[I(a)?(N(),O(`div`,Et,[L(`div`,{class:`bg-white rounded-xl shadow-2xl w-full max-w-7xl max-h-[90vh] overflow-hidden flex flex-col animate-in fade-in zoom-in duration-200`,onClick:n[2]||=oe(()=>{},[`stop`])},[L(`div`,Dt,[L(`h3`,Ot,w(l.value?`编辑服务器`:`新建服务器`),1),L(`button`,{class:`btn-icon`,onClick:f},[_(I(ie),{class:`w-5 h-5`})])]),L(`div`,kt,[l.value?(N(),O(`div`,jt,[n[4]||=L(`label`,{class:`label-base`},`服务器名称`,-1),L(`div`,Mt,w(o.value),1)])):(N(),O(`div`,At,[n[3]||=L(`label`,{class:`label-base`},[T(` 服务器名称 `),L(`span`,{class:`text-red-500`},`*`)],-1),F(L(`input`,{"onUpdate:modelValue":n[0]||=e=>o.value=e,type:`text`,class:`input-base`,placeholder:`例如: my-mcp-server`},null,512),[[b,o.value]])])),L(`div`,Nt,[n[5]||=L(`label`,{class:`label-base mb-2`},[T(` 服务配置 (JSON) `),L(`span`,{class:`text-red-500`},`*`)],-1),L(`div`,Pt,[_(V,{modelValue:s.value,"onUpdate:modelValue":n[1]||=e=>s.value=e,language:`json`,theme:`vs`,class:`w-full h-full`},null,8,[`modelValue`])]),n[6]||=L(`p`,{class:`text-xs text-slate-500 mt-2`},` 直接编辑 JSON 配置，使用 Shift+Alt+F 格式化（或右键菜单） `,-1)]),c.value?(N(),O(`div`,Ft,w(c.value),1)):A(``,!0)]),L(`div`,It,[L(`button`,{class:`btn-secondary`,onClick:f,disabled:r.isSaving},` 取消 `,8,Lt),L(`button`,{class:`btn-primary`,disabled:r.isSaving,onClick:d},[r.isSaving?(N(),O(D,{key:0},[n[7]||=L(`span`,{class:`inline-block w-4 h-4 border-2 border-white/60 border-t-transparent rounded-full animate-spin`},null,-1),n[8]||=L(`span`,{class:`ml-2`},`保存中...`,-1)],64)):(N(),O(D,{key:1},[_(I(t),{class:`w-4 h-4`}),n[9]||=T(` 保存 `,-1)],64))],8,Rt)])])])):A(``,!0)]),_:1}))}}),Bt={key:0,class:`fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4`},Vt={class:`px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50 shrink-0`},Ht={class:`flex-1 overflow-y-auto p-6 space-y-4`},Ut=[`disabled`],Wt={key:0,class:`p-3 rounded-lg bg-red-50 border border-red-200 text-red-700 text-sm`},Gt={class:`px-6 py-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-3 shrink-0`},Kt=[`disabled`],qt=[`disabled`],Jt=M({__name:`ApiKeyModal`,props:{show:{type:Boolean}},emits:[`update:show`,`saved`],setup(e,{emit:n}){let r=e,i=n,a=B(r,`show`,i),o=E(``),s=E(!1),c=E(``);y(()=>r.show,e=>{e&&(f(),c.value=``)});function l(e){e.key===`Escape`&&a.value&&m()}y(()=>a.value,e=>{e?window.addEventListener(`keydown`,l):window.removeEventListener(`keydown`,l)},{immediate:!0}),te(()=>{window.removeEventListener(`keydown`,l)});let{fetchConfig:u,saveConfig:d}=z();async function f(){try{s.value=!0,o.value=(await u()).MCPRouterApiKey||``}catch(e){c.value=`加载配置失败: ${e.message}`}finally{s.value=!1}}async function p(){try{if(c.value=``,!o.value.trim()){c.value=`请输入 API 密钥`;return}s.value=!0;let e=await u();e.MCPRouterApiKey=o.value.trim();let t=await d(e);t.success?(i(`saved`),m()):c.value=t.message||`保存失败`}catch(e){c.value=`保存失败: ${e.message}`}finally{s.value=!1}}function m(){a.value=!1,c.value=``}return(e,n)=>(N(),x(C,{name:`fade`},{default:v(()=>[I(a)?(N(),O(`div`,Bt,[L(`div`,{class:`bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden flex flex-col animate-in fade-in zoom-in duration-200`,onClick:n[1]||=oe(()=>{},[`stop`])},[L(`div`,Vt,[n[2]||=L(`h3`,{class:`font-bold text-slate-800 text-lg`},`配置 MCPRouter API 密钥`,-1),L(`button`,{class:`btn-icon`,onClick:m},[_(I(ie),{class:`w-5 h-5`})])]),L(`div`,Ht,[L(`div`,null,[n[3]||=L(`label`,{class:`label-base`},[T(` API 密钥 `),L(`span`,{class:`text-red-500`},`*`)],-1),F(L(`input`,{"onUpdate:modelValue":n[0]||=e=>o.value=e,type:`password`,class:`input-base font-mono text-sm`,placeholder:`请输入 MCPRouter API 密钥`,disabled:s.value},null,8,Ut),[[b,o.value]]),n[4]||=L(`p`,{class:`text-xs text-slate-500 mt-2`},[T(` 请前往 `),L(`a`,{href:`https://mcprouter.co/settings/keys`,target:`_blank`,class:`text-indigo-600 hover:underline`},` https://mcprouter.co/settings/keys `),T(` 获取 API 密钥 `)],-1)]),c.value?(N(),O(`div`,Wt,w(c.value),1)):A(``,!0)]),L(`div`,Gt,[L(`button`,{class:`btn-secondary`,onClick:m,disabled:s.value},` 取消 `,8,Kt),L(`button`,{class:`btn-primary`,onClick:p,disabled:s.value},[_(I(t),{class:`w-4 h-4`}),n[5]||=T(` 保存 `,-1)],8,qt)])])])):A(``,!0)]),_:1}))}}),Yt={key:0,class:`fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4`},Xt={class:`bg-white rounded-xl shadow-2xl w-full max-w-7xl flex flex-col h-[85vh] overflow-hidden animate-in fade-in zoom-in duration-200`},Zt={class:`px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50`},Qt={class:`font-bold text-lg text-slate-800 flex items-center gap-3`},$t={class:`flex-1 overflow-hidden bg-slate-50 relative`},en={key:0,class:`absolute inset-0 flex items-center justify-center bg-slate-50/80 z-10`},tn={class:`px-6 py-4 border-t border-slate-100 bg-slate-50 flex justify-between items-center gap-4`},nn={key:0,class:`text-sm text-red-600 truncate`},rn={key:1,class:`text-xs text-slate-500`},an={class:`flex gap-2`},on=[`disabled`],sn=[`disabled`],cn=P(M({__name:`ConfigEditorModal`,props:{show:{type:Boolean}},emits:[`update:show`,`saving`,`saved`],setup(e,{emit:n}){let r=e,i=n,o=B(r,`show`,i),{endpoint:s}=z(),{pushToast:c}=ae(),l=E(``),u=E(``),d=E(!1),f=E(!1);y(()=>o.value,async e=>{e?await p():u.value=``},{immediate:!0});async function p(){try{f.value=!0,u.value=``;let e=`${s.value}/api/mcp/config`,t=await fetch(e);if(!t.ok)throw Error(`获取配置失败: ${t.statusText}`);let n=await t.json();l.value=JSON.stringify(n,null,2)}catch(e){u.value=`加载配置失败: ${e.message}`,console.error(`加载配置失败:`,e)}finally{f.value=!1}}async function m(){try{let e;try{e=JSON.parse(l.value)}catch(e){u.value=`JSON 解析失败: ${e.message}`;return}u.value=``,i(`saving`),h(),d.value=!0;let t=`${s.value}/api/mcp/config`,n=await fetch(t,{method:`PUT`,headers:{"Content-Type":`application/json`},body:JSON.stringify(e)});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.error||`保存配置失败: ${n.statusText}`)}await n.json(),i(`saved`)}catch(e){c(`保存配置失败: ${e.message}`,`error`),console.error(`保存配置失败:`,e),i(`saved`)}finally{d.value=!1}}function h(){o.value=!1,u.value=``}function g(e){e.key===`Escape`&&o.value&&!d.value&&h()}return y(()=>o.value,e=>{e?window.addEventListener(`keydown`,g):window.removeEventListener(`keydown`,g)},{immediate:!0}),te(()=>{window.removeEventListener(`keydown`,g)}),(e,n)=>(N(),x(C,{name:`fade`},{default:v(()=>[I(o)?(N(),O(`div`,Yt,[L(`div`,Xt,[L(`div`,Zt,[L(`h3`,Qt,[_(I(a),{class:`w-7 h-7`}),n[1]||=L(`span`,null,`编辑 MCP 配置`,-1)]),L(`button`,{class:`btn-icon`,onClick:h},[_(I(ie),{class:`w-5 h-5`})])]),L(`div`,$t,[f.value?(N(),O(`div`,en,[...n[2]||=[L(`div`,{class:`inline-block w-12 h-12 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin`},null,-1),L(`span`,{class:`ml-4 text-slate-600`},`加载配置中...`,-1)]])):A(``,!0),_(V,{modelValue:l.value,"onUpdate:modelValue":n[0]||=e=>l.value=e,language:`json`,theme:`vs`,class:`w-full h-full`},null,8,[`modelValue`])]),L(`div`,tn,[u.value?(N(),O(`span`,nn,w(u.value),1)):(N(),O(`span`,rn,`编辑完整的 MCP 配置 JSON，保存后将重载所有 MCP 连接。`)),L(`div`,an,[L(`button`,{class:`btn-secondary`,disabled:d.value||f.value,onClick:h},` 取消 `,8,on),L(`button`,{class:`btn-primary`,disabled:d.value||f.value,onClick:m},[_(I(t),{class:`w-4 h-4`}),T(` `+w(d.value?`保存中...`:`保存`),1)],8,sn)])])])])):A(``,!0)]),_:1}))}}),[[`__scopeId`,`data-v-b7bc5f64`]]),ln=[{name:`Alpha Vantage MCP`,description:`官方 Alpha Vantage MCP，提供实时与历史股票市场数据访问。`,value:`alphavantage/alphavantage-mcp`,realName:`alphavantage`},{name:`Nano Banana Edit MCP`,description:`Google 前沿图像生成与编辑模型的 MCP 服务。`,value:`fal-ai/nano-banana-edit-mcp`,realName:`fal-nano-banana-edit`},{name:`Nano Banana MCP`,description:`Google 前沿图像生成模型的 MCP 服务。`,value:`fal-ai/nano-banana-mcp`,realName:`fal-nano-banana`},{name:`Playwright MCP`,description:`基于 Playwright 的浏览器自动化 MCP，提供可访问性快照交互能力。`,value:`microsoft/playwright-mcp`,realName:`playwright`},{name:`MiniMax MCP`,description:`MiniMax MCP，提供图像生成、视频生成、TTS 等能力。`,value:`minimax/minimax-mcp`,realName:`minimax`},{name:`Perplexity Ask MCP Server`,description:`集成 Sonar API 的 Perplexity Ask MCP，支持实时全网检索。`,value:`perplexity/perplexity-mcp`,realName:`perplexity-ask`},{name:`ElevenLabs MCP`,description:`官方 ElevenLabs MCP，提供强大的 TTS 与音频处理 API。`,value:`elevenlabs/elevenlabs-mcp`,realName:`elevenlabs`},{name:`EdgeOne Pages MCP`,description:`将 HTML/目录/zip 部署到 EdgeOne Pages 并获取公网 URL 的 MCP 服务。`,value:`tencent/edgeone-pages-mcp`,realName:`edgeone-pages`},{name:`Context7 MCP`,description:`为任意提示提供最新代码文档的 MCP 服务。`,value:`upstash/context7-mcp`,realName:`context7`},{name:`Amap Maps MCP Server`,description:`高德地图官方 MCP 服务。`,value:`amap/amap-mcp`,realName:`amap-maps`},{name:`HuggingFace MCP Server`,description:`HuggingFace 官方 MCP 服务。`,value:`huggingface/hf-mcp`,realName:`hf-mcp`},{name:`Sequential Thinking MCP Server`,description:`提供结构化反思式解题流程的 Sequential Thinking MCP。`,value:`anthropic/sequentialthinking`,realName:`sequential-thinking`},{name:`Fetch MCP Server`,description:`具备网页内容抓取与 HTML 转 Markdown 能力的 MCP 服务。`,value:`anthropic/fetch-mcp`,realName:`fetch`},{name:`Time MCP Server`,description:`提供时间查询与时区转换能力的 MCP 服务，自动检测系统时区。`,value:`anthropic/time-mcp`,realName:`time`}],un={class:`max-w-7xl mx-auto h-full overflow-hidden flex flex-col`},dn={class:`flex justify-between items-center p-6 pb-4 border-b border-slate-200 shrink-0`},fn={class:`flex items-center gap-4 flex-1`},pn={class:`flex items-center gap-1 bg-slate-100 p-1 rounded-lg`},mn={key:0,class:`flex-1 max-w-md relative`},hn={key:0,class:`flex items-center gap-3`},gn={class:`flex items-center gap-1 bg-slate-100 p-1 rounded-lg`},_n=[`disabled`],vn={key:1,class:`flex items-center gap-3`},yn={key:0,class:`flex items-center gap-3 px-4 py-1 bg-yellow-50 border border-yellow-200 rounded-lg`,style:{"min-height":`40px`}},bn={class:`flex items-center gap-3`},xn={key:0,class:`flex-1 overflow-y-auto p-6`},Sn={key:0,class:`flex items-center justify-center py-16`},Cn={key:1,class:`py-16 flex flex-col items-center justify-center text-slate-400 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50/50`},wn={class:`font-medium`},Tn={key:2,class:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6`},En={key:3,class:`flex flex-col gap-4`},Dn={key:1,class:`flex-1 overflow-y-auto p-6`},On={class:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5`},kn={class:`flex items-start justify-between gap-2 mb-3`},An={class:`font-bold text-slate-800 text-sm truncate`},jn=[`onClick`],Mn={class:`text-sm text-slate-600 leading-6 line-clamp-3 flex-1`},Nn={class:`mt-3 pt-3 border-t border-slate-100`},Pn={class:`text-[11px] px-2 py-0.5 rounded bg-indigo-50 text-indigo-600 font-mono`},Fn={key:2,class:`flex-1 overflow-y-auto p-6`},In={class:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5`},Ln={class:`flex items-start justify-between gap-2 mb-3`},Rn={class:`font-bold text-slate-800 text-sm truncate`},zn=[`onClick`],Bn={class:`text-sm text-slate-600 leading-6 line-clamp-3 flex-1`},Vn={class:`mt-3 pt-3 border-t border-slate-100`},Hn={class:`text-[11px] px-2 py-0.5 rounded bg-indigo-50 text-indigo-600 font-mono`},Un=M({__name:`MCPPanel`,setup(t){let{pushToast:n}=ae(),{createServer:i,updateServer:a,callTool:o}=le(),s=ue(),{servers:f,isLoading:v,serverTools:y,serverToolsLoading:b,serverToggleLoading:C,hasApiKey:ee,mcpRouterApiKey:j}=re(s),{loadServers:te,loadToolsForServer:M,refreshAllTools:P,handleToggleServer:F,handleDeleteServer:ie,checkApiKey:oe}=s,z=E([]),B=E(``),se=E(!1),V=E(`servers`),H=E(`grid`),U=E(ln),de=E([{name:`文件系统`,description:`文件系统操作的模型上下文协议(MCP) 的Node.js 服务`,realName:`filesystem`,command:`npx`,args:[`-y`,`@modelcontextprotocol/server-filesystem`]},{name:`顺序思考`,description:`MCP服务器实现,提供了通过结构化思维过程进行动态思考的能力`,realName:`sequentialthinking`,command:`npx`,args:[`-y`,`@modelcontextprotocol/server-sequential-thinking`]},{name:`网页获取`,description:`获取 URL 网页内容的MCP服务器`,realName:`fetch`,command:`npx`,args:[`-y`,`mcp-server-fetch-typescript`]}]),W=E(!1),G=E(null),K=E(``),q=E(null),J=E(!1),Y=E(null),X=E(``),Z=E(null),Q=E(null),pe=E(!1),me=E(!1),he=E(!1),ge=E(!1),_e=S(()=>{if(!B.value.trim())return z.value;let e=B.value.toLowerCase();return z.value.filter(t=>t.name.toLowerCase().includes(e)||(t.config.command||``).toLowerCase().includes(e)||(t.config.url||``).toLowerCase().includes(e))});async function $(){await te(),z.value=[...f.value]}function ve(){G.value=null,K.value=``,q.value=null,W.value=!0}function ye(e){G.value=e,K.value=``,q.value=null,W.value=!0}function be(e){let t=e.realName||e.value.split(`/`).pop()||e.value;G.value=null,K.value=t;let n=j.value||`<请填写 API Key>`;q.value={url:`https://mcprouter.to/${t}`,type:`sse`,headers:{Authorization:`Bearer ${n}`,"HTTP-Referer":`https://www.cursor.com/`,"X-Title":`Cursor`}},W.value=!0}function xe(e){G.value=null,K.value=e.realName,q.value={command:e.command,args:e.args,enabled:!0},W.value=!0}async function Se(e,t){se.value=!0;try{if(G.value){let e=G.value;await a(e.name,t);let r=f.value.findIndex(t=>t.name===e.name);r!==-1&&f.value[r]&&(f.value[r].config=t,z.value=[...f.value]),n(`服务器已更新`,`success`)}else await i(e,t),n(`服务器已创建`,`success`),await $();W.value=!1,G.value=null}catch(t){n(`保存失败: ${t.message}`,`error`),await Ce(e)}finally{se.value=!1}}async function Ce(e){try{await $();let t=f.value.find(t=>t.name===e);t&&(G.value=t,W.value=!0)}catch(e){console.error(`刷新服务器列表失败:`,e)}}async function we(e){confirm(`确认删除服务器 "${e.name}"?`)&&(await ie(e),z.value=[...f.value])}function Te(e,t){Y.value=e,X.value=t,J.value=!0,Z.value=null,Q.value=null}async function Ee(e,t){try{pe.value=!0,Q.value=null,Z.value=null;let r=f.value.find(e=>e.name===X.value);Z.value=await o(X.value,e.name,t,r?.config),n(`工具执行成功`,`success`)}catch(e){Q.value=e.message,n(`工具执行失败: ${e.message}`,`error`)}finally{pe.value=!1}}function De(){window.open(`https://mcprouter.co/settings/keys`,`_blank`)}function Oe(){me.value=!0}async function ke(){n(`API 密钥已保存`,`success`),await oe()}function je(){he.value=!0}function Me(){ge.value=!0}async function Ne(){try{await $(),n(`配置已保存并重载`,`success`)}catch(e){n(`配置保存失败: ${e.message}`,`error`)}finally{ge.value=!1}}return ne(()=>{$(),oe()}),(t,n)=>(N(),O(`div`,un,[L(`div`,dn,[L(`div`,fn,[L(`div`,pn,[L(`button`,{class:k([`px-4 py-1.5 rounded-md text-sm font-medium transition-all flex items-center gap-2`,V.value===`servers`?`bg-white text-indigo-600 shadow-sm`:`text-slate-500 hover:text-slate-700`]),onClick:n[0]||=e=>V.value=`servers`},[_(I(r),{class:`w-4 h-4`}),n[11]||=T(` 服务器 `,-1)],2),L(`button`,{class:k([`px-4 py-1.5 rounded-md text-sm font-medium transition-all`,V.value===`empty`?`bg-white text-indigo-600 shadow-sm`:`text-slate-500 hover:text-slate-700`]),onClick:n[1]||=e=>V.value=`empty`},[...n[12]||=[L(`span`,{class:`font-mono`},`MCPRouter`,-1)]],2)]),V.value===`servers`?(N(),O(`div`,mn,[_(I(d),{class:`absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400 z-10 pointer-events-none`}),_(ce,{modelValue:B.value,"onUpdate:modelValue":n[2]||=e=>B.value=e,type:`text`,placeholder:`搜索服务器...`,class:`w-full pl-10`},null,8,[`modelValue`])])):A(``,!0)]),V.value===`servers`?(N(),O(`div`,hn,[L(`div`,gn,[L(`button`,{type:`button`,class:k([`p-1.5 rounded transition-colors`,H.value===`grid`?`bg-white text-indigo-600 shadow-sm`:`text-slate-600 hover:text-slate-800`]),title:`网格布局`,onClick:n[3]||=e=>H.value=`grid`},[_(I(l),{class:`w-4 h-4`})],2),L(`button`,{type:`button`,class:k([`p-1.5 rounded transition-colors`,H.value===`list`?`bg-white text-indigo-600 shadow-sm`:`text-slate-600 hover:text-slate-800`]),title:`列表布局`,onClick:n[4]||=e=>H.value=`list`},[_(I(h),{class:`w-4 h-4`})],2),L(`button`,{type:`button`,class:k([`p-1.5 rounded transition-colors`,H.value===`compact-list`?`bg-white text-indigo-600 shadow-sm`:`text-slate-600 hover:text-slate-800`]),title:`紧凑列表`,onClick:n[5]||=e=>H.value=`compact-list`},[_(I(u),{class:`w-4 h-4`})],2)]),L(`button`,{class:`btn-secondary shadow-sm`,disabled:I(v),onClick:n[6]||=(...e)=>I(P)&&I(P)(...e)},[_(I(p),{class:`w-4 h-4`}),n[13]||=T(` 刷新工具 `,-1)],8,_n),L(`button`,{class:`btn-secondary shadow-sm`,onClick:je,title:`编辑整个 MCP 配置`},[_(I(c),{class:`w-4 h-4`}),n[14]||=T(` 编辑配置 `,-1)]),L(`button`,{class:`btn-primary shadow-lg shadow-indigo-500/20`,onClick:ve},[_(I(e),{class:`w-4 h-4`}),n[15]||=T(` 新增服务器 `,-1)])])):V.value===`empty`?(N(),O(`div`,vn,[I(ee)?A(``,!0):(N(),O(`div`,yn,[_(I(g),{class:`w-4 h-4 text-yellow-600 shrink-0`}),L(`div`,bn,[n[17]||=L(`div`,null,[L(`div`,{class:`text-sm font-semibold text-slate-900 leading-tight`},` API 密钥未配置 `)],-1),L(`button`,{class:`flex items-center gap-1.5 px-3 py-1.5 bg-indigo-600 text-white text-xs font-medium rounded-md hover:bg-indigo-700 transition-colors ml-2 shrink-0`,onClick:De},[_(I(fe),{class:`w-3.5 h-3.5`}),n[16]||=T(` 获取 API 密钥 `,-1)])])])),L(`button`,{class:`btn-secondary shadow-sm flex items-center gap-1.5`,onClick:Oe},[_(I(m),{class:`w-4 h-4`}),n[18]||=T(` 在设置中配置 `,-1)])])):A(``,!0)]),V.value===`servers`?(N(),O(`div`,xn,[I(v)&&I(f).length===0?(N(),O(`div`,Sn,[...n[19]||=[L(`div`,{class:`inline-block w-12 h-12 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin`},null,-1),L(`span`,{class:`ml-4 text-slate-600`},`加载中...`,-1)]])):_e.value.length===0?(N(),O(`div`,Cn,[_(I(r),{class:`w-12 h-12 mb-4 text-slate-300`}),L(`p`,wn,w(B.value?`未找到匹配的服务器`:`暂无 MCP 服务器`),1),B.value?A(``,!0):(N(),O(`button`,{key:0,class:`mt-4 text-indigo-600 hover:underline text-sm`,onClick:$},` 点击添加第一个 `))])):H.value===`grid`?(N(),O(`div`,Tn,[(N(!0),O(D,null,R(_e.value,e=>(N(),x(Ae,{key:e.name,server:e,tools:I(y)[e.name]||[],"is-loading-tools":I(b)[e.name]||!1,"is-toggling":I(C)[e.name]||!1,"is-saving-config":ge.value,onDelete:we,onToggle:I(F),onEdit:ye,onToolClick:t=>Te(t,e.name),onRefresh:e=>I(M)(e.name)},null,8,[`server`,`tools`,`is-loading-tools`,`is-toggling`,`is-saving-config`,`onToggle`,`onToolClick`,`onRefresh`]))),128))])):(N(),O(`div`,En,[(N(!0),O(D,null,R(_e.value,e=>(N(),x(Je,{key:e.name,server:e,tools:I(y)[e.name]||[],"is-loading-tools":I(b)[e.name]||!1,"is-toggling":I(C)[e.name]||!1,"is-saving-config":ge.value,compact:H.value===`compact-list`,onDelete:we,onToggle:I(F),onEdit:ye,onToolClick:t=>Te(t,e.name),onRefresh:e=>I(M)(e.name)},null,8,[`server`,`tools`,`is-loading-tools`,`is-toggling`,`is-saving-config`,`compact`,`onToggle`,`onToolClick`,`onRefresh`]))),128))]))])):V.value===`empty`?(N(),O(`div`,Dn,[L(`div`,On,[(N(!0),O(D,null,R(U.value,t=>(N(),O(`div`,{key:t.value,class:`bg-white border border-slate-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow flex flex-col h-full group`},[L(`div`,kn,[L(`h3`,An,w(t.name),1),L(`button`,{class:`btn-icon text-slate-400 hover:text-indigo-600`,title:`添加到服务器`,onClick:e=>be(t)},[_(I(e),{class:`w-4 h-4`})],8,jn)]),L(`p`,Mn,w(t.description),1),L(`div`,Nn,[L(`span`,Pn,w(t.realName),1)])]))),128))])])):V.value===`builtin`?(N(),O(`div`,Fn,[L(`div`,In,[(N(!0),O(D,null,R(de.value,t=>(N(),O(`div`,{key:t.realName,class:`bg-white border border-slate-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow flex flex-col h-full group`},[L(`div`,Ln,[L(`h3`,Rn,w(t.name),1),L(`button`,{class:`btn-icon text-slate-400 hover:text-indigo-600`,title:`添加到服务器`,onClick:e=>xe(t)},[_(I(e),{class:`w-4 h-4`})],8,zn)]),L(`p`,Bn,w(t.description),1),L(`div`,Vn,[L(`span`,Hn,w(t.realName),1)])]))),128))])])):A(``,!0),_(zt,{show:W.value,server:G.value,"default-name":K.value,"default-config":q.value,"is-saving":se.value,"onUpdate:show":n[7]||=e=>W.value=e,onSave:Se},null,8,[`show`,`server`,`default-name`,`default-config`,`is-saving`]),Y.value?(N(),x(Tt,{key:3,show:J.value,tool:Y.value,"server-name":X.value,"execution-result":Z.value,"execution-error":Q.value,"is-executing":pe.value,"onUpdate:show":n[8]||=e=>J.value=e,onExecute:Ee},null,8,[`show`,`tool`,`server-name`,`execution-result`,`execution-error`,`is-executing`])):A(``,!0),_(Jt,{show:me.value,"onUpdate:show":n[9]||=e=>me.value=e,onSaved:ke},null,8,[`show`]),_(cn,{show:he.value,"onUpdate:show":n[10]||=e=>he.value=e,onSaving:Me,onSaved:Ne},null,8,[`show`])]))}});export{Un as default};