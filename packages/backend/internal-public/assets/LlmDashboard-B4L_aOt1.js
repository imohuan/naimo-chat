import{n as e,t}from"./SaveOutlined-Dxj_WRmH.js";import{n,t as r}from"./DnsOutlined-CTWqMa1w.js";import{t as i}from"./CodeOutlined-CLfIHCtY.js";import{t as a}from"./DashboardOutlined-qhNWpnHR.js";import{t as o}from"./DescriptionOutlined-BZtsuoqD.js";import{t as s}from"./PlayArrowOutlined-BSkvosrY.js";import{n as c,t as l}from"./SettingsOutlined-BEqIuKuj.js";import{$t as u,An as d,At as f,Dn as p,Ht as m,In as h,It as g,Jt as _,Kt as v,Lt as y,Mt as b,Ot as x,Pt as S,Qn as C,Qt as w,Rt as T,Ut as E,Vn as D,Vt as O,Xt as k,Yn as A,Yt as j,Zn as M,_n as N,bn as P,c as F,dn as I,en as L,gn as R,i as z,jn as B,kt as V,ln as H,o as U,pn as W,qn as G,qt as K,s as q,vn as J,w as Y,zt as X}from"./index-urHyhAmF.js";import"./editor.api-CN-1LKou.js";import"./monaco.contribution-DPTc76V3.js";import{t as Z}from"./useLlmApi-e_L-gZNA.js";import{l as Q,r as ee}from"./dist-DmajSpNV.js";import{M as te,a as ne,i as re,n as ie,r as ae,t as oe}from"./SelectValue-BI7pjivR.js";import{t as se}from"./TransformerConfigList-BnLvAEGT.js";import{n as ce,t as le}from"./RouterModelSelect-WstA--1e.js";import{t as ue}from"./utils-jrYJ9m3X.js";import{t as de}from"./CodeEditor-BYu0j6s-.js";import{t as $}from"./Input-DqR3mkMP.js";import"./Dropdown-ocMVVnLy.js";import"./BaseSelect-B1tsUc23.js";var fe={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},pe=L({name:`ExtensionOutlined`,render:function(e,t){return R(),k(`svg`,fe,t[0]||=[K(`path`,{d:`M10.5 4.5c.28 0 .5.22.5.5v2h6v6h2c.28 0 .5.22.5.5s-.22.5-.5.5h-2v6h-2.12c-.68-1.75-2.39-3-4.38-3s-3.7 1.25-4.38 3H4v-2.12c1.75-.68 3-2.39 3-4.38c0-1.99-1.24-3.7-2.99-4.38L4 7h6V5c0-.28.22-.5.5-.5m0-2A2.5 2.5 0 0 0 8 5H4c-1.1 0-1.99.9-1.99 2v3.8h.29c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-.3c0-1.49 1.21-2.7 2.7-2.7s2.7 1.21 2.7 2.7v.3H17c1.1 0 2-.9 2-2v-4a2.5 2.5 0 0 0 0-5V7c0-1.1-.9-2-2-2h-4a2.5 2.5 0 0 0-2.5-2.5z`,fill:`currentColor`},null,-1)])}}),me={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},he=L({name:`FolderOpenOutlined`,render:function(e,t){return R(),k(`svg`,me,t[0]||=[K(`path`,{d:`M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z`,fill:`currentColor`},null,-1)])}}),ge={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},_e=L({name:`ForumOutlined`,render:function(e,t){return R(),k(`svg`,ge,t[0]||=[K(`path`,{d:`M15 4v7H5.17L4 12.17V4h11m1-2H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm5 4h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1z`,fill:`currentColor`},null,-1)])}}),ve={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},ye=L({name:`LinkOutlined`,render:function(e,t){return R(),k(`svg`,ve,t[0]||=[K(`path`,{d:`M17 7h-4v2h4c1.65 0 3 1.35 3 3s-1.35 3-3 3h-4v2h4c2.76 0 5-2.24 5-5s-2.24-5-5-5zm-6 8H7c-1.65 0-3-1.35-3-3s1.35-3 3-3h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-2zm-3-4h8v2H8z`,fill:`currentColor`},null,-1)])}}),be={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},xe=L({name:`StorageOutlined`,render:function(e,t){return R(),k(`svg`,be,t[0]||=[K(`path`,{d:`M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z`,fill:`currentColor`},null,-1)])}}),Se={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},Ce=L({name:`TerminalOutlined`,render:function(e,t){return R(),k(`svg`,Se,t[0]||=[K(`path`,{d:`M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16c1.1 0 2-.9 2-2V6a2 2 0 0 0-2-2zm0 14H4V8h16v10zm-2-1h-6v-2h6v2zM7.5 17l-1.41-1.41L8.67 13l-2.59-2.59L7.5 9l4 4l-4 4z`,fill:`currentColor`},null,-1)])}}),we={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},Te=L({name:`TimerOutlined`,render:function(e,t){return R(),k(`svg`,we,t[0]||=[K(`path`,{d:`M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42A8.962 8.962 0 0 0 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9a8.994 8.994 0 0 0 7.03-14.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7s7 3.13 7 7s-3.13 7-7 7z`,fill:`currentColor`},null,-1)])}}),Ee={xmlns:`http://www.w3.org/2000/svg`,"xmlns:xlink":`http://www.w3.org/1999/xlink`,viewBox:`0 0 24 24`},De=L({name:`VpnKeyOutlined`,render:function(e,t){return R(),k(`svg`,Ee,t[0]||=[K(`path`,{d:`M22 19h-6v-4h-2.68c-1.14 2.42-3.6 4-6.32 4c-3.86 0-7-3.14-7-7s3.14-7 7-7c2.72 0 5.17 1.58 6.32 4H24v6h-2v4zm-4-2h2v-4h2v-2H11.94l-.23-.67C11.01 8.34 9.11 7 7 7c-2.76 0-5 2.24-5 5s2.24 5 5 5c2.11 0 4.01-1.34 4.71-3.33l.23-.67H18v4zM7 15c-1.65 0-3-1.35-3-3s1.35-3 3-3s3 1.35 3 3s-1.35 3-3 3zm0-4c-.55 0-1 .45-1 1s.45 1 1 1s1-.45 1-1s-.45-1-1-1z`,fill:`currentColor`},null,-1)])}}),Oe={},ke={t:`1766041887765`,class:`icon`,viewBox:`0 0 1024 1024`,version:`1.1`,xmlns:`http://www.w3.org/2000/svg`,"p-id":`5495`};function Ae(e,t){return R(),k(`svg`,ke,[...t[0]||=[K(`path`,{d:`M0 0h1024v1024H0z`,fill:`#D19B75`,"p-id":`5496`},null,-1),K(`path`,{d:`M303.821875 742.4H206.18125a1.38125 1.38125 0 0 1-1.15-0.640625 1.459375 1.459375 0 0 1-0.128125-1.33125l178.125-457.959375a1.38125 1.38125 0 0 1 1.303125-0.86875h101.990625c0.5625 0 1.075 0.33125 1.28125 0.86875l177.89375 457.984375a1.459375 1.459375 0 0 1-0.125 1.30625 1.38125 1.38125 0 0 1-1.15625 0.640625h-97.43125a1.38125 1.38125 0 0 1-1.28125-0.921875l-35.865625-94.515625a1.38125 1.38125 0 0 0-1.28125-0.921875h-186.3125a1.38125 1.38125 0 0 0-1.28125 0.921875l-35.6875 94.515625a1.38125 1.38125 0 0 1-1.28125 0.921875z m80.28125-181.04375a1.28125 1.28125 0 0 0 0.153125 1.28125c0.28125 0.35625 0.740625 0.5625 1.203125 0.5625h125.08125a1.484375 1.484375 0 0 0 1.203125-0.5875 1.28125 1.28125 0 0 0 0.15625-1.28125l-62.51875-150.834375a1.459375 1.459375 0 0 0-1.38125-0.896875 1.459375 1.459375 0 0 0-1.38125 0.896875z m160.153125-279.75625h95.309375a1.5375 1.5375 0 0 1 1.459375 1.025l178.071875 457.6a1.696875 1.696875 0 0 1-0.153125 1.484375 1.5375 1.5375 0 0 1-1.28125 0.6875H722.40625a1.5375 1.5375 0 0 1-1.484375-1.021875L542.821875 283.775a1.6125 1.6125 0 0 1 0.15625-1.484375 1.5375 1.5375 0 0 1 1.278125-0.690625z`,fill:`#1F1F1E`,"p-id":`5497`},null,-1)]])}var je=z(Oe,[[`render`,Ae]]);function Me(){let{fetchClipboardWatchStatus:e,startClipboardWatch:t,stopClipboardWatch:n}=Z(),r=D(null),i=D(!1),a=D(!1);async function o(){try{a.value=!0,r.value=await e(),i.value=!!r.value?.running}finally{a.value=!1}}async function s(e){try{a.value=!0;let o=e?await t():await n();return r.value=o,i.value=!!o.running,o}finally{a.value=!1}}return{status:r,enabled:i,loading:a,refreshStatus:o,toggle:s}}var Ne={key:0,class:`fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4`},Pe={class:`bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col animate-in fade-in zoom-in duration-200`},Fe={class:`px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50`},Ie={class:`font-bold text-slate-800 flex items-center gap-2`},Le={class:`flex-1 overflow-y-auto p-6 space-y-6`},Re={class:`space-y-2`},ze=[`value`],Be={class:`space-y-2`},Ve={class:`space-y-2`},He={class:`space-y-2`},Ue={class:`flex items-center justify-between gap-4 p-3 rounded-xl border border-slate-100 bg-slate-50/70`},We={class:`inline-flex items-center gap-3 cursor-pointer select-none`},Ge={class:`relative`},Ke={class:`text-xs break-all`},qe={class:`px-6 py-4 border-t border-slate-100 bg-slate-50 flex justify-between items-center`},Je={class:`flex gap-3`},Ye=[`disabled`],Xe=[`disabled`],Ze=L({__name:`SettingsModal`,props:{show:{type:Boolean},baseUrl:{},tempApiKey:{},healthStatus:{},translationModel:{},autoTranslate:{type:Boolean},providers:{}},emits:[`update:show`,`update:baseUrl`,`update:tempApiKey`,`update:translationModel`,`update:autoTranslate`,`save`,`check`],setup(e,{emit:n}){let r=e,i=n,a=Q(r,`show`,i),o=Q(r,`baseUrl`,i),s=Q(r,`tempApiKey`,i),c=Q(r,`translationModel`,i),f=Q(r,`autoTranslate`,i),{enabled:m,status:g,loading:y,refreshStatus:x,toggle:T}=Me(),{fetchConfig:E,saveConfig:O}=Z(),{pushToast:M}=Y(),N=D(``),P=D(!1),I=v(()=>{let e=[];return(r.providers||[]).forEach(t=>{t.enabled!==!1&&t.models&&t.models.forEach(n=>{e.push(`${t.name},${n}`)})}),e.sort()});W(()=>{a.value&&(x(),N.value=r.tempApiKey)}),p(()=>a.value,e=>{e&&(x(),N.value=r.tempApiKey)});async function L(){try{if(P.value=!0,s.value!==N.value)try{let e=await E();e.APIKEY=s.value.trim(),await O(e)}catch(e){console.error(`同步 API Key 到后台失败:`,e),M(`同步 API Key 失败: ${e.message}`,`error`)}i(`save`)}catch(e){M(`保存失败: ${e.message}`,`error`)}finally{P.value=!1}}return(n,r)=>(R(),_(b,{name:`fade`},{default:d(()=>[G(a)?(R(),k(`div`,Ne,[K(`div`,Pe,[K(`div`,Fe,[K(`h3`,Ie,[u(G(l),{class:`w-5 h-5`}),r[8]||=K(`span`,{class:`text-lg`},`全局设置`,-1)]),K(`button`,{class:`btn-icon`,onClick:r[0]||=e=>a.value=!1},[u(G(q),{class:`w-5 h-5`})])]),K(`div`,Le,[K(`div`,Re,[r[9]||=K(`label`,{class:`label-base`},`API Base URL`,-1),K(`input`,{value:G(o),type:`text`,class:`input-base bg-slate-100 cursor-not-allowed`,placeholder:`http://127.0.0.1:3457`,readonly:``,disabled:``},null,8,ze),r[10]||=K(`p`,{class:`text-xs text-slate-500`},`后端服务的基础地址（只读）。`,-1)]),K(`div`,Be,[r[11]||=K(`label`,{class:`label-base`},`临时 API Key`,-1),u($,{modelValue:G(s),"onUpdate:modelValue":r[1]||=e=>h(s)?s.value=e:null,type:`password`,passwordToggle:!0,placeholder:`在此填入调用时使用的临时 Key`},null,8,[`modelValue`]),r[12]||=K(`p`,{class:`text-xs text-slate-500`},` 仅当前会话生效，发送消息时优先使用；保存在本地浏览器。 `,-1)]),K(`div`,Ve,[r[13]||=K(`label`,{class:`label-base`},`翻译模型`,-1),u(le,{modelValue:G(c),"onUpdate:modelValue":r[2]||=e=>h(c)?c.value=e:null,options:I.value,placeholder:`-- 请选择用于翻译的模型 --`},null,8,[`modelValue`,`options`]),r[14]||=K(`p`,{class:`text-xs text-slate-500`},` 选择用于翻译工具描述与参数提示的路由模型，优先使用启用中的 Provider。 `,-1)]),K(`div`,He,[r[18]||=K(`label`,{class:`label-base`},`自动翻译`,-1),K(`div`,Ue,[r[17]||=K(`div`,{class:`text-xs text-slate-500`},` 开启后，在打开工具或相关面板时自动请求翻译，关闭后需手动触发。 `,-1),K(`label`,We,[K(`div`,Ge,[B(K(`input`,{"onUpdate:modelValue":r[3]||=e=>h(f)?f.value=e:null,type:`checkbox`,class:`sr-only peer`},null,512),[[S,G(f)]]),r[15]||=K(`div`,{class:`w-12 h-6 rounded-full bg-slate-200 peer-checked:bg-primary/80 transition-colors`},null,-1),r[16]||=K(`div`,{class:`absolute left-1 top-1 w-4 h-4 rounded-full bg-white shadow-sm transition-all peer-checked:translate-x-6`},null,-1)])])])]),j(``,!0),e.healthStatus?(R(),k(`div`,{key:1,class:A([`p-3 rounded-lg text-sm flex items-start gap-2 border`,e.healthStatus.ok?`bg-green-50 border-green-200 text-green-700`:`bg-red-50 border-red-200 text-red-700`])},[e.healthStatus.ok?(R(),_(G(F),{key:0,class:`w-4 h-4 mt-0.5 shrink-0`})):(R(),_(G(U),{key:1,class:`w-4 h-4 mt-0.5 shrink-0`})),K(`div`,null,[r[25]||=K(`p`,{class:`font-bold text-xs uppercase mb-0.5`},`健康检查`,-1),K(`p`,Ke,C(e.healthStatus.msg),1)])],2)):j(``,!0)]),K(`div`,qe,[K(`button`,{class:`btn-secondary text-xs`,onClick:r[6]||=e=>i(`check`)},[...r[26]||=[K(`svg`,{xmlns:`http://www.w3.org/2000/svg`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,"stroke-width":`2`,"stroke-linecap":`round`,"stroke-linejoin":`round`,class:`w-4 h-4`},[K(`path`,{d:`M22 12h-4l-3 9L9 3l-3 9H2`})],-1),w(` 测试连接 `,-1)]]),K(`div`,Je,[K(`button`,{class:`btn-secondary`,onClick:r[7]||=e=>a.value=!1,disabled:P.value},` 取消 `,8,Ye),K(`button`,{class:`btn-primary`,onClick:L,disabled:P.value},[u(G(t),{class:`w-4 h-4`}),w(` `+C(P.value?`保存中...`:`保存设置`),1)],8,Xe)])])])])):j(``,!0)]),_:1}))}}),Qe={key:0,class:`fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4`},$e={class:`bg-white rounded-xl shadow-2xl w-full max-w-7xl flex flex-col h-[85vh] overflow-hidden animate-in fade-in zoom-in duration-200`},et={class:`px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50`},tt={class:`font-bold text-lg text-slate-800 flex items-center gap-3`},nt={class:`flex-1 overflow-hidden bg-slate-50`},rt={class:`px-6 py-4 border-t border-slate-100 bg-slate-50 flex justify-between items-center gap-4`},it={key:0,class:`text-sm text-red-600 truncate`},at={key:1,class:`text-xs text-slate-500`},ot={class:`flex gap-2`},st=[`disabled`],ct=[`disabled`],lt=`编辑配置 JSON`,ut=`编辑完整的配置 JSON，保存后将立即重启服务。`,dt=`保存重启`,ft=L({__name:`JSONEditorModal`,props:{show:{type:Boolean},jsonValue:{},error:{},isSaving:{type:Boolean},title:{},description:{},saveButtonText:{}},emits:[`update:show`,`update:jsonValue`,`save`],setup(e,{emit:t}){let n=e,r=t,a=Q(n,`show`,r),o=Q(n,`jsonValue`,r);return(t,n)=>(R(),_(b,{name:`fade`},{default:d(()=>[G(a)?(R(),k(`div`,Qe,[K(`div`,$e,[K(`div`,et,[K(`h3`,tt,[u(G(i),{class:`w-7 h-7`}),K(`span`,null,C(e.title||lt),1)]),K(`button`,{class:`btn-icon`,onClick:n[0]||=e=>a.value=!1},[u(G(q),{class:`w-5 h-5`})])]),K(`div`,nt,[u(de,{modelValue:G(o),"onUpdate:modelValue":n[1]||=e=>h(o)?o.value=e:null,language:`json`,theme:`vs`,class:`w-full h-full`},null,8,[`modelValue`])]),K(`div`,rt,[e.error?(R(),k(`span`,it,C(e.error),1)):(R(),k(`span`,at,C(e.description||ut),1)),K(`div`,ot,[K(`button`,{class:`btn-secondary`,disabled:e.isSaving,onClick:n[2]||=e=>a.value=!1},` 取消 `,8,st),K(`button`,{class:`btn-primary`,disabled:e.isSaving,onClick:n[3]||=e=>r(`save`)},[u(G(c),{class:A([`w-4 h-4`,{"animate-spin":e.isSaving}])},null,8,[`class`]),w(` `+C(e.isSaving?`保存中...`:e.saveButtonText||dt),1)],8,ct)])])])])):j(``,!0)]),_:1}))}}),pt={class:`relative`},mt={class:`truncate max-w-[140px]`},ht=[`onClick`],gt={class:`relative flex-1 min-w-[120px]`},_t=[`placeholder`,`onKeydown`],vt=[`title`],yt={class:`flex items-center justify-between px-3 py-2 border-b border-slate-100 text-xs text-slate-500 bg-slate-50`},bt={key:0,class:`text-red-500`},xt={key:1,class:`text-slate-400`},St={key:0},Ct={class:`divide-y divide-slate-100`},wt=[`onMousedown`],Tt={class:`truncate font-mono text-xs`},Et={key:1,class:`px-3 py-3 text-sm text-slate-500`},Dt={key:3,class:`px-3 py-3 text-sm text-slate-400`},Ot=L({__name:`ModelListSelector`,props:{modelValue:{},baseUrl:{},apiKey:{},placeholder:{}},emits:[`update:modelValue`,`change`],setup(e,{emit:t}){let n=e,r=t,i=D(``),a=D([]),o=D(!1),s=D(!1),c=D(``),l=D(null),u=D(null),d=D(null),f=D({left:0,top:0,bottom:0,width:0,height:0}),m=v(()=>{let e=(n.baseUrl||``).trim();return e?(e=e.replace(/\/$/,``),e=e.replace(/\/v1\/chat\/completions$/i,``),e):``}),h=v(()=>Array.from(new Set([...a.value||[],...n.modelValue||[]]))),y=v(()=>{let e=i.value.toLowerCase();return h.value.filter(t=>!e||t.toLowerCase().includes(e))}),b=v(()=>({position:`absolute`,left:`${f.value.left}px`,top:`${f.value.bottom+6}px`,width:`${f.value.width||260}px`,zIndex:9999})),x=()=>{let e=l.value?.getBoundingClientRect();e&&(f.value={left:e.left,top:e.top,bottom:e.bottom,width:e.width,height:e.height})},S=()=>{requestAnimationFrame(()=>{d.value?.focus()})},w=e=>{let t=e.target;!l.value?.contains(t)&&!u.value?.contains(t)&&(o.value=!1)},N=e=>{e.key===`Escape`&&(o.value=!1)};function P(){d.value?.focus(),F()}function F(){o.value=!0,H(()=>{x()})}function L(e){let t=(e||``).trim();if(!t)return;let a=(n.modelValue||[]).includes(t)?(n.modelValue||[]).filter(e=>e!==t):Array.from(new Set([...n.modelValue||[],t]));r(`update:modelValue`,a),r(`change`,a),i.value=``}function z(e){let t=(n.modelValue||[]).filter(t=>t!==e);r(`update:modelValue`,t),r(`change`,t)}function V(){L(i.value)}async function U(){if(!m.value){c.value=`请先填写 Base URL`,o.value=!0;return}if(!n.apiKey?.trim()){c.value=`请先填写 API Key`,o.value=!0;return}s.value=!0,c.value=``;try{let e=await fetch(`${m.value}/v1/models`,{headers:{"Content-Type":`application/json`,Authorization:`Bearer ${n.apiKey.trim()}`}}),t=await e.json();if(!e.ok)throw Error(t?.error||t?.message||`HTTP ${e.status}`);let r=(Array.isArray(t?.data)?t.data:Array.isArray(t?.models)?t.models:[]).map(e=>{if(typeof e==`string`)return e;if(e&&typeof e==`object`){let t=e;return t.id||t.name||t.model}return``}).filter(Boolean);a.value=Array.from(new Set(r)),o.value=!0}catch(e){c.value=e.message||`获取模型失败`}finally{s.value=!1}}return W(()=>{window.addEventListener(`resize`,x),window.addEventListener(`scroll`,x,!0),document.addEventListener(`mousedown`,w,!0),document.addEventListener(`keydown`,N),H(x)}),I(()=>{window.removeEventListener(`resize`,x),window.removeEventListener(`scroll`,x,!0),document.removeEventListener(`mousedown`,w,!0),document.removeEventListener(`keydown`,N)}),p(()=>[n.baseUrl,n.apiKey],()=>{a.value=[],c.value=``}),p(o,e=>{e&&H(()=>{x(),S()})}),(t,n)=>(R(),k(`div`,pt,[K(`div`,{ref_key:`triggerRef`,ref:l,class:`input-base flex items-center flex-wrap gap-2 min-h-[48px] cursor-text relative pr-10`,onClick:P},[(R(!0),k(O,null,J(e.modelValue,e=>(R(),k(`span`,{key:e,class:`inline-flex items-center gap-1 bg-slate-100 hover:bg-slate-200 text-slate-700 px-2 py-1 rounded text-xs transition-colors`},[K(`span`,mt,C(e),1),K(`button`,{type:`button`,class:`text-slate-400 hover:text-red-500 transition-colors`,onClick:X(t=>z(e),[`stop`])},` ✕ `,8,ht)]))),128)),K(`div`,gt,[B(K(`input`,{ref_key:`inputEl`,ref:d,"onUpdate:modelValue":n[0]||=e=>i.value=e,class:`w-full border-none focus:ring-0 outline-none text-sm bg-transparent text-slate-700`,placeholder:e.placeholder||`输入或选择模型，回车添加`,onKeydown:T(X(V,[`prevent`]),[`enter`]),onInput:F},null,40,_t),[[g,i.value]])]),K(`button`,{type:`button`,class:`absolute right-0 bottom-0 border border-t border-l rounded-tl-md h-7 w-7 flex items-center justify-center text-primary hover:bg-gray-100 transition-colors`,onClick:X(U,[`stop`]),title:s.value?`正在刷新模型`:`刷新模型`},[K(`span`,{class:A(s.value?`animate-spin`:``)},`⟳`,2)],8,vt)],512),(R(),_(E,{to:`body`},[o.value?(R(),k(`div`,{key:0,ref_key:`dropdownRef`,ref:u,style:M(b.value),class:`p-0 bg-white border border-slate-200 rounded-xl shadow-lg max-h-72 overflow-auto`},[K(`div`,yt,[K(`span`,null,C(y.value.length)+` 个可用模型`,1),c.value?(R(),k(`span`,bt,C(c.value),1)):s.value?(R(),k(`span`,xt,`加载中...`)):j(``,!0)]),y.value.length?(R(),k(`div`,St,[n[2]||=K(`div`,{class:`px-3 py-2 text-[11px] font-semibold text-slate-400 uppercase`},` 可用模型 `,-1),K(`div`,Ct,[(R(!0),k(O,null,J(y.value,t=>(R(),k(`div`,{key:t,class:`px-3 py-2 text-sm text-slate-700 hover:bg-primary-50 cursor-pointer flex items-center justify-between hover:bg-gray-100`,onMousedown:X(e=>L(t),[`prevent`])},[K(`span`,Tt,C(t),1),e.modelValue.includes(t)?(R(),_(G(te),{key:0,class:`w-4 h-4 text-primary-600`})):j(``,!0)],40,wt))),128))])])):i.value&&!s.value?(R(),k(`div`,Et,` 无匹配结果，按回车或点击下方添加自定义模型。 `)):j(``,!0),i.value&&!s.value&&!y.value.includes(i.value)?(R(),k(`div`,{key:2,class:`px-3 py-3 text-sm text-primary-600 hover:bg-primary-50 cursor-pointer border-t border-slate-100 flex items-center gap-2`,onMousedown:n[1]||=X(e=>L(i.value),[`prevent`])},[K(`span`,null,`使用自定义模型 "`+C(i.value)+`"`,1)],32)):j(``,!0),!s.value&&!y.value.length&&!i.value?(R(),k(`div`,Dt,` 暂无模型，请点击“刷新模型”获取。 `)):j(``,!0)],4)):j(``,!0)]))]))}}),kt={class:`flex items-center flex-1 min-w-0`},At={class:`truncate font-mono text-slate-600`},jt={class:`flex items-center gap-2 ml-2 shrink-0`},Mt=[`title`],Nt={key:0,class:`text-xs truncate max-w-[200px]`},Pt={class:`flex items-center gap-1`},Ft=[`disabled`,`title`],It=L({__name:`ApiKeyItem`,props:{apiKey:{},baseUrl:{},models:{},providerName:{},disabled:{type:Boolean,default:!1}},emits:[`remove`,`test-complete`],setup(e,{expose:t,emit:n}){let r=e,i=n,{sendMessage:a,tempApiKey:o}=Z(),l=D(null),d=v(()=>l.value?.status===`loading`);async function f(){if(r.apiKey?.trim()){if(!r.providerName?.trim()){l.value={status:`error`,message:`请先填写 Provider 名称`},i(`test-complete`,l.value);return}if(!r.baseUrl?.trim()){l.value={status:`error`,message:`请先填写基础地址`},i(`test-complete`,l.value);return}if(r.models.length===0){l.value={status:`error`,message:`请先添加至少一个模型`},i(`test-complete`,l.value);return}l.value={status:`loading`};try{let e=r.models[0];if(!e){l.value={status:`error`,message:`请先添加至少一个模型`},i(`test-complete`,l.value);return}await a([{role:`user`,content:`测试对话，你只需要返回数字 1`}],`${r.providerName.trim()},${e}`,o.value||void 0,r.apiKey?.trim()||void 0),l.value={status:`success`,message:`测试成功`},i(`test-complete`,l.value),setTimeout(()=>{l.value?.status===`success`&&(l.value=null)},3e3)}catch(e){l.value={status:`error`,message:e instanceof Error?e.message:`测试失败，请检查密钥和配置`},i(`test-complete`,l.value)}}}let p=v(()=>{if(!l.value)return null;switch(l.value.status){case`loading`:return c;case`success`:return F;case`error`:return U;default:return null}}),m=v(()=>{if(!l.value)return``;switch(l.value.status){case`loading`:return`text-blue-500`;case`success`:return`text-green-500`;case`error`:return`text-red-500`;default:return``}}),h=v(()=>{let e=`flex justify-between items-center bg-slate-50 px-2 py-1 rounded text-xs border border-slate-100 group`;return l.value?.status===`success`?`${e} border-green-200 bg-green-50/50`:l.value?.status===`error`?`${e} border-red-200 bg-red-50/50`:e});return t({testKey:f,testStatus:v(()=>l.value)}),(t,n)=>(R(),k(`div`,{class:A(h.value)},[K(`div`,kt,[K(`span`,At,C(e.apiKey),1)]),K(`div`,jt,[l.value&&!d.value?(R(),k(`div`,{key:0,class:A([`flex items-center gap-1 shrink-0`,m.value]),title:l.value.message},[(R(),_(P(p.value),{class:A([`w-3 h-3`,l.value.status===`loading`?`animate-spin`:``])},null,8,[`class`])),l.value.message?(R(),k(`span`,Nt,C(l.value.message),1)):j(``,!0)],10,Mt)):j(``,!0),K(`div`,Pt,[K(`button`,{class:`text-slate-400 hover:text-blue-500 transition-colors`,disabled:d.value||e.disabled,title:d.value?`测试中...`:`测试此密钥`,onClick:f},[d.value?(R(),_(G(c),{key:0,class:`w-3 h-3 animate-spin`})):(R(),_(G(s),{key:1,class:`w-3 h-3`}))],8,Ft),K(`button`,{class:`text-slate-400 hover:text-red-500 transition-colors`,onClick:n[0]||=e=>i(`remove`),title:`删除此密钥`},[u(G(q),{class:`w-3 h-3`})])])])],2))}}),Lt=L({__name:`Input`,props:{defaultValue:{},modelValue:{},class:{}},emits:[`update:modelValue`],setup(e,{emit:t}){let n=e,r=Q(n,`modelValue`,t,{passive:!0,defaultValue:n.defaultValue});return(e,t)=>B((R(),k(`input`,{"onUpdate:modelValue":t[0]||=e=>h(r)?r.value=e:null,"data-slot":`input`,class:A(G(ue)(`file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,`focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]`,`aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive`,n.class))},null,2)),[[g,G(r)]])}}),Rt=[{name:`openrouter`,api_base_url:`https://openrouter.ai/api/v1/chat/completions`,api_key:`sk-xxx`,models:[`google/gemini-2.5-pro-preview`,`anthropic/claude-sonnet-4`,`anthropic/claude-3.5-sonnet`,`anthropic/claude-3.7-sonnet:thinking`],transformer:{use:[`openrouter`]}},{name:`deepseek`,api_base_url:`https://api.deepseek.com/chat/completions`,api_key:`sk-xxx`,models:[`deepseek-chat`,`deepseek-reasoner`],transformer:{use:[`deepseek`],"deepseek-chat":{use:[`tooluse`]}}},{name:`ollama`,api_base_url:`http://localhost:11434/v1/chat/completions`,api_key:`ollama`,models:[`qwen2.5-coder:latest`]},{name:`gemini`,api_base_url:`https://generativelanguage.googleapis.com/v1beta/models/`,api_key:`sk-xxx`,models:[`gemini-2.5-flash`,`gemini-2.5-pro`],transformer:{use:[`gemini`]}},{name:`volcengine`,api_base_url:`https://ark.cn-beijing.volces.com/api/v3/chat/completions`,api_key:`sk-xxx`,models:[`deepseek-v3-250324`,`deepseek-r1-250528`],transformer:{use:[`deepseek`]}},{name:`modelscope`,api_base_url:`https://api-inference.modelscope.cn/v1/chat/completions`,api_key:``,models:[`Qwen/Qwen3-Coder-480B-A35B-Instruct`,`Qwen/Qwen3-235B-A22B-Thinking-2507`],transformer:{use:[[`maxtoken`,{max_tokens:65536}],`enhancetool`],"Qwen/Qwen3-235B-A22B-Thinking-2507":{use:[`reasoning`]}}},{name:`dashscope`,api_base_url:`https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions`,api_key:``,models:[`qwen3-coder-plus`],transformer:{use:[[`maxtoken`,{max_tokens:65536}],`enhancetool`]}},{name:`aihubmix`,api_base_url:`https://aihubmix.com/v1/chat/completions`,api_key:`sk-`,models:[`Z/glm-4.5`,`claude-opus-4-20250514`,`gemini-2.5-pro`]}],zt={class:`flex items-center gap-2`},Bt={class:`w-40`},Vt={class:`p-2 border-b`},Ht={class:`max-h-[200px] overflow-y-auto`},Ut={key:0,class:`px-2 py-1.5 text-xs text-slate-400 text-center`},Wt=L({__name:`TemplateSelector`,props:{disabled:{type:Boolean}},emits:[`apply`],setup(e,{emit:t}){let n=t,r=D(Rt),i=D(void 0),a=D(``),o=v(()=>{if(!a.value.trim())return r.value;let e=a.value.trim().toLowerCase();return r.value.filter(t=>t.name.toLowerCase().includes(e))});return p(i,e=>{if(!e)return;let t=r.value.find(t=>t.name===e);t&&(n(`apply`,t),setTimeout(()=>{i.value=void 0,a.value=``},100))}),(t,n)=>(R(),k(`div`,zt,[n[3]||=K(`span`,{class:`text-xs text-slate-500 whitespace-nowrap`},`模板：`,-1),K(`div`,Bt,[u(G(ne),{modelValue:i.value,"onUpdate:modelValue":n[2]||=e=>i.value=e,disabled:e.disabled},{default:d(()=>[u(G(ie),{size:`sm`,class:`h-6 text-xs px-2 w-full`},{default:d(()=>[u(G(oe),{placeholder:`选择模板`})]),_:1}),u(G(re),{class:`min-w-[240px]`},{default:d(()=>[K(`div`,Vt,[u(G(Lt),{modelValue:a.value,"onUpdate:modelValue":n[0]||=e=>a.value=e,placeholder:`搜索模板...`,class:`h-7 text-xs`,onClick:n[1]||=X(()=>{},[`stop`])},null,8,[`modelValue`])]),K(`div`,Ht,[(R(!0),k(O,null,J(o.value,e=>(R(),_(G(ae),{key:e.name,value:e.name},{default:d(()=>[w(C(e.name),1)]),_:2},1032,[`value`]))),128)),o.value.length===0?(R(),k(`div`,Ut,` 无匹配结果 `)):j(``,!0)])]),_:1})]),_:1},8,[`modelValue`,`disabled`])])]))}}),Gt={key:0,class:`fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4`},Kt={class:`bg-white rounded-xl shadow-2xl w-full max-w-3xl flex flex-col h-[85vh] overflow-hidden animate-in fade-in zoom-in duration-200`},qt={class:`px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50`},Jt={class:`flex items-center gap-3`},Yt={class:`font-bold text-lg text-slate-800`},Xt={class:`bg-slate-100 p-1 rounded-lg flex text-xs font-medium`},Zt={class:`flex-1 overflow-hidden relative bg-slate-50`},Qt={class:`h-full overflow-y-auto p-6 space-y-5`},$t={class:`grid grid-cols-2 gap-5`},en={class:`col-span-2 sm:col-span-1`},tn={class:`col-span-2 sm:col-span-1`},nn={class:`flex gap-2 mb-2`},rn=[`disabled`,`title`],an={class:`bg-white border border-slate-200 rounded-md p-2 space-y-1 max-h-32 overflow-y-auto`},on={key:0,class:`text-center text-xs text-slate-400 py-2`},sn={class:`h-full flex flex-col`},cn={class:`px-6 py-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-3`},ln=L({__name:`ProviderEditorModal`,props:{show:{type:Boolean},isEditing:{type:Boolean},editorTab:{},form:{},newArrayKey:{},jsonPreview:{}},emits:[`update:show`,`update:editorTab`,`update:form`,`update:newArrayKey`,`update:jsonPreview`,`addKey`,`removeKey`,`save`,`close`],setup(n,{emit:r}){let i=n,a=r,o=Q(i,`show`,a),l=Q(i,`editorTab`,a),f=Q(i,`form`,a,{deep:!0}),m=Q(i,`newArrayKey`,a),g=Q(i,`jsonPreview`,a),x=D([]),S=D(!1),E=ce(),{pushToast:M}=Y(),N=D(``),{fetchTransformers:P}=Z(),F=D([]),I=D(!1),L=v(()=>(f.value.apiKeys||[]).find(e=>e?.trim())?.trim()||``);p(o,e=>{if(!e)S.value=!1;else try{let e=E.providerFromForm();N.value=JSON.stringify(e)}catch{N.value=``}}),W(()=>{o.value});async function z(){if((f.value.apiKeys||[]).length===0||!f.value.baseUrl?.trim()||f.value.models.length===0)return;try{let e=E.providerFromForm(),t=JSON.stringify(e);if(N.value!==t){if(!e.name||!e.baseUrl||(e.models||[]).length===0){M(`请完善 Provider 信息`,`error`);return}await E.saveProvider(e,i.isEditing),i.isEditing||(E.isEditing=!0),N.value=t,M(`保存成功，开始测试密钥...`,`success`)}}catch(e){M(e.message,`error`);return}S.value=!0;let e=x.value.filter(e=>e!==null).map(e=>e.testKey());await Promise.all(e),S.value=!1}function V(e){if(e){if(!i.isEditing&&e.name&&(f.value.name=e.name),e.api_base_url&&(f.value.baseUrl=e.api_base_url),e.api_key&&(f.value.apiKeys.length===0?f.value.apiKeys=[e.api_key]:f.value.apiKeys.includes(e.api_key)||f.value.apiKeys.push(e.api_key)),Array.isArray(e.models)&&e.models.length>0){let t=new Set(f.value.models);e.models.forEach(e=>{t.has(e)||f.value.models.push(e)})}e.transformer&&(f.value.transformer=e.transformer)}}return(r,i)=>(R(),_(b,{name:`fade`},{default:d(()=>[G(o)?(R(),k(`div`,Gt,[K(`div`,Kt,[K(`div`,qt,[K(`div`,Jt,[K(`h3`,Yt,C(n.isEditing?`编辑 Provider`:`新增 Provider`),1),n.isEditing?j(``,!0):(R(),_(Wt,{key:0,disabled:n.isEditing,onApply:V},null,8,[`disabled`]))]),K(`div`,Xt,[K(`button`,{class:A([`px-3 py-1 rounded transition-all`,G(l)===`form`?`bg-white shadow text-primary-600`:`text-slate-500 hover:text-slate-700`]),onClick:i[0]||=e=>l.value=`form`},` 表单配置 `,2),K(`button`,{class:A([`px-3 py-1 rounded transition-all`,G(l)===`json`?`bg-white shadow text-primary-600`:`text-slate-500 hover:text-slate-700`]),onClick:i[1]||=e=>l.value=`json`},` JSON 源码 `,2)])]),K(`div`,Zt,[B(K(`div`,Qt,[K(`div`,$t,[K(`div`,en,[i[13]||=K(`label`,{class:`label-base`},[w(`名称 (ID) `),K(`span`,{class:`text-red-500`},`*`)],-1),u($,{modelValue:G(f).name,"onUpdate:modelValue":i[2]||=e=>G(f).name=e,type:`text`,disabled:n.isEditing,placeholder:`例如: openai`},null,8,[`modelValue`,`disabled`])]),K(`div`,tn,[i[14]||=K(`label`,{class:`label-base`},`速率限制`,-1),u($,{"model-value":G(f).limit.toString(),"onUpdate:modelValue":i[3]||=e=>G(f).limit=Number(e)||0,type:`number`,placeholder:`0 (无限制)`},null,8,[`model-value`])])]),K(`div`,null,[i[15]||=K(`label`,{class:`label-base`},[w(`基础地址 `),K(`span`,{class:`text-red-500`},`*`)],-1),u($,{modelValue:G(f).baseUrl,"onUpdate:modelValue":i[4]||=e=>G(f).baseUrl=e,type:`text`,placeholder:`https://api.example.com`},null,8,[`modelValue`])]),K(`div`,null,[i[16]||=K(`label`,{class:`label-base`},[w(`API 密钥 `),K(`span`,{class:`text-red-500`},`*`)],-1),K(`div`,nn,[u($,{modelValue:G(m),"onUpdate:modelValue":i[5]||=e=>h(m)?m.value=e:null,type:`text`,placeholder:`添加 Key（可多个，至少 1 个）...`,class:`text-xs flex-1`,onKeydown:i[6]||=T(X(e=>a(`addKey`),[`prevent`]),[`enter`])},null,8,[`modelValue`]),K(`button`,{class:`btn-secondary px-3`,onClick:i[7]||=e=>a(`addKey`)},[u(G(e),{class:`w-4 h-4`})]),K(`button`,{class:`btn-secondary px-3`,disabled:G(f).apiKeys.length===0||S.value,onClick:z,title:S.value?`正在批量测试...`:`批量测试所有密钥`},[S.value?(R(),_(G(c),{key:0,class:`w-4 h-4 animate-spin`})):(R(),_(G(s),{key:1,class:`w-4 h-4`}))],8,rn)]),K(`div`,an,[(R(!0),k(O,null,J(G(f).apiKeys,(e,t)=>(R(),_(It,{key:t+e,ref_for:!0,ref:e=>{e?x.value[t]=e:x.value[t]=null},"api-key":e,"base-url":G(f).baseUrl,models:G(f).models,"provider-name":G(f).name||``,disabled:S.value,onRemove:e=>a(`removeKey`,t)},null,8,[`api-key`,`base-url`,`models`,`provider-name`,`disabled`,`onRemove`]))),128)),G(f).apiKeys.length===0?(R(),k(`div`,on,` 暂无 Key，请先添加 `)):j(``,!0)])]),K(`div`,null,[i[17]||=K(`label`,{class:`label-base`},[w(`模型列表 `),K(`span`,{class:`text-red-500`},`*`)],-1),u(Ot,{modelValue:G(f).models,"onUpdate:modelValue":i[8]||=e=>G(f).models=e,"base-url":G(f).baseUrl,"api-key":L.value,placeholder:`输入或选择模型，回车添加`},null,8,[`modelValue`,`base-url`,`api-key`]),i[18]||=K(`p`,{class:`text-xs text-slate-500 mt-2`},` 支持从接口拉取模型，也可直接输入后回车添加，自动去重。 `,-1)]),K(`div`,null,[i[19]||=K(`label`,{class:`label-base`},`Transformer 转换器`,-1),u(se,{modelValue:G(f).transformer,"onUpdate:modelValue":i[9]||=e=>G(f).transformer=e,options:F.value,models:G(f).models,loading:I.value,disabled:I.value,placeholder:`选择或输入 Transformer`},null,8,[`modelValue`,`options`,`models`,`loading`,`disabled`]),i[20]||=K(`p`,{class:`text-xs text-slate-500 mt-2`},` 配置全局和模型特定的请求/响应转换器（可选）。 `,-1)])],512),[[y,G(l)===`form`]]),B(K(`div`,sn,[u(de,{modelValue:G(g),"onUpdate:modelValue":i[10]||=e=>h(g)?g.value=e:null,language:`json`,theme:`vs`,class:`flex-1 w-full h-full`},null,8,[`modelValue`])],512),[[y,G(l)===`json`]])]),K(`div`,cn,[K(`button`,{class:`btn-secondary`,onClick:i[11]||=e=>a(`close`)},`取消`),K(`button`,{class:`btn-primary`,onClick:i[12]||=e=>a(`save`)},[u(G(t),{class:`w-4 h-4`}),i[21]||=w(` 保存配置 `,-1)])])])])):j(``,!0)]),_:1}))}}),un={key:0,class:`fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4`},dn={class:`bg-white rounded-xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col animate-in fade-in zoom-in duration-200`},fn={class:`px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50`},pn={class:`font-bold text-slate-800 flex items-center gap-2`},mn={class:`flex-1 overflow-y-auto p-6 space-y-5`},hn={class:`space-y-2`},gn={class:`label-base flex items-center gap-1`},_n={class:`space-y-2`},vn={class:`label-base flex items-center gap-1`},yn={class:`space-y-2`},bn={class:`relative`},xn={class:`space-y-2`},Sn={class:`relative`},Cn={class:`space-y-2`},wn={class:`flex items-center gap-3`},Tn={class:`flex-[3] space-y-2`},En={class:`label-base flex items-center gap-1`},Dn={class:`flex-[2] space-y-2`},On={class:`label-base flex items-center gap-1`},kn={class:`w-fit flex items-center gap-1 bg-slate-100 p-1 rounded-lg`},An={class:`px-6 py-4 border-t border-slate-100 bg-slate-50 flex justify-end items-center gap-3`},jn=L({__name:`ClaudeSettingsModal`,props:{show:{type:Boolean},timeoutMs:{},baseUrl:{},apiKey:{},claudePath:{},workDir:{},terminalType:{default:`powershell`},enableFileButtons:{type:Boolean,default:!1}},emits:[`update:show`,`update:timeoutMs`,`update:baseUrl`,`update:apiKey`,`update:claudePath`,`update:workDir`,`update:terminalType`,`confirm`],setup(e,{emit:n}){let r=e,i=n,a=Q(r,`show`,i),o=Q(r,`timeoutMs`,i),s=Q(r,`baseUrl`,i),c=Q(r,`apiKey`,i),l=Q(r,`claudePath`,i),f=Q(r,`workDir`,i),p=Q(r,`terminalType`,i),m=D(null),v=D(null);function y(){if(console.log(`[ClaudeSettingsModal] pickClaudePath button click`),!m.value){console.warn(`[ClaudeSettingsModal] claudePathInputRef is null, input 未挂载`);return}m.value.click()}function x(){if(console.log(`[ClaudeSettingsModal] pickWorkDir button click`),!v.value){console.warn(`[ClaudeSettingsModal] workDirInputRef is null, input 未挂载`);return}v.value.click()}function S(e){let t=e.target.files?.[0];console.log(`[ClaudeSettingsModal] handleClaudePathChange fired, file:`,t),t&&(l.value=t.name)}function C(e){let t=e.target.files?.[0];console.log(`[ClaudeSettingsModal] handleWorkDirChange fired, file:`,t),t&&(f.value=t.webkitRelativePath||t.name)}return(e,n)=>(R(),_(b,{name:`fade`},{default:d(()=>[G(a)?(R(),k(`div`,un,[K(`div`,dn,[K(`div`,fn,[K(`h3`,pn,[u(je,{class:`w-7 h-7 rounded-md overflow-hidden`}),n[10]||=K(`span`,{class:`text-lg`},`Claude 启动配置`,-1)]),K(`button`,{class:`btn-icon`,onClick:n[0]||=e=>a.value=!1},[u(G(q),{class:`w-5 h-5`})])]),K(`div`,mn,[K(`div`,hn,[K(`label`,gn,[u(G(ye),{class:`w-4 h-4`}),n[11]||=K(`span`,null,`基础 URL`,-1)]),u($,{modelValue:G(s),"onUpdate:modelValue":n[1]||=e=>h(s)?s.value=e:null,placeholder:`http://127.0.0.1:3457/`},null,8,[`modelValue`]),n[12]||=K(`p`,{class:`text-xs text-slate-400`},`本地路由/转发服务的基础地址。`,-1)]),K(`div`,_n,[K(`label`,vn,[u(G(De),{class:`w-4 h-4`}),n[13]||=K(`span`,null,`API Key`,-1)]),u($,{modelValue:G(c),"onUpdate:modelValue":n[2]||=e=>h(c)?c.value=e:null,type:`password`,passwordToggle:!0,placeholder:`sk-...`},null,8,[`modelValue`]),n[14]||=K(`p`,{class:`text-xs text-slate-400`},`用于访问 Anthropic / Claude 的 API Key。`,-1)]),K(`div`,yn,[n[15]||=K(`label`,{class:`label-base`},`Claude Path（指令 / 可执行文件路径）`,-1),K(`div`,bn,[u($,{modelValue:G(l),"onUpdate:modelValue":n[3]||=e=>h(l)?l.value=e:null,placeholder:`例如：claude 或 D:\\Tools\\claude\\claude.exe`,class:A(r.enableFileButtons?`pr-10`:``)},null,8,[`modelValue`,`class`]),r.enableFileButtons?(R(),k(O,{key:0},[K(`input`,{ref_key:`claudePathInputRef`,ref:m,type:`file`,class:`hidden`,onChange:S},null,544),K(`button`,{class:`absolute inset-y-0 right-0 px-2 flex items-center text-slate-400 hover:text-primary transition-colors`,type:`button`,onClick:y},[u(G(he),{class:`w-4 h-4`})])],64)):j(``,!0)]),n[16]||=K(`p`,{class:`text-xs text-slate-400`},` 支持直接输入命令或选择可执行文件；具体执行逻辑需在桌面端脚本中实现。 `,-1)]),K(`div`,xn,[n[17]||=K(`label`,{class:`label-base`},`工作地址（工作目录）`,-1),K(`div`,Sn,[u($,{modelValue:G(f),"onUpdate:modelValue":n[4]||=e=>h(f)?f.value=e:null,placeholder:`例如：G:\\ClaudeCode`,class:A(r.enableFileButtons?`pr-10`:``)},null,8,[`modelValue`,`class`]),r.enableFileButtons?(R(),k(O,{key:0},[K(`input`,{ref_key:`workDirInputRef`,ref:v,type:`file`,webkitdirectory:``,class:`hidden`,onChange:C},null,544),K(`button`,{class:`absolute inset-y-0 right-0 px-2 flex items-center text-slate-400 hover:text-primary transition-colors`,type:`button`,onClick:x},[u(G(he),{class:`w-4 h-4`})])],64)):j(``,!0)]),n[18]||=K(`p`,{class:`text-xs text-slate-400`},` Claude 运行时的工作目录；路径选择在浏览器中仅作为占位展示，实际逻辑可由本地脚本处理。 `,-1)]),K(`div`,Cn,[K(`div`,wn,[K(`div`,Tn,[K(`label`,En,[u(G(Te),{class:`w-4 h-4`}),n[19]||=K(`span`,null,`超时时间 (ms)`,-1)]),B(K(`input`,{"onUpdate:modelValue":n[5]||=e=>h(o)?o.value=e:null,type:`number`,class:`input-base w-full`,placeholder:`例如：300000`,min:`0`},null,512),[[g,G(o)]])]),K(`div`,Dn,[K(`label`,On,[u(G(Ce),{class:`w-4 h-4`}),n[20]||=K(`span`,null,`启动终端`,-1)]),K(`div`,kn,[K(`button`,{type:`button`,class:A([`px-3 py-1.5 rounded-md text-sm font-medium transition-all flex items-center gap-1.5 border border-transparent`,G(p)===`powershell`?`bg-white text-primary shadow-sm border border-primary/20`:`text-slate-500 hover:text-slate-700`]),onClick:n[6]||=e=>p.value=`powershell`},[u(G(Ce),{class:`w-4 h-4`}),n[21]||=K(`span`,null,`PowerShell`,-1)],2),K(`button`,{type:`button`,class:A([`px-3 py-1.5 rounded-md text-sm font-medium transition-all flex items-center gap-1.5 border border-transparent`,G(p)===`cmd`?`bg-white text-primary shadow-sm border border-primary/20`:`text-slate-500 hover:text-slate-700`]),onClick:n[7]||=e=>p.value=`cmd`},[u(G(Ce),{class:`w-4 h-4`}),n[22]||=K(`span`,null,`CMD`,-1)],2)])])]),n[23]||=K(`p`,{class:`text-xs text-slate-400`},` 请求 Claude 的超时时间，单位毫秒。右侧可选择启动终端类型。 `,-1)])]),K(`div`,An,[K(`button`,{class:`btn-secondary`,onClick:n[8]||=e=>a.value=!1},`取消`),K(`button`,{class:`btn-primary flex items-center gap-2`,onClick:n[9]||=()=>{i(`confirm`)}},[u(G(t),{class:`w-4 h-4`}),n[24]||=w(` 执行 `,-1)])])])])):j(``,!0)]),_:1}))}}),Mn={class:`w-full h-full bg-slate-50 text-slate-800 overflow-hidden flex flex-col relative`},Nn={class:`bg-white border-b border-slate-200 h-16 flex items-center justify-between px-6 shrink-0 shadow-sm z-20`},Pn={class:`flex items-center gap-8`},Fn={class:`flex items-center gap-2 text-primary`},In={class:`flex items-center gap-1 bg-slate-100 p-1 rounded-lg scale-90`},Ln={class:`flex items-center gap-3`},Rn=[`disabled`],zn={key:0,class:`text-amber-700 text-xs bg-amber-100 px-1.5 py-0.5 rounded-full`},Bn={class:`flex-1 h-full overflow-hidden relative bg-slate-50`},Vn={key:0,class:`absolute inset-0 bg-white/80 backdrop-blur-sm flex flex-col items-center justify-center gap-4 z-50`},Hn=L({__name:`LlmDashboard`,setup(e){let t=f(),s=V(),{pushToast:c}=Y(),h=ce(),g=v(()=>{let e=s.name;return e===`Chat`?`chat`:e===`Providers`?`providers`:e===`Logger`?`logger`:e===`StatusLine`?`statusline`:e===`MCP`?`mcp`:`chat`}),y={chat:`/chat`,providers:`/providers`,logger:`/logger`,statusline:`/statusline`,mcp:`/mcp`};function b(e){let n=y[e];n&&t.push(n)}async function S(e,t=`form`){h.openEditor(e,t)}function T(){h.closeEditor()}async function E(){try{let e=h.providerFromForm();if(!e.name||!e.baseUrl||(e.models||[]).length===0){c(`请完善 Provider 信息`,`error`);return}await h.saveProvider(e,h.isEditing),c(`保存成功`,`success`),h.closeEditor()}catch(e){c(e.message,`error`)}}async function D(e){try{c(`Provider 已${await h.toggleProvider(e)?`启用`:`禁用`}`,`info`)}catch(e){c(e.message,`error`)}}async function M(e){try{await h.deleteProvider(e.name),c(`删除成功`,`success`)}catch(e){c(e.message,`error`)}}async function F(e){try{await h.reorderProviders(e),c(`排序已保存`,`success`)}catch(e){c(`保存排序失败: ${e.message}`,`error`)}}async function I(){try{let e=await h.fetchConfig(),t=e.Providers||e.providers||[];h.providersJson=JSON.stringify(t,null,2),h.providersJsonError=``,h.showProvidersJsonModal=!0}catch(e){c(`获取配置失败: ${e.message}`,`error`)}}function L(){h.showProvidersJsonModal=!1,h.isSavingProvidersJson=!1}async function z(){try{let e=await h.fetchConfig();h.configJson=JSON.stringify(e,null,2),h.configJsonError=``,h.showConfigJsonModal=!0}catch(e){c(`获取配置失败: ${e.message}`,`error`)}}function B(){h.showConfigJsonModal=!1,h.isSavingConfigJson=!1}async function H(){let e;try{let t=JSON.parse(h.providersJson||`[]`);if(!Array.isArray(t)){h.providersJsonError=`JSON 须为有效的数组`;return}e=t}catch(e){h.providersJsonError=`JSON 解析失败: ${e.message}`;return}try{h.isSavingProvidersJson=!0;let t={...await h.fetchConfig(),Providers:e},n=await h.saveConfig(t);h.providersJsonError=``,c(n.message||`配置已保存，正在重启服务...`,`success`),h.showProvidersJsonModal=!1;try{h.isRestarting=!0,await h.restartService(),c(`服务重启中...`,`info`)}catch(e){c(`重启失败: ${e.message}`,`error`),h.isRestarting=!1,h.isSavingProvidersJson=!1}}catch(e){h.providersJsonError=e.message,h.isSavingProvidersJson=!1}}async function U(){let e;try{e=JSON.parse(h.configJson||`{}`)}catch(e){h.configJsonError=`JSON 解析失败: ${e.message}`;return}if(!e||typeof e!=`object`){h.configJsonError=`JSON 须为有效的配置对象`;return}try{h.isSavingConfigJson=!0;let t=await h.saveConfig(e);h.configJsonError=``,c(t.message||`配置已保存，正在重启服务...`,`success`),h.showConfigJsonModal=!1;try{h.isRestarting=!0,await h.restartService(),c(`服务重启中...`,`info`)}catch(e){c(`重启失败: ${e.message}`,`error`),h.isRestarting=!1,h.isSavingConfigJson=!1}}catch(e){h.configJsonError=e.message,h.isSavingConfigJson=!1}}function q(){h.showSettingsModal=!0,h.checkHealth()}function J(){h.claudeBaseUrl=h.baseUrl,h.claudeApiKey=h.tempApiKey,h.showClaudeSettingsModal=!0}async function X(){h.persistSettings();try{await h.loadProviders(),c(`设置已保存`,`success`),h.showSettingsModal=!1}catch(e){c(e.message,`error`)}}async function Z(){h.showClaudeSettingsModal=!1;try{await h.startClaudeCli({timeoutMs:h.claudeTimeoutMs,baseUrl:h.claudeBaseUrl,apiKey:h.claudeApiKey,claudePath:h.claudePath,workDir:h.claudeWorkDir,terminalType:h.claudeTerminalType}),c(`已触发 Claude 启动：超时时间 ${h.claudeTimeoutMs} ms，基础 URL ${h.claudeBaseUrl}`,`success`)}catch(e){c(`启动 Claude 失败：${e.message}`,`error`)}}async function Q(){try{h.isRestarting=!0,await h.restartService(),c(`服务重启中...`,`info`)}catch(e){c(e.message,`error`),h.isRestarting=!1}}return p(()=>({...h.editForm}),()=>{h.editorTab===`json`&&(h.providersJson=JSON.stringify(h.providerFromForm(),null,2))},{deep:!0}),p(()=>s.name,e=>{(e===`Chat`||e===`Providers`)&&h.loadProviders().catch(e=>{c(e.message,`error`)})}),p(()=>h.showProvidersJsonModal,e=>{e||(h.isSavingProvidersJson=!1)}),p(()=>h.showConfigJsonModal,e=>{e||(h.isSavingConfigJson=!1)}),ee(window,`keydown`,e=>{e.key===`Escape`&&(h.showEditor&&h.closeEditor(),h.showProvidersJsonModal&&L(),h.showConfigJsonModal&&B(),h.showSettingsModal&&=!1,h.showClaudeSettingsModal&&=!1)}),N(`llmDashboardStore`,h),N(`llmDashboardActions`,{openEditor:S,handleToggleProvider:D,handleDeleteProvider:M,handleReorderProviders:F,openProvidersJsonEditor:I}),W(()=>{h.loadProviders().catch(e=>{c(e.message,`error`)})}),(e,t)=>(R(),k(`div`,Mn,[K(`header`,Nn,[K(`div`,Pn,[K(`div`,Fn,[u(G(xe),{class:`w-6 h-6`}),t[26]||=K(`span`,{class:`font-bold text-lg tracking-tight text-slate-800`},`LLM Server`,-1)]),K(`nav`,In,[K(`button`,{class:A([`px-4 py-1.5 rounded-md text-sm font-medium transition-all flex items-center gap-2 border border-transparent`,g.value===`chat`?`bg-white text-primary shadow-sm border border-primary/20`:`text-slate-500 hover:text-slate-700`]),onClick:t[0]||=e=>b(`chat`)},[u(G(_e),{class:`w-4 h-4`}),t[27]||=w(` 对话 `,-1)],2),K(`button`,{class:A([`px-4 py-1.5 rounded-md text-sm font-medium transition-all flex items-center gap-2 border border-transparent`,g.value===`mcp`?`bg-white text-primary shadow-sm border border-primary/20`:`text-slate-500 hover:text-slate-700`]),onClick:t[1]||=e=>b(`mcp`)},[u(G(pe),{class:`w-4 h-4`}),t[28]||=w(` MCP `,-1)],2),K(`button`,{class:A([`px-4 py-1.5 rounded-md text-sm font-medium transition-all flex items-center gap-2 border border-transparent`,g.value===`providers`?`bg-white text-primary shadow-sm border border-primary/20`:`text-slate-500 hover:text-slate-700`]),onClick:t[2]||=e=>b(`providers`)},[u(G(r),{class:`w-4 h-4`}),t[29]||=w(` 提供商 `,-1)],2),K(`button`,{class:A([`px-4 py-1.5 rounded-md text-sm font-medium transition-all flex items-center gap-2 border border-transparent`,g.value===`statusline`?`bg-white text-primary shadow-sm border border-primary/20`:`text-slate-500 hover:text-slate-700`]),onClick:t[3]||=e=>b(`statusline`)},[u(G(a),{class:`w-4 h-4`}),t[30]||=w(` 状态栏 `,-1)],2),K(`button`,{class:A([`px-4 py-1.5 rounded-md text-sm font-medium transition-all flex items-center gap-2 border border-transparent`,g.value===`logger`?`bg-white text-primary shadow-sm border border-primary/20`:`text-slate-500 hover:text-slate-700`]),onClick:t[4]||=e=>b(`logger`)},[u(G(o),{class:`w-4 h-4`}),t[31]||=w(` 日志 `,-1)],2)])]),K(`div`,Ln,[g.value===`logger`?j(``,!0):(R(),k(O,{key:0},[K(`button`,{class:`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm border transition-all bg-white text-slate-700 border-slate-200 hover:text-primary hover:border-primary/40`,type:`button`,onClick:J},[u(je,{class:`w-5 h-5 rounded-md overflow-hidden`}),t[32]||=K(`span`,{class:`leading-1 font-mono`},`Claude CLI`,-1)]),K(`button`,{class:A([`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-medium border transition-all disabled:opacity-70 disabled:cursor-not-allowed`,G(h).isRestarting?`bg-primary text-white border-primary shadow-sm`:G(h).needsRestart?`bg-amber-50 text-amber-700 border-amber-200`:`bg-white text-slate-700 border-slate-200 hover:text-primary /40`]),disabled:G(h).isRestarting,onClick:Q},[u(G(n),{class:A([`w-4 h-4`,{"animate-spin":G(h).isRestarting}])},null,8,[`class`]),K(`span`,null,C(G(h).isRestarting?`重启中...`:`重启服务`),1),G(h).needsRestart&&!G(h).isRestarting?(R(),k(`span`,zn,` 需重启 `)):j(``,!0)],10,Rn),K(`button`,{class:`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm border transition-all bg-white text-slate-700 border-slate-200 hover:text-primary hover:border-primary/40`,type:`button`,onClick:z},[u(G(i),{class:`w-4 h-4`}),t[33]||=K(`span`,null,`编辑配置`,-1)])],64)),t[34]||=K(`div`,{class:`h-6 w-px bg-slate-200 mx-1`},null,-1),t[35]||=K(`div`,{id:`header-right-target`,class:`flex items-center gap-2`},null,-1),K(`button`,{class:`btn-icon`,title:`设置`,onClick:q},[u(G(l),{class:`w-5 h-5`})])])]),K(`main`,Bn,[u(G(x),null,{default:d(({Component:e,route:t})=>[(R(),_(m,null,[e?(R(),_(P(e),{key:t.path})):j(``,!0)],1024))]),_:1})]),G(h).isRestarting?(R(),k(`div`,Vn,[...t[36]||=[K(`div`,{class:`h-12 w-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin`},null,-1),K(`div`,{class:`text-sm text-slate-700`},`服务重启中，请稍候...`,-1)]])):j(``,!0),u(Ze,{show:G(h).showSettingsModal,"onUpdate:show":t[5]||=e=>G(h).showSettingsModal=e,"base-url":G(h).baseUrl,"onUpdate:baseUrl":t[6]||=e=>G(h).baseUrl=e,"temp-api-key":G(h).tempApiKey,"onUpdate:tempApiKey":t[7]||=e=>G(h).tempApiKey=e,"translation-model":G(h).translationModel,"onUpdate:translationModel":t[8]||=e=>G(h).translationModel=e,"auto-translate":G(h).autoTranslate,"onUpdate:autoTranslate":t[9]||=e=>G(h).autoTranslate=e,"health-status":G(h).healthStatus,providers:G(h).providers,onSave:X,onCheck:G(h).checkHealth},null,8,[`show`,`base-url`,`temp-api-key`,`translation-model`,`auto-translate`,`health-status`,`providers`,`onCheck`]),u(jn,{show:G(h).showClaudeSettingsModal,"onUpdate:show":t[10]||=e=>G(h).showClaudeSettingsModal=e,"timeout-ms":G(h).claudeTimeoutMs,"onUpdate:timeoutMs":t[11]||=e=>G(h).claudeTimeoutMs=e,"base-url":G(h).claudeBaseUrl,"onUpdate:baseUrl":t[12]||=e=>G(h).claudeBaseUrl=e,"api-key":G(h).claudeApiKey,"onUpdate:apiKey":t[13]||=e=>G(h).claudeApiKey=e,"claude-path":G(h).claudePath,"onUpdate:claudePath":t[14]||=e=>G(h).claudePath=e,"work-dir":G(h).claudeWorkDir,"onUpdate:workDir":t[15]||=e=>G(h).claudeWorkDir=e,"terminal-type":G(h).claudeTerminalType,"onUpdate:terminalType":t[16]||=e=>G(h).claudeTerminalType=e,onConfirm:Z},null,8,[`show`,`timeout-ms`,`base-url`,`api-key`,`claude-path`,`work-dir`,`terminal-type`]),u(ft,{show:G(h).showProvidersJsonModal,"onUpdate:show":t[17]||=e=>G(h).showProvidersJsonModal=e,"json-value":G(h).providersJson,"onUpdate:jsonValue":t[18]||=e=>G(h).providersJson=e,error:G(h).providersJsonError,"is-saving":G(h).isSavingProvidersJson,title:`编辑 Providers JSON`,description:`编辑 Providers 配置数组，保存后将立即重启服务。`,onSave:H},null,8,[`show`,`json-value`,`error`,`is-saving`]),u(ft,{show:G(h).showConfigJsonModal,"onUpdate:show":t[19]||=e=>G(h).showConfigJsonModal=e,"json-value":G(h).configJson,"onUpdate:jsonValue":t[20]||=e=>G(h).configJson=e,error:G(h).configJsonError,"is-saving":G(h).isSavingConfigJson,title:`编辑配置 JSON`,description:`编辑完整的配置 JSON，保存后将立即重启服务。`,onSave:U},null,8,[`show`,`json-value`,`error`,`is-saving`]),u(ln,{show:G(h).showEditor,"onUpdate:show":t[21]||=e=>G(h).showEditor=e,"editor-tab":G(h).editorTab,"onUpdate:editorTab":t[22]||=e=>G(h).editorTab=e,form:G(h).editForm,"onUpdate:form":t[23]||=e=>G(h).editForm=e,"new-array-key":G(h).newArrayKey,"onUpdate:newArrayKey":t[24]||=e=>G(h).newArrayKey=e,"json-preview":G(h).providersJson,"onUpdate:jsonPreview":t[25]||=e=>G(h).providersJson=e,"is-editing":G(h).isEditing,onAddKey:G(h).addArrayKey,onRemoveKey:G(h).removeArrayKey,onSave:E,onClose:T},null,8,[`show`,`editor-tab`,`form`,`new-array-key`,`json-preview`,`is-editing`,`onAddKey`,`onRemoveKey`])]))}});export{Hn as default};