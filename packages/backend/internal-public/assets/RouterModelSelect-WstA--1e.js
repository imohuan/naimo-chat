import{$t as e,An as t,Dn as n,Jt as r,Kt as i,Qn as a,Vn as o,Vt as s,Xt as c,Yn as l,Yt as u,dn as d,en as f,gn as p,i as m,ln as h,n as g,qn as _,qt as v,vn as y,yn as b,zt as x}from"./index-urHyhAmF.js";import{t as S}from"./useLlmApi-e_L-gZNA.js";import{u as C}from"./floating-ui.vue-C1NloyW1.js";import{t as w}from"./chevron-down-ByDMAM3t.js";import{t as T}from"./x-CQcBFYia.js";import{t as E}from"./Dropdown-ocMVVnLy.js";var D=C(`search`,[[`path`,{d:`m21 21-4.34-4.34`,key:`14j7rj`}],[`circle`,{cx:`11`,cy:`11`,r:`8`,key:`4ej97u`}]]);const O=g(`llmDashboard`,()=>{let e=o([]),t=o(!1),n=o(!1),r=o(`form`),i=o({name:``,baseUrl:``,apiKey:``,apiKeys:[],models:[],limit:0,transformer:void 0}),a=o(``),s=o(``),c=o(!1),l=o(!1),u=o(!1),d=o(!1),f=o(``),p=o(``),m=o(!1),h=o(!1),g=o(``),_=o(`300000`),v=o(`http://127.0.0.1:3457/`),y=o(`sk-imohuan`),b=o(`claude`),x=o(`G:\\ClaudeCode`),C=o(`powershell`),w=o(!1),{baseUrl:T,tempApiKey:E,translationModel:D,autoTranslate:O,needsRestart:k,healthStatus:A,persistSettings:j,fetchProviders:M,toggleProvider:N,deleteProvider:P,saveProvider:F,restartService:I,checkHealth:L,fetchConfig:R,saveConfig:z,startClaudeCli:B}=S();function V(e){return[...e].sort((e,t)=>{let n=typeof e.sort==`number`?e.sort:2**53-1,r=typeof t.sort==`number`?t.sort:2**53-1;return n===r?e.name.localeCompare(t.name):n-r})}function H(){let e=[];return(i.value.apiKeys||[]).forEach(t=>{t&&t.trim()&&e.push(t.trim())}),Array.from(new Set(e))}function U(){let e=Array.from(new Set(i.value.models||[])),t=H(),n={name:i.value.name,baseUrl:i.value.baseUrl,apiKey:`sk-imohuan`,apiKeys:t,models:e,limit:i.value.limit||0,enabled:!0};return i.value.transformer&&(n.transformer=i.value.transformer),n}async function W(){let t=await M();t=t.map(e=>(e.originalTransformer&&(e.transformer=e.originalTransformer),e)),e.value=V(t)}function G(e,a=`form`){if(t.value=!0,n.value=!!e,r.value=a,e)if(Array.isArray(e.apiKeys)&&e.apiKeys.length>0)i.value={name:e.name,baseUrl:e.baseUrl,apiKey:``,apiKeys:e.apiKeys.filter(Boolean),models:e.models||[],limit:e.limit||0,transformer:e.transformer};else{let t=[];e.apiKey&&e.apiKey!==`sk-imohuan`&&t.push(e.apiKey),i.value={name:e.name,baseUrl:e.baseUrl,apiKey:``,apiKeys:t.filter(Boolean),models:e.models||[],limit:e.limit||0,transformer:e.transformer}}else i.value={name:``,baseUrl:T.value,apiKey:``,apiKeys:[],models:[],limit:0,transformer:void 0};s.value=JSON.stringify(U(),null,2)}function K(){t.value=!1}async function q(e,t){await F(e,t),await W()}async function J(e){let t=await N(e);return e.enabled=t,t}async function Y(e){await P(e),await W()}async function X(t){let n=t.map((e,t)=>({...e,sort:t}));e.value=V(n);let r=await R(),i=new Map(n.map(e=>[e.name,e.sort])),a=(r.Providers||r.providers||[]).map(e=>{let t=i.get(e.name);return typeof t==`number`?{...e,sort:t}:e});n.forEach(e=>{a.some(t=>t.name===e.name)||a.push({...e})}),await z({...r,Providers:a})}function Z(){a.value.trim()&&(i.value.apiKeys.push(a.value.trim()),a.value=``)}function Q(e){i.value.apiKeys.splice(e,1)}function $(){j()}return{providers:e,showEditor:t,isEditing:n,editorTab:r,editForm:i,newArrayKey:a,providersJson:s,showSettingsModal:c,showClaudeSettingsModal:l,showProvidersJsonModal:u,showConfigJsonModal:d,providersJsonError:f,configJsonError:p,isSavingProvidersJson:m,isSavingConfigJson:h,configJson:g,claudeTimeoutMs:_,claudeBaseUrl:v,claudeApiKey:y,claudePath:b,claudeWorkDir:x,claudeTerminalType:C,isRestarting:w,baseUrl:T,tempApiKey:E,translationModel:D,autoTranslate:O,needsRestart:k,healthStatus:A,loadProviders:W,openEditor:G,closeEditor:K,saveProvider:q,toggleProvider:J,deleteProvider:Y,reorderProviders:X,addArrayKey:Z,removeArrayKey:Q,providerFromForm:U,persistSettings:$,restartService:I,checkHealth:L,fetchConfig:R,saveConfig:z,startClaudeCli:B}});var k={key:0,class:`absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none z-10`},A=[`value`,`placeholder`],j={class:`absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1 pointer-events-none`},M={class:`font-mono`},N={class:`overflow-y-auto p-1 max-h-72`},P={key:0,class:`h-px bg-slate-200 my-1`},F={class:`px-2 py-1`},I={class:`text-xs font-semibold text-slate-500 uppercase tracking-wider px-2 py-1`},L={class:`space-y-0.5`},R=[`onMousedown`],z={key:1,class:`px-2 py-1.5 text-xs text-slate-400 text-center font-mono`},B={key:2,class:`px-2 py-1.5 text-xs text-slate-400 text-center font-mono`},V=m(f({__name:`RouterModelSelect`,props:{modelValue:{},options:{},placeholder:{},showIcon:{type:Boolean,default:!0}},emits:[`update:modelValue`],setup(f,{emit:m}){let g=f,S=m,C=o(``),O=o(!1),V=o(!1),H=o(!1),U=o(null),W=null,G=i(()=>V.value?C.value:g.modelValue?g.modelValue:``),K=i(()=>{let e={};return g.options.forEach(t=>{let n=t.split(`,`)[0]||`unknown`;e[n]||(e[n]=[]),e[n].push(t)}),Object.keys(e).sort().map(t=>({provider:t,options:e[t]?.sort()||[]}))}),q=i(()=>{let e=C.value.trim().toLowerCase();if(!e)return K.value;let t=[];return K.value.forEach(n=>{let r=n.provider.toLowerCase().includes(e),i=n.options.filter(t=>t.toLowerCase().includes(e));(r||i.length>0)&&t.push({provider:n.provider,options:r?n.options:i})}),t});function J(){U.value?.focus(),Y()}function Y(){O.value=!0,h(()=>{U.value?.focus()})}function X(e){W&&=(clearTimeout(W),null),S(`update:modelValue`,e),C.value=``,V.value=!1,H.value=!1,O.value=!1,h(()=>{U.value?.blur(),V.value=!1,H.value=!1})}function Z(e){e.stopPropagation(),e.preventDefault(),C.value=``,H.value=!0,h(()=>{U.value?.focus()})}function Q(){V.value=!0,H.value=!0,Y()}function $(){W=setTimeout(()=>{V.value=!1,H.value=!1,O.value=!1,C.value=``,W=null},200)}function ee(e){let t=e.target;document.activeElement===U.value&&(V.value=!0),H.value=!0,C.value=t.value}function te(e){if(e.key===`Escape`&&(V.value=!1,H.value=!1,O.value=!1,C.value=``,U.value?.blur()),e.key===`Enter`&&q.value.length>0){let t=q.value[0];if(t&&t.options.length>0){let n=t.options[0];n&&(X(n),e.preventDefault())}}}return n(()=>g.modelValue,()=>{!O.value&&!H.value&&(C.value=``)}),d(()=>{W&&=(clearTimeout(W),null)}),(n,i)=>(p(),r(E,{show:O.value,"onUpdate:show":i[1]||=e=>O.value=e},{trigger:t(()=>[v(`div`,{class:`relative w-full font-mono`,onClick:i[0]||=x(()=>{},[`stop`])},[f.showIcon?(p(),c(`div`,k,[b(n.$slots,`icon`,{},()=>[e(_(D),{class:`w-4 h-4 text-slate-400`})],!0)])):u(``,!0),v(`input`,{ref_key:`inputRef`,ref:U,value:G.value,type:`text`,class:l([`w-full input-base router-model-select__input pr-9 text-left transition-colors`,{"text-slate-400":!f.modelValue&&!C.value,"pl-9":f.showIcon,"pl-3":!f.showIcon}]),placeholder:f.placeholder||`-- 请选择模型 --`,onFocus:Q,onBlur:$,onInput:ee,onKeydown:te,onClick:x(J,[`stop`])},null,42,A),v(`div`,j,[C.value?(p(),c(`button`,{key:0,type:`button`,class:`pointer-events-auto p-0.5 text-slate-400 hover:text-slate-600 transition-colors`,onMousedown:x(Z,[`prevent`,`stop`])},[e(_(T),{class:`w-3.5 h-3.5`})],32)):u(``,!0),e(_(w),{class:`w-4 h-4 text-slate-400 shrink-0 pointer-events-none`})])])]),default:t(()=>[v(`div`,M,[v(`div`,N,[q.value.length>0?(p(!0),c(s,{key:0},y(q.value,(e,t)=>(p(),c(s,{key:e.provider},[t>0?(p(),c(`div`,P)):u(``,!0),v(`div`,F,[v(`div`,I,a(e.provider),1),v(`div`,L,[(p(!0),c(s,null,y(e.options,e=>(p(),c(`div`,{key:e,class:l([`px-2 py-1 text-xs font-mono rounded-md cursor-pointer transition-colors flex items-center router-model-select__option`,{"bg-primary-50 text-primary-700 font-medium":e===f.modelValue,"hover:bg-slate-100 text-slate-700":e!==f.modelValue}]),onMousedown:x(t=>X(e),[`prevent`])},a(e),43,R))),128))])])],64))),128)):u(``,!0),f.options.length===0?(p(),c(`div`,z,` 无可用模型 `)):C.value&&q.value.length===0?(p(),c(`div`,B,` 无匹配结果 `)):u(``,!0)])])]),_:3},8,[`show`]))}}),[[`__scopeId`,`data-v-514ffc1f`]]);export{O as n,D as r,V as t};