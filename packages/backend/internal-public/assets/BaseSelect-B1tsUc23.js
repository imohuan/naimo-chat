import{$t as e,An as t,Dn as n,Jt as r,Kt as i,Qn as a,Tn as o,Vn as s,Vt as c,Xt as l,Yn as u,Yt as d,Zn as f,bn as p,dn as m,en as h,gn as g,i as _,ln as v,qn as y,qt as b,vn as x,yn as S,zt as C}from"./index-urHyhAmF.js";import{t as w}from"./chevron-down-ByDMAM3t.js";import{t as T}from"./x-CQcBFYia.js";import{t as E}from"./Input-DqR3mkMP.js";import{t as D}from"./Dropdown-ocMVVnLy.js";var O={class:`relative w-full`},k={key:0,class:`absolute inset-y-0 left-3 flex items-center pointer-events-none text-sm text-slate-700`},A={key:1,class:`absolute inset-y-0 left-3 flex items-center pointer-events-none text-sm text-slate-700`},j={key:2,class:`absolute inset-y-0 left-3 flex items-center pointer-events-none text-sm text-slate-400`},ee={class:`absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1 pointer-events-none`},te={class:`flex-1 overflow-y-auto p-1 flex flex-col gap-1`},ne=[`onMousedown`,`onMouseenter`],M={class:`flex-1`},N={key:1,class:`px-2 py-1.5 text-sm text-slate-400 text-center`},P={key:2,class:`px-2 py-1.5 text-sm text-slate-400 text-center`},F={key:3,class:`px-2 py-1.5 text-sm text-slate-400 text-center`},I=_(h({__name:`BaseSelect`,props:{modelValue:{},options:{},placeholder:{},disabled:{type:Boolean},loading:{type:Boolean},clearable:{type:Boolean},searchable:{type:Boolean},dropdownMinWidth:{},dropdownMaxWidth:{},dropdownMaxHeight:{}},emits:[`update:modelValue`],setup(h,{emit:_}){let I=h,L=_,R=s(``),z=s(!1),B=s(!1),V=s(!1),H=s(null),U=i(()=>H.value?.el),W=s(null),G=s(-1),K=s(new Map),q=null,J=o(),Y=i(()=>!!J.selectedLabel);i(()=>Y.value&&X.value&&!R.value);let X=i(()=>I.modelValue===null||I.modelValue===void 0?null:I.options.find(e=>e.value===I.modelValue)||{label:String(I.modelValue),value:I.modelValue,colorClass:``}),re=i(()=>B.value&&I.searchable!==!1?R.value:``),Z=i(()=>{if(I.searchable===!1)return I.options;let e=R.value.trim().toLowerCase();return e?I.options.filter(t=>t.label.toLowerCase().includes(e)):I.options});function ie(){I.disabled||I.loading||(U.value?.focus(),z.value=!0)}function Q(e){q&&=(clearTimeout(q),null),L(`update:modelValue`,e),R.value=``,G.value=-1,B.value=!1,V.value=!1,z.value=!1,v(()=>{U.value?.blur(),B.value=!1,V.value=!1})}function ae(e){e.stopPropagation(),e.preventDefault(),!(I.disabled||I.loading)&&(q&&=(clearTimeout(q),null),L(`update:modelValue`,null),R.value=``,G.value=-1,B.value=!1,V.value=!1,z.value=!1,v(()=>{U.value?.blur()}))}function oe(e){e.stopPropagation(),e.preventDefault(),R.value=``,G.value=-1,V.value=!0,v(()=>{U.value?.focus()})}function $(){I.disabled||I.loading||(B.value=!0,V.value=!0,z.value=!0,G.value=-1)}function se(){q=setTimeout(()=>{B.value=!1,V.value=!1,z.value=!1,R.value=``,G.value=-1,q=null},200)}function ce(e){if(I.disabled||I.loading||I.searchable===!1)return;let t=e.target;document.activeElement===U.value&&(B.value=!0),V.value=!0,R.value=t.value}function le(e){if(e.key===`Escape`){B.value=!1,V.value=!1,z.value=!1,R.value=``,G.value=-1,U.value?.blur();return}if(e.key===`Enter`){if(G.value>=0&&G.value<Z.value.length){let t=Z.value[G.value];if(t&&!t.disabled){Q(t.value),e.preventDefault();return}}if(Z.value.length>0&&I.searchable!==!1){let t=Z.value.find(e=>!e.disabled);if(t){Q(t.value),e.preventDefault();return}}R.value.trim()&&I.searchable!==!1&&(Q(R.value.trim()),e.preventDefault());return}if(e.key===`ArrowDown`||e.key===`ArrowUp`){if(z.value||(z.value=!0,B.value=!0),Z.value.filter(e=>!e.disabled).length===0){e.preventDefault();return}if(e.preventDefault(),G.value===-1){let e=Z.value.findIndex(e=>e.value===I.modelValue);G.value=e>=0?e:0}else if(e.key===`ArrowDown`){let e=G.value+1;for(;e<Z.value.length;){let t=Z.value[e];if(t&&!t.disabled)break;e++}e<Z.value.length&&(G.value=e)}else{let e=G.value-1;for(;e>=0;){let t=Z.value[e];if(t&&!t.disabled)break;e--}e>=0&&(G.value=e)}v(()=>{let e=K.value.get(G.value);e&&e.scrollIntoView({block:`nearest`,behavior:`smooth`})})}}return n(()=>I.modelValue,()=>{!z.value&&!V.value&&(R.value=``,G.value=-1)}),n(()=>Z.value,()=>{G.value>=Z.value.length&&(G.value=-1)}),m(()=>{q&&=(clearTimeout(q),null)}),(n,i)=>(g(),r(D,{ref_key:`dropdownRef`,ref:W,show:z.value&&!h.disabled&&!h.loading,"min-width":h.dropdownMinWidth,"max-width":h.dropdownMaxWidth,"max-height":h.dropdownMaxHeight,"onUpdate:show":i[0]||=e=>z.value=e},{trigger:t(()=>[b(`div`,O,[e(E,{ref_key:`inputCompRef`,ref:H,"model-value":re.value,type:`text`,class:u({"opacity-50 cursor-not-allowed":h.disabled||h.loading,"pr-20":h.clearable&&X.value&&!h.disabled&&!h.loading}),placeholder:B.value?h.placeholder||`请选择或输入`:``,disabled:h.disabled||h.loading,readonly:h.searchable===!1||h.disabled||h.loading,onFocus:$,onBlur:se,onInput:ce,onKeydown:le,onClick:C(ie,[`stop`])},null,8,[`model-value`,`class`,`placeholder`,`disabled`,`readonly`]),X.value&&Y.value&&!B.value?(g(),l(`div`,k,[S(n.$slots,`selectedLabel`,{option:X.value},void 0,!0)])):X.value&&!Y.value&&!B.value&&!R.value?(g(),l(`div`,A,a(X.value.label),1)):!X.value&&!B.value&&!R.value?(g(),l(`div`,j,a(h.placeholder||`请选择`),1)):d(``,!0),b(`div`,ee,[R.value&&h.searchable!==!1&&!h.disabled&&!h.loading?(g(),l(`button`,{key:0,type:`button`,class:`pointer-events-auto p-0.5 text-slate-400 hover:text-slate-600 transition-colors`,onMousedown:C(oe,[`prevent`,`stop`])},[e(y(T),{class:`w-3.5 h-3.5`})],32)):h.clearable&&X.value&&!h.disabled&&!h.loading?(g(),l(`button`,{key:1,type:`button`,class:`pointer-events-auto p-0.5 text-slate-400 hover:text-slate-600 transition-colors`,onMousedown:C(ae,[`prevent`,`stop`])},[e(y(T),{class:`w-3.5 h-3.5`})],32)):d(``,!0),e(y(w),{class:u([`w-4 h-4 text-slate-400 shrink-0 pointer-events-auto`,{"opacity-50":h.disabled||h.loading}])},null,8,[`class`])])])]),default:t(()=>[b(`div`,te,[Z.value.length>0?(g(!0),l(c,{key:0},x(Z.value,(e,t)=>(g(),l(`div`,{key:String(e.value),ref_for:!0,ref:e=>{e?K.value.set(t,e):K.value.delete(t)},class:u([`px-2 py-1 text-sm rounded-md cursor-pointer transition-colors flex items-center gap-2 base-select__option`,{"bg-slate-200 ":e.value===h.modelValue,"bg-sky-100 text-sky-700":G.value===t&&e.value!==h.modelValue,"hover:bg-slate-100 text-slate-700":G.value!==t&&e.value!==h.modelValue,"opacity-50 cursor-not-allowed":e.disabled}]),onMousedown:C(t=>e.disabled?null:Q(e.value),[`prevent`]),onMouseenter:e=>G.value=t},[S(n.$slots,`option`,{option:e,isSelected:e.value===h.modelValue},()=>[e.colorClass||e.colorStyle?(g(),l(`span`,{key:0,class:u([`w-4 h-4 rounded-full border border-slate-200 shrink-0`,e.colorClass||`bg-white`]),style:f(e.colorStyle)},null,6)):d(``,!0),e.icon?(g(),r(p(typeof e.icon==`string`?`span`:e.icon),{key:1,class:u(typeof e.icon==`string`?e.icon:`w-4 h-4 shrink-0`)},null,8,[`class`])):d(``,!0),b(`span`,M,a(e.label),1)],!0)],42,ne))),128)):d(``,!0),h.options.length===0&&!h.loading?(g(),l(`div`,N,` 无可用选项 `)):R.value&&Z.value.length===0&&h.searchable!==!1?(g(),l(`div`,P,` 无匹配结果 `)):d(``,!0),h.loading?(g(),l(`div`,F,` 加载中... `)):d(``,!0)])]),_:3},8,[`show`,`min-width`,`max-width`,`max-height`]))}}),[[`__scopeId`,`data-v-75d01e16`]]);export{I as t};