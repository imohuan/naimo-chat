# å‰ç«¯åŒ…é‡æ„æŒ‡å— v2.0

## ğŸ—ï¸ é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®è§„æ¨¡

- **389 ä¸ª Vue ç»„ä»¶**ï¼ˆ97% ä½¿ç”¨ TypeScriptï¼‰
- **116 ä¸ª TypeScript æ–‡ä»¶**
- **æŠ€æœ¯æ ˆ**ï¼šVue 3ã€Piniaã€Vite 8ã€Tailwind CSS v4
- **ä¸»è¦åŠŸèƒ½**ï¼šAI èŠå¤©ã€LLM æä¾›å•†ç®¡ç†ã€MCP åè®®æ”¯æŒ

### é‡æ„ç›®æ ‡

```
å»ºç«‹ç»Ÿä¸€çš„ä¿¡æ¯æ¶æ„ â†’ æ‰“é€ è‡ªæ´½çš„è®¾è®¡ç³»ç»Ÿ â†’ çŠ¶æ€å±‚é¢†åŸŸæ‹†åˆ† â†’ æ˜“æ‰©å±•æ˜“ç»´æŠ¤
```

---

## ğŸ“Š ç°çŠ¶è¯Šæ–­

### æ ¸å¿ƒé—®é¢˜æ¸…å•

| é—®é¢˜ç±»å‹ | ç°çŠ¶                 | å½±å“                   | ä¼˜å…ˆçº§ |
| -------- | -------------------- | ---------------------- | ------ |
| ç»„ä»¶è¿‡å¤§ | å¤šä¸ªç»„ä»¶è¶…è¿‡ 1000 è¡Œ | ç»´æŠ¤å›°éš¾ã€å¤ç”¨æ€§å·®     | ğŸ”´ é«˜  |
| ç±»å‹å®‰å…¨ | 35 ä¸ªæ–‡ä»¶ä½¿ç”¨ `any`  | ç±»å‹æ¨æ–­å¤±æ•ˆã€Bug éšæ‚£ | ğŸ”´ é«˜  |
| çŠ¶æ€è€¦åˆ | Store èŒè´£æ··ä¹±       | éš¾ä»¥æµ‹è¯•ã€æ‰©å±•å›°éš¾     | ğŸ”´ é«˜  |
| è·¯ç”±å†²çª | `/demo` å®šä¹‰ä¸¤æ¬¡     | å¯¼èˆªå¼‚å¸¸ã€ç¼“å­˜å¤±æ•ˆ     | ğŸŸ¡ ä¸­  |
| æ ·å¼æ··ä¹± | å¤šå¥— UI åº“æ··ç”¨       | è§†è§‰å‰²è£‚ã€ç»´æŠ¤æˆæœ¬é«˜   | ğŸŸ¡ ä¸­  |
| æµ‹è¯•ç¼ºå¤± | æ— æµ‹è¯•æ–‡ä»¶           | å›å½’é£é™©å¤§             | ğŸŸ¡ ä¸­  |

### è¶…å¤§ç»„ä»¶ Top 3

| ç»„ä»¶è·¯å¾„                                    | è¡Œæ•°     | èŒè´£è†¨èƒ€é—®é¢˜                               |
| ------------------------------------------- | -------- | ------------------------------------------ |
| `src/components/ImmersiveCode.vue`          | 1,449 è¡Œ | Monaco ç¼–è¾‘å™¨ + å‘½ä»¤å†å² + æ–‡ä»¶æ ‘ + çŠ¶æ€æ  |
| `src/views/Logger/LoggerRequestDetail.vue`  | 1,267 è¡Œ | è¯·æ±‚è¯¦æƒ… + JSON å±•ç¤º + æ“ä½œåŒº              |
| `src/views/LlmDashboard/Chat/ChatPanel.vue` | 1,133 è¡Œ | æ ‡ç­¾ç®¡ç† + äº‹ä»¶æ€»çº¿ + æ¶ˆæ¯æ“ä½œ             |

### çŠ¶æ€ç®¡ç†é—®é¢˜

```
å½“å‰ useLlmDashboardStore èŒè´£ï¼š
â”œâ”€â”€ æŒä¹…åŒ–è®¾ç½®
â”œâ”€â”€ Provider åˆ—è¡¨
â”œâ”€â”€ æ¨¡æ€å¼€å…³
â”œâ”€â”€ Claude CLI å‚æ•°
â””â”€â”€ è¿œç¨‹ API è°ƒç”¨
â†’ é¢†åŸŸè¾¹ç•Œæ¨¡ç³Šï¼Œç¼ºä¹é”™è¯¯å¤„ç†ç­–ç•¥
```

---

## ğŸ¯ é‡æ„ç›®æ ‡æ¶æ„

### æ¨èç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ modules/                  # ä¸šåŠ¡æ¨¡å—ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ chat/                 # èŠå¤©æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ components/       # æ¨¡å—å†…ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar/
â”‚   â”‚   â”‚   â”œâ”€â”€ Transcript/
â”‚   â”‚   â”‚   â”œâ”€â”€ Composer/
â”‚   â”‚   â”‚   â””â”€â”€ ModelPanel/
â”‚   â”‚   â”œâ”€â”€ hooks/            # æ¨¡å—å†… hooks
â”‚   â”‚   â”œâ”€â”€ stores/           # æ¨¡å—å†…çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ types/            # æ¨¡å—å†…ç±»å‹
â”‚   â”‚   â””â”€â”€ index.ts          # ç»Ÿä¸€å¯¼å‡º
â”‚   â”œâ”€â”€ providers/            # æä¾›å•†ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ logger/               # æ—¥å¿—æ¨¡å—
â”‚   â””â”€â”€ settings/             # è®¾ç½®æ¨¡å—
â”œâ”€â”€ components/               # é€šç”¨åŸºç¡€ç»„ä»¶ï¼ˆShadcn é£æ ¼ï¼‰
â”‚   â”œâ”€â”€ ui/                   # [ä¿æŒåŸæ ·] åŸºç¡€ UI ç»„ä»¶ (packages/frontend/src/components/ui)
â”‚   â”œâ”€â”€ ai-elements/          # [ä¿æŒåŸæ ·] AI ç›¸å…³å…ƒç´  (packages/frontend/src/components/ai-elements)
â”‚   â””â”€â”€ app/                  # åº”ç”¨çº§å¸ƒå±€ç»„ä»¶
â”‚       â”œâ”€â”€ AppShell.vue
â”‚       â”œâ”€â”€ PageHeader.vue
â”‚       â””â”€â”€ Toolbar.vue
â”œâ”€â”€ composables/              # è·¨ä¸šåŠ¡é€šç”¨ hooks
â”‚   â”œâ”€â”€ useAsyncTask.ts
â”‚   â”œâ”€â”€ useEventBus.ts
â”‚   â”œâ”€â”€ useHotkeys.ts
â”‚   â””â”€â”€ useDebouncedRef.ts
â”œâ”€â”€ services/                 # æœåŠ¡å±‚ï¼ˆAPI å°è£…ï¼‰
â”‚   â”œâ”€â”€ configService.ts
â”‚   â”œâ”€â”€ chatService.ts
â”‚   â””â”€â”€ systemService.ts
â”œâ”€â”€ stores/                   # å…¨å±€çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ system.store.ts
â”‚   â”œâ”€â”€ provider.store.ts
â”‚   â”œâ”€â”€ chat.store.ts
â”‚   â””â”€â”€ ui.store.ts
â”œâ”€â”€ types/                    # å…¨å±€ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ chat/
â”‚   â””â”€â”€ mcp/
â”œâ”€â”€ styles/                   # æ ·å¼ç³»ç»Ÿ
â”‚   â”œâ”€â”€ tokens.css            # Design Token
â”‚   â””â”€â”€ global.css            # å…¨å±€æ ·å¼
â””â”€â”€ lib/                      # å·¥å…·åº“
    â”œâ”€â”€ notifications.ts
    â””â”€â”€ utils.ts
```

### ç›®å½•å†³ç­–æ ‘

```
æ–°å¢åŠŸèƒ½æ—¶å…ˆé—®ï¼š
1. è¿™å±äºå“ªä¸ªä¸šåŠ¡åŸŸï¼Ÿ â†’ modules/ä¸šåŠ¡åŸŸ/
2. æ˜¯è·¨ä¸šåŠ¡çš„é€šç”¨ç»„ä»¶ï¼Ÿ â†’ components/
3. æ˜¯è·¨ä¸šåŠ¡çš„é€šç”¨é€»è¾‘ï¼Ÿ â†’ composables/
4. æ˜¯é€šç”¨å·¥å…·å‡½æ•°ï¼Ÿ â†’ lib/
5. æ¶‰åŠ API è°ƒç”¨ï¼Ÿ â†’ services/
```

---

## ğŸ“ ä»£ç è§„èŒƒ

### Vue ç»„ä»¶ç¼–å†™é¡ºåº

```vue
<script setup lang="ts">
// 1. å¤–éƒ¨ä¾èµ–å¯¼å…¥
import { ref, computed, onMounted } from "vue";
import { useEventBus } from "@vueuse/core";

// 2. ç»„ä»¶å¯¼å…¥
import BaseButton from "@/components/ui/Button";

// 3. Props/Emits å®šä¹‰
interface Props {
  title: string;
  disabled?: boolean;
}
const props = withDefaults(defineProps<Props>(), {
  disabled: false,
});
const emit = defineEmits<{
  submit: [data: FormData];
}>();

// 4. å“åº”å¼çŠ¶æ€
const loading = ref(false);
const formData = ref({});

// 5. Composables/Stores
const { execute } = useAsyncTask();

// 6. çº¯å‡½æ•°/äº‹ä»¶å¤„ç†
const handleSubmit = () => {
  emit("submit", formData.value);
};

// 7. ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  // åˆå§‹åŒ–é€»è¾‘
});
</script>
```

### å‘½åè§„èŒƒé€ŸæŸ¥

| ç±»å‹       | å‘½åè§„åˆ™                      | ç¤ºä¾‹              |
| ---------- | ----------------------------- | ----------------- |
| ç»„ä»¶æ–‡ä»¶   | PascalCase æ–‡ä»¶å¤¹ + index.vue | Button/index.vue  |
| Composable | useXxx.ts                     | useAsyncTask.ts   |
| Service    | xxx.service.ts                | config.service.ts |
| Store      | xxx.store.ts                  | chat.store.ts     |
| ç±»å‹æ–‡ä»¶   | xxx.types.ts                  | chat.types.ts     |
| ç›®å½•       | å°å†™è¿å­—ç¬¦                    | components/ui/    |

### ç»„ä»¶æ‹†åˆ†åŸåˆ™

```
åˆ¤æ–­æµç¨‹ï¼š
ç»„ä»¶è¶…è¿‡ 200 è¡Œ â†’ è€ƒè™‘æ‹†åˆ†
é€»è¾‘å—è¶…è¿‡ 3 ä¸ª â†’ æŠ½å– Composable
ç›¸åŒé€»è¾‘å¤šå¤„ä½¿ç”¨ â†’ æå–ä¸ºå…±äº« hook
```

### çŠ¶æ€ç®¡ç†åŸåˆ™

```
åˆ¤æ–­æµç¨‹ï¼š
æœ¬åœ°çŠ¶æ€ â†’ ç»„ä»¶å†… ref/reactive
è·¨ç»„ä»¶å…±äº« â†’ è€ƒè™‘ Pinia store
è·¨é¡µé¢å…±äº« â†’ ä½¿ç”¨ Pinia store
æ¶‰åŠ API â†’ å°è£…åˆ° service
```

---

## ğŸ”§ é‡æ„ä»»åŠ¡æ¸…å•

### é˜¶æ®µä¸€ï¼šåŸºç¡€è®¾æ–½ï¼ˆç¬¬ 1-2 å‘¨ï¼‰

#### [ ] 1.1 ç›®å½•è§„èŒƒè½åœ°

- **ä»»åŠ¡è¦æ±‚**ï¼šç¼–å†™ `docs/architecture/folder-structure.md`ï¼Œæ˜ç¡®å„ç›®å½•èŒè´£åŠå‘½åè§„èŒƒ
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] å®šä¹‰ modules/components/services/stores/hooks/types/styles ç­‰ç›®å½•è§„èŒƒ
  - [ ] ç¡®å®šå•ç»„ä»¶æ–‡ä»¶å¤¹ç»“æ„ï¼ˆç»„ä»¶å/index.vue + style.css + types.tsï¼‰
  - [ ] ç»™å‡ºå®Œæ•´ç¤ºä¾‹ç›®å½•æ ‘
- **å…³è”æ–‡ä»¶**ï¼šæ–°å»º `docs/architecture/folder-structure.md`

#### [ ] 1.2 è®¾è®¡ Token ä¸å…¨å±€æ ·å¼ä½“ç³»

- **ä»»åŠ¡è¦æ±‚**ï¼šåˆ›å»º Design Token ç³»ç»Ÿï¼Œè¿ç§»æ—§æ ·å¼
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] åˆ›å»º `src/styles/tokens.css`ï¼ˆé¢œè‰²ã€é—´è·ã€åœ†è§’ã€é˜´å½±ã€å­—ä½“ï¼‰
  - [ ] åˆ›å»º `src/styles/global.css`ï¼ˆåŸºç¡€é‡ç½®æ ·å¼ï¼‰
  - [ ] å®šä¹‰ Light/Dark ä¸»é¢˜ token
  - [ ] è¿ç§» `src/style.css` ä¸­çš„å˜é‡
- **å…³è”æ–‡ä»¶**ï¼š
  - æ–°å»º `src/styles/tokens.css`
  - æ–°å»º `src/styles/global.css`
  - é‡æ„ `packages/frontend/src/style.css`

#### [ ] 1.3 è·¯ç”±ä¸å¯¼èˆªè°ƒæ•´

- **ä»»åŠ¡è¦æ±‚**ï¼šé‡å†™è·¯ç”±é…ç½®ï¼Œæ¶ˆé™¤å†²çª
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] ä½¿ç”¨ Shell ä½œä¸ºæ ¹å¸ƒå±€
  - [ ] è§„èŒƒåŒ–å­è·¯ç”±å‘½åï¼ˆå¦‚ `/workspace/chat`ï¼‰
  - [ ] æ¶ˆé™¤ `/demo` é‡å¤å®šä¹‰
  - [ ] é…ç½®å®éªŒé¡µé¢ç‹¬ç«‹ namespaceï¼ˆ`/labs`ï¼‰
  - [ ] æ·»åŠ è·¯ç”±æ‡’åŠ è½½
- **å…³è”æ–‡ä»¶**ï¼š`packages/frontend/src/router.ts`

---

### é˜¶æ®µäºŒï¼šç»„ä»¶åº“ä¸å¸ƒå±€ï¼ˆç¬¬ 3-4 å‘¨ï¼‰

#### [ ] 2.1 Shadcn é£æ ¼åŸºç¡€ç»„ä»¶åº“ç»´æŠ¤

- **ä»»åŠ¡è¦æ±‚**ï¼šå¯¹ç°æœ‰çš„ `src/components/ui/` å’Œ `src/components/ai-elements/` è¿›è¡Œç»´æŠ¤ä¸æ ·å¼å¯¹é½ï¼Œ**ä¸ç§»åŠ¨æˆ–é‡æ„å…¶ç‰©ç†ä½ç½®**ã€‚
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] ç¡®ä¿ç°æœ‰ç»„ä»¶èƒ½æ­£ç¡®å¼•ç”¨æ–°çš„ Design Tokens
  - [ ] ç»Ÿä¸€ç°æœ‰ç»„ä»¶çš„ç±»å‹å¯¼å‡ºæ–¹å¼
  - [ ] ç¡®ä¿æ–°å¢çš„ä¸šåŠ¡æ¨¡å—èƒ½æ— ç¼å¼•ç”¨è¿™äº›ç»„ä»¶
  - [ ] ä¿æŒç‰©ç†è·¯å¾„ `packages/frontend/src/components/ui` å’Œ `packages/frontend/src/components/ai-elements` ä¸å˜
- **æ³¨æ„**ï¼šè¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹å±äºç°æœ‰åŸºç¡€è®¾æ–½ï¼Œä»…åšæ ·å¼/ç±»å‹å±‚é¢çš„é€‚é…ã€‚

#### [ ] 2.2 åº”ç”¨ Shell é‡æ„

- **ä»»åŠ¡è¦æ±‚**ï¼šå®ç°ç»Ÿä¸€çš„åº”ç”¨å¤–å£³å¸ƒå±€
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] åˆ›å»º `src/layouts/AppShell.vue`
  - [ ] æä¾› Header/Sidebar/Content slot
  - [ ] è¿ç§» `App.vue` ä¸­çš„ Provider æ³¨å…¥é€»è¾‘
  - [ ] Toast ç³»ç»Ÿé›†æˆ
  - [ ] å“åº”å¼å¸ƒå±€æ”¯æŒï¼ˆ>=1280px åŒæ ï¼Œ<1024px å †å ï¼‰
- **å…³è”æ–‡ä»¶**ï¼š
  - æ–°å»º `src/layouts/AppShell.vue`
  - é‡æ„ `packages/frontend/src/App.vue`

---

### é˜¶æ®µä¸‰ï¼šçŠ¶æ€ä¸æœåŠ¡å±‚ï¼ˆç¬¬ 5-6 å‘¨ï¼‰

#### [ ] 3.1 Service å±‚æŠ½è±¡

- **ä»»åŠ¡è¦æ±‚**ï¼šå»ºç«‹ç»Ÿä¸€çš„ API æœåŠ¡å±‚
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] åˆ›å»º `src/services/configService.ts`ï¼ˆé…ç½®ç›¸å…³ APIï¼‰
  - [ ] åˆ›å»º `src/services/chatService.ts`ï¼ˆSSE/æµå¼ï¼‰
  - [ ] åˆ›å»º `src/services/systemService.ts`ï¼ˆå¥åº·æ£€æŸ¥ã€é‡å¯ï¼‰
  - [ ] ç»Ÿä¸€è¿”å› `Result<T, Error>` ç±»å‹
  - [ ] è¿ç§» `useLlmApi.ts` çš„è¯·æ±‚é€»è¾‘
- **Service æ¨¡æ¿**ï¼š

  ```typescript
  // src/services/configService.ts
  import http from "@/lib/http";

  export const configService = {
    async getProviders() {
      return http.get<Provider[]>("/api/providers");
    },

    async updateProvider(id: string, data: ProviderInput) {
      return http.put<Provider>(`/api/providers/${id}`, data);
    },
  };
  ```

#### [ ] 3.2 Store é‡ç»„

- **ä»»åŠ¡è¦æ±‚**ï¼šæŒ‰é¢†åŸŸæ‹†åˆ†çŠ¶æ€ç®¡ç†
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] åˆ›å»º `useSystemStore`ï¼ˆåŸºç¡€è®¾ç½®ã€å¥åº·çŠ¶æ€ã€ä»»åŠ¡é˜Ÿåˆ—ï¼‰
  - [ ] åˆ›å»º `useProviderStore`ï¼ˆåˆ—è¡¨ã€æ’åºã€è¡¨å•ç¼“å­˜ï¼‰
  - [ ] åˆ›å»º `useChatStore`ï¼ˆä¼šè¯ã€æ¨¡å‹ã€æ¶ˆæ¯ï¼‰
  - [ ] åˆ›å»º `useUiStore`ï¼ˆæ¨¡æ€ã€æŠ½å±‰ã€ä¸»é¢˜ï¼‰
  - [ ] è¿ç§» `useLlmDashboardStore` å†…å®¹
  - [ ] åˆ é™¤ provide/inject ä¾èµ–
- **Store æ¨¡æ¿**ï¼š

  ```typescript
  // src/stores/provider.store.ts
  export const useProviderStore = defineStore("provider", () => {
    // State
    const providers = ref<Map<string, Provider>>(new Map());
    const loading = ref(false);

    // Computed
    const sortedProviders = computed(() =>
      Array.from(providers.value.values()).sort((a, b) => a.order - b.order)
    );

    // Actions
    const fetchProviders = async () => {
      loading.value = true;
      try {
        const list = await configService.getProviders();
        // ...
      } finally {
        loading.value = false;
      }
    };

    return {
      providers: readonly(providers),
      loading: readonly(loading),
      sortedProviders,
      fetchProviders,
    };
  });
  ```

#### [ ] 3.3 é€šç”¨ Hooks ç¼–å†™

- **ä»»åŠ¡è¦æ±‚**ï¼šåŸºäº vueuse/lodash/mitt å®ç°é€šç”¨ hooks
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] `useAsyncTask` - å¼‚æ­¥ä»»åŠ¡ç®¡ç†ï¼ˆloading/error/resultï¼‰
  - [ ] `useEventBus` - mitt äº‹ä»¶æ€»çº¿å°è£…
  - [ ] `useHotkeys` - å¿«æ·é”®ç®¡ç†
  - [ ] `useDebouncedRef` - é˜²æŠ–å“åº”å¼å¼•ç”¨
  - [ ] `useStorageAdapter` - å­˜å‚¨é€‚é…å™¨ï¼ˆweb/desktopï¼‰
- **Hook æ¨¡æ¿**ï¼š

  ```typescript
  // src/composables/useAsyncTask.ts
  export function useAsyncTask<T>(
    asyncFn: () => Promise<T>,
    options: AsyncTaskOptions = {}
  ) {
    const result = ref<T | null>(null);
    const loading = ref(false);
    const error = ref<Error | null>(null);

    const execute = async () => {
      loading.value = true;
      error.value = null;
      try {
        result.value = await asyncFn();
      } catch (err) {
        error.value = err as Error;
        options.onError?.(err as Error);
      } finally {
        loading.value = false;
      }
    };

    return {
      result: readonly(result),
      loading: readonly(loading),
      error: readonly(error),
      execute,
    };
  }
  ```

---

### é˜¶æ®µå››ï¼šä¸šåŠ¡æ¨¡å—é‡æ„ï¼ˆç¬¬ 7-10 å‘¨ï¼‰

#### [ ] 4.1 Chat æ¨¡å—æ‹†åˆ†

- **ä»»åŠ¡è¦æ±‚**ï¼šé‡æ„èŠå¤©åŠŸèƒ½ä¸ºç‹¬ç«‹æ¨¡å—
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] åˆ›å»º `modules/chat/components/Sidebar/` - ä¼šè¯åˆ—è¡¨ã€è¿‡æ»¤
  - [ ] åˆ›å»º `modules/chat/components/Transcript/` - æ¶ˆæ¯å±•ç¤ºã€æŠ˜å å—
  - [ ] åˆ›å»º `modules/chat/components/Composer/` - è¾“å…¥ã€å·¥å…·ã€æ¨¡å‹åˆ‡æ¢
  - [ ] åˆ›å»º `modules/chat/components/ModelPanel/` - æ¨¡å‹é€‰æ‹©
  - [ ] åˆ›å»º `modules/chat/hooks/useChat.ts` - èŠå¤©é€»è¾‘
  - [ ] åˆ›å»º `modules/chat/stores/chat.local.ts` - æ¨¡å—å†…çŠ¶æ€
  - [ ] è¿ç§» `views/Chat/Chat.vue` çš„é€»è¾‘
- **ç›®å½•ç»“æ„**ï¼š
  ```
  modules/chat/
  â”œâ”€â”€ components/
  â”‚   â”œâ”€â”€ Sidebar/
  â”‚   â”‚   â”œâ”€â”€ index.vue
  â”‚   â”‚   â”œâ”€â”€ ConversationItem.vue
  â”‚   â”‚   â””â”€â”€ sidebar.types.ts
  â”‚   â”œâ”€â”€ Transcript/
  â”‚   â”‚   â”œâ”€â”€ index.vue
  â”‚   â”‚   â”œâ”€â”€ MessageBlock.vue
  â”‚   â”‚   â”œâ”€â”€ ReasoningBlock.vue
  â”‚   â”‚   â””â”€â”€ transcript.types.ts
  â”‚   â””â”€â”€ Composer/
  â”‚       â”œâ”€â”€ index.vue
  â”‚       â”œâ”€â”€ ToolSelector.vue
  â”‚       â””â”€â”€ composer.types.ts
  â”œâ”€â”€ hooks/
  â”‚   â”œâ”€â”€ useChat.ts
  â”‚   â”œâ”€â”€ useStreaming.ts
  â”‚   â””â”€â”€ useMessageActions.ts
  â”œâ”€â”€ stores/
  â”‚   â””â”€â”€ chat.local.ts
  â”œâ”€â”€ types/
  â”‚   â””â”€â”€ index.ts
  â””â”€â”€ index.ts
  ```

#### [ ] 4.2 ChatPanel ç»„ä»¶æ‹†åˆ†

- **ä»»åŠ¡è¦æ±‚**ï¼šå°† 1133 è¡Œçš„ ChatPanel.vue æ‹†åˆ†ä¸ºä¸“æ³¨ç»„ä»¶
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] æå– `useChatTags.ts`ï¼ˆæ ‡ç­¾ç®¡ç†ï¼Œçº¦ç¬¬ 498-639 è¡Œï¼‰
  - [ ] æå– `useChatEvents.ts`ï¼ˆäº‹ä»¶æ€»çº¿ç®¡ç†ï¼‰
  - [ ] æå– `useMessageActions.ts`ï¼ˆæ¶ˆæ¯æ“ä½œï¼‰
  - [ ] ç§»é™¤é‡å¤ç›‘å¬å™¨ï¼ˆç¬¬ 136-154 è¡Œï¼‰
  - [ ] ä¿®å¤å¼‚æ­¥æŒ‚è½½é€»è¾‘ï¼ˆç¬¬ 181-185 è¡Œï¼‰
- **å…³è”æ–‡ä»¶**ï¼š`packages/frontend/src/views/LlmDashboard/Chat/ChatPanel.vue`

#### [ ] 4.3 Providers æ¨¡å—é‡æ„

- **ä»»åŠ¡è¦æ±‚**ï¼šæ„å»ºæä¾›å•†ç®¡ç†æ¨¡å—
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] åˆ›å»º `modules/providers/components/ProviderList/` - åˆ—è¡¨å±•ç¤º
  - [ ] åˆ›å»º `modules/providers/components/ProviderCard/` - å¡ç‰‡ç»„ä»¶
  - [ ] åˆ›å»º `modules/providers/components/RouterConfig/` - è·¯ç”±é…ç½®
  - [ ] åˆ›å»º `modules/providers/components/ProviderDrawer/` - è¯¦æƒ…æŠ½å±‰
  - [ ] å®ç°æ‹–æ‹½æ’åºï¼ˆVueDraggableï¼‰
  - [ ] ç»Ÿä¸€ loading/error/ç©ºæ€å¤„ç†

#### [ ] 4.4 ImmersiveCode ç»„ä»¶æ‹†åˆ†

- **ä»»åŠ¡è¦æ±‚**ï¼šå°† 1449 è¡Œçš„ç»„ä»¶æ‹†åˆ†ä¸ºèŒè´£å•ä¸€çš„å­ç»„ä»¶
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] åˆ›å»º `CodeEditor.vue`ï¼ˆMonaco ç¼–è¾‘å™¨é€»è¾‘ï¼‰
  - [ ] åˆ›å»º `CommandHistory.vue`ï¼ˆå‘½ä»¤å†å²ï¼‰
  - [ ] åˆ›å»º `FileTree.vue`ï¼ˆæ–‡ä»¶æ ‘ï¼‰
  - [ ] åˆ›å»º `StatusBar.vue`ï¼ˆçŠ¶æ€æ ï¼‰
  - [ ] åˆ›å»º `TerminalOutput.vue`ï¼ˆç»ˆç«¯è¾“å‡ºï¼‰
- **ç›®å½•ç»“æ„**ï¼š
  ```
  components/immersive/
  â”œâ”€â”€ ImmersiveCode.vue        # å®¹å™¨ç»„ä»¶
  â”œâ”€â”€ CodeEditor/
  â”œâ”€â”€ CommandHistory/
  â”œâ”€â”€ FileTree/
  â”œâ”€â”€ StatusBar/
  â””â”€â”€ TerminalOutput/
  ```

#### [ ] 4.5 è®¾ç½®ä¸æ¨¡æ€ç³»ç»Ÿ

- **ä»»åŠ¡è¦æ±‚**ï¼šé‡å»ºè®¾ç½®æ¨¡å—
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] åˆ›å»º `modules/settings/` æ¨¡å—
  - [ ] å°† `Modal/*.vue` æ”¹å†™ä¸ºä½¿ç”¨åŸºç¡€ Dialog ç»„ä»¶
  - [ ] ç»Ÿä¸€è¡¨å•å…ƒç´ ä½¿ç”¨ `components/ui` åŸºç¡€ä»¶
  - [ ] é€šè¿‡ `useUiStore` æ§åˆ¶æ¨¡æ€æ˜¾éš

---

### é˜¶æ®µäº”ï¼šç±»å‹ç³»ç»Ÿä¸ API å±‚ï¼ˆç¬¬ 11-12 å‘¨ï¼‰

#### [ ] 5.1 TypeScript æ”¹è¿›

- **ä»»åŠ¡è¦æ±‚**ï¼šæ¶ˆé™¤ `any` ç±»å‹ï¼Œå»ºç«‹å®Œæ•´ç±»å‹å®šä¹‰
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] åˆ›å»º `src/types/api/` - API å“åº”ç±»å‹
  - [ ] åˆ›å»º `src/types/chat/` - èŠå¤©ç›¸å…³ç±»å‹
  - [ ] åˆ›å»º `src/types/mcp/` - MCP åè®®ç±»å‹
  - [ ] æ¶ˆé™¤ 35 ä¸ªæ–‡ä»¶ä¸­çš„ `any` ç±»å‹
- **ç±»å‹å®šä¹‰ç¤ºä¾‹**ï¼š

  ```typescript
  // src/types/chat/message.ts
  export interface ChatMessage {
    id: string;
    content: string;
    role: "user" | "assistant";
    timestamp: Date;
    metadata?: Record<string, unknown>;
  }

  // src/types/mcp/arguments.ts
  export type McpArgumentValue =
    | string
    | number
    | boolean
    | string[]
    | Record<string, unknown>;

  export interface McpArguments {
    [key: string]: McpArgumentValue;
  }
  ```

#### [ ] 5.2 API å±‚ç»Ÿä¸€

- **ä»»åŠ¡è¦æ±‚**ï¼šåˆ›å»ºç»Ÿä¸€çš„ API åŸºç±»
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] åˆ›å»º `src/services/api/BaseApiService.ts`
  - [ ] ç»Ÿä¸€é”™è¯¯å¤„ç†
  - [ ] ç»Ÿä¸€è¯·æ±‚/å“åº”è½¬æ¢
  - [ ] ç»Ÿä¸€é‡è¯•é€»è¾‘
  - [ ] ç»Ÿä¸€å–æ¶ˆä»¤ç‰Œå¤„ç†
  - [ ] é‡æ„ç°æœ‰ API hooks
- **BaseApiService æ¨¡æ¿**ï¼š
  ```typescript
  abstract class BaseApiService {
    protected async apiCall<T>(
      endpoint: string,
      options: RequestOptions = {}
    ): Promise<ApiResponse<T>> {
      // ç»Ÿä¸€é”™è¯¯å¤„ç†
      // ç»Ÿä¸€è¯·æ±‚/å“åº”è½¬æ¢
      // ç»Ÿä¸€é‡è¯•é€»è¾‘
      // ç»Ÿä¸€å–æ¶ˆä»¤ç‰Œå¤„ç†
    }
  }
  ```

---

### é˜¶æ®µå…­ï¼šé€šçŸ¥ä¸åé¦ˆç³»ç»Ÿï¼ˆç¬¬ 13 å‘¨ï¼‰

#### [ ] 6.1 é€šçŸ¥ä¸åé¦ˆæœºåˆ¶

- **ä»»åŠ¡è¦æ±‚**ï¼šå»ºç«‹ç»Ÿä¸€çš„é€šçŸ¥ç³»ç»Ÿ
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] åˆ›å»º `src/lib/notifications.ts`
  - [ ] åŸºäº mitt é›†ä¸­å¤„ç† toast/å¯¹è¯æ¡†/é®ç½©
  - [ ] æä¾› `useNotifications` composable
  - [ ] æ›¿æ¢æ•£è½çš„ `useToasts` è°ƒç”¨ï¼ˆ126 æ¬¡è°ƒç”¨ï¼Œ16 ä¸ªæ–‡ä»¶ï¼‰
  - [ ] é•¿è€—æ—¶æ“ä½œæä¾›è¿›åº¦æ¡/æ­¥éª¤æç¤º
- **Notification æ¨¡æ¿**ï¼š

  ```typescript
  // src/lib/notifications.ts
  import mitt from "mitt";

  type NotificationEvents = {
    toast: ToastPayload;
    loading: LoadingPayload;
    confirm: ConfirmPayload;
  };

  const emitter = mitt<NotificationEvents>();

  export const notifications = {
    toast: (payload: ToastPayload) => emitter.emit("toast", payload),
    loading: (payload: LoadingPayload) => emitter.emit("loading", payload),
    confirm: (payload: ConfirmPayload) => emitter.emit("confirm", payload),
  };

  export function useNotifications() {
    const toast = (options: ToastOptions) => {
      notifications.toast({
        type: options.type || "info",
        message: options.message,
        duration: options.duration || 3000,
      });
    };

    return { toast, loading, confirm };
  }
  ```

---

### é˜¶æ®µä¸ƒï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆç¬¬ 14 å‘¨ï¼‰

#### [ ] 7.1 è™šæ‹Ÿæ»šåŠ¨å®ç°

- **ä»»åŠ¡è¦æ±‚**ï¼šä¸ºé•¿åˆ—è¡¨å®ç°è™šæ‹Ÿæ»šåŠ¨
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] å®‰è£… `@tanstack/vue-virtual`
  - [ ] ChatPanel æ¶ˆæ¯åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨
  - [ ] Logger è¯·æ±‚æ—¥å¿—è™šæ‹Ÿæ»šåŠ¨
  - [ ] Provider åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¦‚è¶…è¿‡ 100 é¡¹ï¼‰
- **è™šæ‹Ÿæ»šåŠ¨æ¨¡æ¿**ï¼š
  ```vue
  <template>
    <VirtualList :items="messages" :item-size="80" v-slot="{ item }">
      <MessageItem :message="item" />
    </VirtualList>
  </template>
  ```

#### [ ] 7.2 Bundle ä¼˜åŒ–

- **ä»»åŠ¡è¦æ±‚**ï¼šä¼˜åŒ–æ‰“åŒ…ä½“ç§¯å’ŒåŠ è½½æ€§èƒ½
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] é…ç½®è·¯ç”±çº§ä»£ç åˆ†å‰²
  - [ ] æ‡’åŠ è½½ Monaco Editor
  - [ ] é…ç½® manual chunksï¼ˆmonaco/vue-vendor/ui-vendorï¼‰
  - [ ] Tree-shaking æœªä½¿ç”¨ä¾èµ–
- **Vite é…ç½®ç¤ºä¾‹**ï¼š
  ```typescript
  // vite.config.ts
  export default defineConfig({
    build: {
      rollupOptions: {
        output: {
          manualChunks: {
            monaco: ["monaco-editor"],
            "vue-vendor": ["vue", "vue-router", "pinia"],
            "ui-vendor": ["naive-ui", "@vueuse/core"],
          },
        },
      },
    },
  });
  ```

#### [ ] 7.3 é”™è¯¯è¾¹ç•Œç³»ç»Ÿ

- **ä»»åŠ¡è¦æ±‚**ï¼šå»ºç«‹ç»„ä»¶çº§é”™è¯¯å¤„ç†
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] åˆ›å»º `src/components/common/ErrorBoundary.vue`
  - [ ] æ”¯æŒè‡ªå®šä¹‰ fallback UI
  - [ ] æ”¯æŒé‡è¯•åŠŸèƒ½
  - [ ] åœ¨å…³é”®é¡µé¢åŒ…è£…ä½¿ç”¨
- **ErrorBoundary æ¨¡æ¿**ï¼š

  ```vue
  <template>
    <div v-if="hasError" class="error-boundary">
      <h2>å‡ºç°é”™è¯¯</h2>
      <p>{{ error?.message }}</p>
      <button @click="retry">é‡è¯•</button>
    </div>
    <slot v-else />
  </template>

  <script setup lang="ts">
  import { ref, onErrorCaptured } from "vue";

  const hasError = ref(false);
  const error = ref<Error | null>(null);

  onErrorCaptured((err) => {
    hasError.value = true;
    error.value = err;
    return false;
  });

  const retry = () => {
    hasError.value = false;
    error.value = null;
  };
  </script>
  ```

---

### é˜¶æ®µå…«ï¼šæµ‹è¯•ä¸æ–‡æ¡£ï¼ˆç¬¬ 15-16 å‘¨ï¼‰

#### [ ] 8.1 æµ‹è¯•åŸºç¡€è®¾æ–½

- **ä»»åŠ¡è¦æ±‚**ï¼šå»ºç«‹æµ‹è¯•æ¡†æ¶å’Œå…³é”®æµ‹è¯•
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] é…ç½® Vitest + Vue Test Utils
  - [ ] ä¸º service ç¼–å†™å•å…ƒæµ‹è¯•
  - [ ] ä¸º store ç¼–å†™å•å…ƒæµ‹è¯•
  - [ ] ä¸ºå…³é”®ç»„ä»¶ç¼–å†™æ¸²æŸ“æµ‹è¯•
  - [ ] é…ç½® lint-staged + CI æµç¨‹
- **æµ‹è¯•ä¼˜å…ˆçº§**ï¼š
  1. API hooks å•å…ƒæµ‹è¯•
  2. Composables å•å…ƒæµ‹è¯•
  3. å…³é”®ç»„ä»¶æµ‹è¯•
- **æµ‹è¯•ç¤ºä¾‹**ï¼š

  ```typescript
  // tests/unit/services/configService.test.ts
  describe("configService", () => {
    it("should fetch providers successfully", async () => {
      // Mock HTTP
      // Assert response
    });
  });

  // tests/unit/stores/provider.store.test.ts
  describe("useProviderStore", () => {
    it("should add provider to list", () => {
      // Test implementation
    });
  });
  ```

#### [ ] 8.2 æ–‡æ¡£ä¸ Storybook

- **ä»»åŠ¡è¦æ±‚**ï¼šå»ºç«‹ç»„ä»¶æ–‡æ¡£å’Œå±•ç¤ºç³»ç»Ÿ
- **éªŒæ”¶æ ‡å‡†**ï¼š
  - [ ] é…ç½® Storybook
  - [ ] ä¸ºåŸºç¡€ç»„ä»¶ç¼–å†™ stories
  - [ ] è®°å½• props/ç”¨æ³•
  - [ ] æ›´æ–° `docs/refactor-plan.md`

---

## ğŸ“‹ å¼€å‘ Checklist

### æ–°åŠŸèƒ½å¼€å‘å‰å¿…é—®

1. [ ] è¿™ä¸ªåŠŸèƒ½å±äºå“ªä¸ªä¸šåŠ¡æ¨¡å—ï¼Ÿ
2. [ ] åº”è¯¥æ”¾åœ¨ modules/xxx ä¸‹å—ï¼Ÿ
3. [ ] æ˜¯å¦éœ€è¦æŠ½å–ä¸º composableï¼Ÿ
4. [ ] çŠ¶æ€åº”è¯¥æ”¾åœ¨å“ªé‡Œï¼ˆæœ¬åœ°/Piniaï¼‰ï¼Ÿ
5. [ ] API è°ƒç”¨æ˜¯å¦å°è£…åœ¨ service ä¸­ï¼Ÿ

### ä»£ç æäº¤å‰å¿…æŸ¥

1. [ ] ç»„ä»¶æ˜¯å¦è¶…è¿‡ 200 è¡Œï¼Ÿ
2. [ ] æ˜¯å¦æœ‰é‡å¤é€»è¾‘å¯ä»¥æŠ½å–ï¼Ÿ
3. [ ] å‘½åæ˜¯å¦ç¬¦åˆè§„èŒƒï¼Ÿ
4. [ ] ESLint æ£€æŸ¥æ˜¯å¦é€šè¿‡ï¼Ÿ
5. [ ] æ˜¯å¦æœ‰æœªä½¿ç”¨çš„ `any` ç±»å‹ï¼Ÿ

---

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### ä»£ç è´¨é‡

| æŒ‡æ ‡               | å½“å‰å€¼ | ç›®æ ‡å€¼ |
| ------------------ | ------ | ------ |
| è¶…è¿‡ 500 è¡Œçš„ç»„ä»¶  | 3 ä¸ª   | 0 ä¸ª   |
| ä½¿ç”¨ `any` çš„æ–‡ä»¶  | 35 ä¸ª  | 0 ä¸ª   |
| å…³é”®è·¯å¾„æµ‹è¯•è¦†ç›–ç‡ | 0%     | 90%+   |

### æ€§èƒ½

| æŒ‡æ ‡             | å½“å‰å€¼ | ç›®æ ‡å€¼     |
| ---------------- | ------ | ---------- |
| åˆå§‹ Bundle å¤§å° | -      | å‡å°‘ 30%   |
| é¦–æ¬¡å†…å®¹ç»˜åˆ¶     | -      | < 100ms    |
| è™šæ‹Ÿæ»šåŠ¨åˆ—è¡¨     | æ—      | å…¨éƒ¨é•¿åˆ—è¡¨ |

### å¼€å‘ä½“éªŒ

| æŒ‡æ ‡     | å½“å‰å€¼ | ç›®æ ‡å€¼           |
| -------- | ------ | ---------------- |
| æ„å»ºæ—¶é—´ | -      | å‡å°‘ 20%         |
| ç»„ä»¶æ–‡æ¡£ | æ—      | Storybook å…¨è¦†ç›– |
| é”™è¯¯è¾¹ç•Œ | æ—      | å…³é”®é¡µé¢è¦†ç›–     |

---

## âš ï¸ é£é™©ä¸ç¼“è§£

### é«˜é£é™©

| é£é™©         | ç¼“è§£ç­–ç•¥                              |
| ------------ | ------------------------------------- |
| ç ´åæ€§æ›´æ”¹   | é€šè¿‡åŠŸèƒ½æ ‡å¿—å¢é‡å®ç°                  |
| å¤§å‹ç»„ä»¶é‡æ„ | è¿‡æ¸¡æœŸä¿æŒå‘åå…¼å®¹                    |
| å›¢é˜Ÿåä½œé£é™© | å»ºç«‹ architecture.mdï¼ŒPR æ¨¡æ¿å¢åŠ å‹¾é€‰ |

### ä¸­ç­‰é£é™©

| é£é™©             | ç¼“è§£ç­–ç•¥                     |
| ---------------- | ---------------------------- |
| çŠ¶æ€ç®¡ç†æ›´æ”¹     | å½»åº•æµ‹è¯•çŠ¶æ€è½¬æ¢             |
| API å±‚æ›´æ”¹       | é€šè¿‡ adapter ä¿ç•™æ—§ API å½¢æ€ |
| è®¾è®¡ç³»ç»Ÿè½åœ°æˆæœ¬ | ä¼˜å…ˆå®šä¹‰ tokenï¼Œé€é¡µæ›¿æ¢     |

### ä½é£é™©

| é£é™©     | ç¼“è§£ç­–ç•¥     |
| -------- | ------------ |
| æ·»åŠ æµ‹è¯• | å¯¹ç”Ÿäº§æ— å½±å“ |
| æ–‡æ¡£æ·»åŠ  | çº¯ç²¹æ·»åŠ æ€§   |

---

## ğŸ’¡ æœ€ä½³å®è·µæé†’

### âœ… Do'sï¼ˆæ¨èåšæ³•ï¼‰

- æŒ‰ä¸šåŠ¡æ¨¡å—ç»„ç»‡ä»£ç 
- ä½¿ç”¨ç»„åˆå¼ API
- ç»Ÿä¸€ä½¿ç”¨ `<script setup>`
- API è°ƒç”¨å°è£…åœ¨ service ä¸­
- ç»„ä»¶åªè´Ÿè´£ UI å’Œäº‹ä»¶è°ƒç”¨
- ä½¿ç”¨ vueuse/lodash/mitt ç­‰åº“ï¼Œä¸é‡å¤é€ è½®å­

### âŒ Don'tsï¼ˆé¿å…åšæ³•ï¼‰

- åœ¨ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨ API
- æŠŠæ‰€æœ‰çŠ¶æ€éƒ½æ”¾ Pinia
- ç»„ä»¶è¶…è¿‡ 200 è¡Œä¸æ‹†åˆ†
- å‘½åä¸è§„èŒƒ
- å¿½ç•¥ ESLint è­¦å‘Š
- ä½¿ç”¨ `any` ç±»å‹

---

## ğŸ“… é‡Œç¨‹ç¢‘æ—¶é—´è¡¨

| é˜¶æ®µ   | æ—¶é—´        | æ ¸å¿ƒäº¤ä»˜                              |
| ------ | ----------- | ------------------------------------- |
| é˜¶æ®µä¸€ | ç¬¬ 1-2 å‘¨   | ç›®å½•è§„èŒƒã€Token ç³»ç»Ÿã€è·¯ç”±ä¿®å¤        |
| é˜¶æ®µäºŒ | ç¬¬ 3-4 å‘¨   | åŸºç¡€ç»„ä»¶åº“ã€AppShell                  |
| é˜¶æ®µä¸‰ | ç¬¬ 5-6 å‘¨   | Service å±‚ã€Store é‡ç»„ã€é€šç”¨ Hooks    |
| é˜¶æ®µå›› | ç¬¬ 7-10 å‘¨  | Chat/Providers/ImmersiveCode æ¨¡å—é‡æ„ |
| é˜¶æ®µäº” | ç¬¬ 11-12 å‘¨ | TypeScript æ”¹è¿›ã€API ç»Ÿä¸€             |
| é˜¶æ®µå…­ | ç¬¬ 13 å‘¨    | é€šçŸ¥ç³»ç»Ÿ                              |
| é˜¶æ®µä¸ƒ | ç¬¬ 14 å‘¨    | æ€§èƒ½ä¼˜åŒ–                              |
| é˜¶æ®µå…« | ç¬¬ 15-16 å‘¨ | æµ‹è¯•ä¸æ–‡æ¡£                            |

---

**æ ¸å¿ƒåŸåˆ™**ï¼šæ¶æ„æ¸…æ™°ã€èŒè´£åˆ†æ˜ã€æ˜“äºç»´æŠ¤ã€æ–¹ä¾¿æ‰©å±•

**é‡æ„å®Œæˆåæ”¶ç›Š**ï¼š

- æ›´æ¸…æ™°çš„ç»„ä»¶æ¶æ„
- å®Œæ•´çš„ç±»å‹å®‰å…¨
- å…¨é¢çš„æµ‹è¯•è¦†ç›–
- ä¼˜åŒ–çš„æ€§èƒ½è¡¨ç°
- è¯¦å°½çš„æ–‡æ¡£æ”¯æŒ
